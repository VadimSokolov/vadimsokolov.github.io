<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>5&nbsp; A/B Testing – Bayes, AI and Deep Learning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./06-hyp.html" rel="next">
<link href="./04-dec.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-3fa4ff979380b88aedafe7599fa714ae.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>
  // Load MathJax with custom macros
  window.MathJax = {
    tex: {
      macros: {
        Cov: ["\\mathrm{Cov}\\left(#1\\right)", 1],
        Cor: ["\\mathrm{Cor}\\left(#1\\right)", 1],
        Var: ["\\mathrm{Var}\\left(#1\\right)", 1],
        sd: ["\\mathrm{sd}\\left(#1\\right)", 1],
        E: ["\\mathrm{E}_{#1}\\left(#2\\right)", 2, ""],
        prob: ["\\mathrm{P}\\left(#1\\right)", 1],
        defeq: "\\stackrel{\\mathrm{def}}{=}",
        mini: "\\operatorname*{minimize}"
      }
    }
  };
</script>

<style>
  /* Custom styling for math content */
  .MathJax {
    font-size: 1em !important;
  }
  
  /* Ensure consistent math rendering */
  mjx-container[jax="CHTML"] {
    line-height: 1.2;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="5&nbsp; A/B Testing – Bayes, AI and Deep Learning">
<meta property="og:description" content="">
<meta property="og:image" content="05-ab_files/figure-html/mi-vote-plot-1.png">
<meta property="og:site_name" content="Bayes, AI and Deep Learning">
<meta name="twitter:title" content="5&nbsp; A/B Testing – Bayes, AI and Deep Learning">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="05-ab_files/figure-html/mi-vote-plot-1.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01-prob.html">Bayes</a></li><li class="breadcrumb-item"><a href="./05-ab.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">A/B Testing</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Bayes, AI and Deep Learning</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Modern AI Playbook</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Bayes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-prob.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Probability and Uncertainty</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Bayes Rule</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-bl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Bayesian Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-dec.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Utility, Risk and Decisions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-ab.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">A/B Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-hyp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Bayesian Hypothesis Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-sp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Stochastic Processes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-gp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Gaussian Processes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-rl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Reinforcement Learning</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">AI</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Unreasonable Effectiveness of Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-pattern.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Pattern Matching</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Linear Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Logistic Regression and Generalized Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-tree.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Tree Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-forecasting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Forecasting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-select.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Model Selection</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-theoryai.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Statistical Learning Theory and Regularization</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Deep Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-nn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Neural Networks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-theorydl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Theory of Deep Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-sgd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Gradient Descent</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-qnn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Quantile Neural Networks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-cnn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Convolutional Neural Networks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-nlp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Natural Language Processing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-llm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Large Language Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25-robots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">AI Agents</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-linalg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Linear algebra and multivariate normal toolkit</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#hypothesis-testing" id="toc-hypothesis-testing" class="nav-link active" data-scroll-target="#hypothesis-testing"><span class="header-section-number">5.1</span> Hypothesis Testing</a></li>
  <li><a href="#confidence-intervals" id="toc-confidence-intervals" class="nav-link" data-scroll-target="#confidence-intervals"><span class="header-section-number">5.2</span> Confidence Intervals</a>
  <ul class="collapse">
  <li><a href="#mythbusters-example" id="toc-mythbusters-example" class="nav-link" data-scroll-target="#mythbusters-example">Mythbusters Example</a></li>
  <li><a href="#other-applications" id="toc-other-applications" class="nav-link" data-scroll-target="#other-applications">Other Applications</a></li>
  </ul></li>
  <li><a href="#ab-testing-applications" id="toc-ab-testing-applications" class="nav-link" data-scroll-target="#ab-testing-applications"><span class="header-section-number">5.3</span> A/B Testing Applications</a></li>
  <li><a href="#challenges-in-ab-testing" id="toc-challenges-in-ab-testing" class="nav-link" data-scroll-target="#challenges-in-ab-testing"><span class="header-section-number">5.4</span> Challenges in A/B Testing</a>
  <ul class="collapse">
  <li><a href="#multiple-testing" id="toc-multiple-testing" class="nav-link" data-scroll-target="#multiple-testing">Multiple Testing</a></li>
  </ul></li>
  <li><a href="#sec-ab-rct" id="toc-sec-ab-rct" class="nav-link" data-scroll-target="#sec-ab-rct"><span class="header-section-number">5.5</span> Randomized experiments and Causality</a>
  <ul class="collapse">
  <li><a href="#the-question-of-causation" id="toc-the-question-of-causation" class="nav-link" data-scroll-target="#the-question-of-causation">The question of causation</a></li>
  <li><a href="#split-plot-designs-and-rothamsted" id="toc-split-plot-designs-and-rothamsted" class="nav-link" data-scroll-target="#split-plot-designs-and-rothamsted">Split-plot designs and Rothamsted</a></li>
  <li><a href="#digital-experimentation-ab-testing" id="toc-digital-experimentation-ab-testing" class="nav-link" data-scroll-target="#digital-experimentation-ab-testing">Digital experimentation (A/B testing)</a></li>
  <li><a href="#the-era-of-observational-data" id="toc-the-era-of-observational-data" class="nav-link" data-scroll-target="#the-era-of-observational-data">The era of observational data</a></li>
  <li><a href="#from-experiments-to-observational-data" id="toc-from-experiments-to-observational-data" class="nav-link" data-scroll-target="#from-experiments-to-observational-data">From experiments to observational data</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01-prob.html">Bayes</a></li><li class="breadcrumb-item"><a href="./05-ab.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">A/B Testing</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-abtesting" class="quarto-section-identifier"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">A/B Testing</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>The Internet age opened the door to enormous data collection on personal preferences, behaviors, and actions. The data collected are observational rather than data collected from designed experiments—where we can control the environment to find the effects of interventions. User interface design is a prime example of this. Companies like Google, Amazon, and Netflix run thousands of experiments daily to optimize user experience and revenue. A/B testing is essentially a randomized controlled trial at scale, where two variants (A and B) are compared to determine which one performs better on a specific metric. The statistical machinery remains the same—we formulate a null hypothesis (no difference between variants), collect data, and compute a statistic to see if the observed difference is significant or just noise. The A/B variations can be physical, such as different colors or layouts, or they can be algorithmic, such as different search algorithms or recommendation systems.</p>
<p>However, a key distinction exists between traditional scientific hypothesis testing and modern A/B testing: the objective. In scientific research, the primary goal is often <em>truth discovery</em>—establishing a reproducible fact about the world. This necessitates a conservative approach with strict control over False Positives (Type I errors). In contrast, the goal of A/B testing in industry is often <em>decision making</em>—choosing the best option to maximize a business metric like revenue or engagement. Here, the cost of a missed opportunity (Type II error) can be just as detrimental as a false alarm. Consequently, industry practitioners may focus more on the magnitude of the effect (effect size) and the expected value of the decision, rather than relying solely on a rigid p-value threshold.</p>
<p>Throughout this chapter we use the classical testing language as an operational planning tool: Type I and Type II errors, power, and significance levels. In particular, <span class="math inline">\(\alpha\)</span> denotes a frequentist Type I error rate (test size). <a href="06-hyp.html" class="quarto-xref"><span>Chapter 6</span></a> revisits the same problems from a Bayesian decision-theoretic viewpoint, where posterior probabilities, Bayes factors, and explicit losses take center stage; when we discuss credibility or posterior uncertainty, we will avoid overloading <span class="math inline">\(\alpha\)</span> with a second meaning.</p>
<p>How do we know if the difference between variants is real or just noise? Consider a coin flip: if it comes up heads twice in a row, is the coin biased? Obviously two tosses aren’t enough to tell. Hypothesis testing formalizes this intuition—it tells us whether we have enough evidence to draw a conclusion, or whether we need more data. Let’s work through a concrete example.</p>
<p>You work as a quant for a trading firm and you have developed a new algorithm to trade stocks. You tested your algorithm on historical data and it outperformed the state-of-the-art algorithm used in your company. Now, the important question is whether your trading strategy can truly outperform the market or it just got lucky. We need to analyze the performance of the algorithm after it was created and decide whether we have truly discovered a dominant strategy. The effect we try to measure is usually present in some statistics that we calculate from data, for example, sample mean, proportion, or difference in means.</p>
<section id="hypothesis-testing" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="hypothesis-testing"><span class="header-section-number">5.1</span> Hypothesis Testing</h2>
<div id="exm-pyx" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.1 (Pyx Trial)</strong></span> The “Pyx Trial” refers to an ancient ceremony held in the United Kingdom’s Royal Mint. This tradition, dating back to the 12th century, is a method of testing the quality of minted coins to ensure it meets the standards of weight and purity set by law. The term “Pyx” comes from the Greek word “pyxis,” meaning a small box, which is used to hold the sample coins that are to be tested.</p>
<p>Sir Isaac Newton became Warden of the Mint in 1696 and later the Master of the Mint. His role was crucial in reforming the coinage and improving its quality. Newton was rigorous in enforcing standards and combating counterfeiting and clipping (the practice of shaving off small amounts of precious metal from coins). Newton applied his scientific mind to the problems of minting, including refining assays (the testing of the purity of metals), improving the design of coins to prevent clipping, and introducing milled edges on coins.</p>
<p>The trial starts by selecting <span class="math inline">\(n\)</span> coins from each batch produced by the Royal Mint. These coins are placed in a box called the Pyx. The number of coins used in the Trial of the Pyx can vary each year. This number depends on several factors, including the variety and quantity of coins produced by the Royal Mint in that particular year. Typically, a representative sample of each type of coin minted is selected for testing. Then, for each coin attribute (weight, size, composition), the mean (average) value of the sample is calculated as well as the variance of the mean.</p>
<p>Suppose we have minted one million of coins and collected the sample of <span class="math inline">\(n=100\)</span> coins, the legal weight tolerance for a certain coin is 0.05 grams.</p>
<p>We will use the simulated data for our analysis. Let’s simulate the weights of all of the coins produced</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">17</span>) <span class="co"># Kharlamov</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>allcoins <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">1000000</span>, <span class="fl">4.95</span>, <span class="fl">5.05</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now, we survey 100 randomly selected coins</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>xbar <span class="ot">=</span> <span class="fu">mean</span>(survey_sample)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The sample mean of 4.9950764 is very close to the true mean of 5. However, if we were to collect a different sample, the sample mean would be slightly different</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>xbar <span class="ot">=</span> <span class="fu">mean</span>(survey_sample)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now, we simulate 2000 surveys and calculate the sample mean for each survey.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(prep, <span class="at">breaks =</span> <span class="dv">30</span>, <span class="at">freq =</span> F, <span class="at">main=</span><span class="st">""</span>, <span class="at">col=</span><span class="st">"lightblue"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="fu">seq</span>(<span class="fl">4.9</span>,<span class="fl">5.1</span>,<span class="at">length.out =</span> <span class="dv">500</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(p, <span class="fu">dnorm</span>(p,<span class="fu">mean</span>(prep),<span class="fu">sd</span>(prep)), <span class="at">col=</span><span class="st">"red"</span>,<span class="at">lwd=</span><span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="05-ab_files/figure-html/mi-vote-plot-1.png" class="img-fluid figure-img" width="576"></p>
<figcaption>Histogram of voting proportions</figcaption>
</figure>
</div>
</div>
</div>
<p>We see that the red bell-curve (normal density) is a good model for the distribution over the means calculated from samples. In fact, the <em>central limit theorem</em> says that sample means follow a normal distribution. We need to estimate the mean and standard deviation of this bell curve. It is natural to use the sample mean as the estimate of the mean of the bell curve <code>mean(prep)</code>: 4.9998448. The mean <span class="math display">\[
\bar x = \frac{1}{n}\sum_{i=1}^{n} x_i
\]</span> is close to the true population mean of 5. We sometimes use the notation <span class="math inline">\(\hat \mu\)</span> to denote an estimate. So we have <span class="math inline">\(\hat \mu = \bar x\)</span>.</p>
<p>However, the standard deviation is much lower compared to the standard deviation of the population</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(prep)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.0028</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(allcoins)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.029</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The variance of the mean measures how much the sample mean is expected to vary from one sample to another, if you were to take multiple samples from the same population.</p>
<p>Assuming that samples are uncorrelated (correct sampling procedure is important!), the variance of the mean is given by <span class="math display">\[
\Var{\bar X} = \text{Var}\left(\frac{1}{n} \sum_{i=1}^{n} X_i\right) = \frac{1}{n^2} \sum_{i=1}^{n} \Var{X_i} = \frac{\sigma^2}{n}.
\]</span></p>
<p>Therefore, the variance of the mean formula is <span class="math display">\[
\Var{\bar X} = \frac{\sigma^2}{n}.
\]</span> If we know the population variance <span class="math inline">\(\Var{X_i} = \sigma^2\)</span>, then we can calculate the variance of the mean. However, in practice, we do not know the population variance. Instead, we estimate it using the sample variance <span class="math inline">\(s^2\)</span>. The estimated variance of the mean is then <span class="math display">\[
\Var{\bar X} = \frac{s^2}{n}.
\]</span> The standard deviation of the mean is called the <em>standard error</em> and is given by <span class="math display">\[
s_{\bar X} = \sqrt{\Var{\bar X}} = \frac{s}{\sqrt{n}}.
\]</span></p>
<p>Let’s compare the standard error of the mean and standard deviation calculated from the simulations</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(prep)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.0028</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(allcoins)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">100</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.0029</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>They are very close!</p>
<p>This statistical property allows us to quantify uncertainty about the sample mean and say something about the true value of the mean <span class="math inline">\(\mu\)</span>, in terms of a probabilistic interval statement.</p>
</div>
<p><strong>Central Limit Theorem</strong></p>
<p>CLT states that, given a sufficiently large sample size, the distribution of the sample means will be approximately normally distributed, regardless of the shape of the population distribution. This normal distribution is also known as the Gaussian distribution. The theorem applies to a wide range of population distributions, including distributions that are not normal. This universality makes it one of the most powerful and widely-used theorems in statistics.</p>
<p>The Central Limit Theorem originates from the <a href="https://en.wikipedia.org/wiki/De_Moivre-Laplace_theorem">De Moivre-Laplace theorem</a>, published by de Moivre in 1738, which established the normal approximation to the binomial distribution. According to this theorem the standard normal distribution arises as the limit of scaled and centered Binomial distributions, in the following sense. Let <span class="math inline">\(x_1,\ldots,x_n\)</span> be independent, identically distributed Rademacher random variables, that is, independent random variables with distribution <span class="math display">\[
P(X_i = 1) = P(X_i = -1) = \frac{1}{2}.
\]</span> Then, the distribution of the sum of these random variables converges to the standard normal distribution as <span class="math inline">\(n\)</span> tends to infinity. That is, for any <span class="math inline">\(a&lt;b\)</span>, we have <span class="math display">\[
\lim_{n\to\infty} P\left(a \le \frac{X_1+\cdots+X_n}{\sqrt{n}} \le b\right) = \int_a^b \frac{1}{\sqrt{2\pi}} e^{-x^2/2} dx.
\]</span> In this case, the sum <span class="math inline">\(X_1+\cdots+X_n\)</span> has mean <span class="math inline">\(n\mu\)</span> and variance <span class="math inline">\(n\sigma^2\)</span>, so that the standardized sum <span class="math inline">\((X_1+\cdots+X_n - n\mu)/\sqrt{n\sigma^2}\)</span> has mean <span class="math inline">\(0\)</span> and variance <span class="math inline">\(1\)</span>. The theorem then states that the distribution of this standardized sum converges to the standard normal distribution as <span class="math inline">\(n\)</span> tends to infinity.</p>
<p>In 1889 Francis Galton published a paper where he described what we now call the Galton Board. The Galton Board is a vertical board with interleaved rows of pins. Balls are dropped from the top, and bounce left and right as they hit the pins. Eventually, they are collected into one of several bins at the bottom. The distribution of balls in the bins approximates the normal distribution. Each pin is a physical realization of the binomial draw and each row is a summand. The location at the bottom is a sum of the binomial draws. The <code>galton-ball.r</code> script simulates the Galton board experiment. The script is available in the <code>R</code> folder of the book repository. <a href="#fig-galton" class="quarto-xref">Figure&nbsp;<span>5.1</span></a> shows the result of the simulation. The distribution of the balls in the bins approximates the normal distribution.</p>
<div id="fig-galton" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-galton-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="fig/galton.png" class="img-fluid figure-img" style="width:40.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-galton-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.1: Galton Board
</figcaption>
</figure>
</div>
<div id="exm-android-earthquake" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.2 (Android Earthquake Alerts)</strong></span> A fantastic modern example of the Central Limit Theorem in action is Google’s Android Earthquake Alerts System. The core idea is to use the accelerometers present in billions of Android smartphones to create a global earthquake detection network.</p>
<p>Each individual phone’s accelerometer is a “noisy sensor.” It can be triggered by many events that are not earthquakes, such as the phone being dropped, vibrations from a passing truck, or even loud music. A signal from a single phone is therefore a “weak signal” — on its own, it’s not reliable enough to issue an earthquake alert.</p>
<p>However, Google’s system aggregates signals from a vast number of phones in a specific geographic area. When a real earthquake occurs, thousands or even millions of phones in the affected region will detect the seismic waves (P-waves and S-waves) at roughly the same time.</p>
<p>By averaging the readings from this massive number of sensors, the system can effectively cancel out the random noise from individual phones. A single phone dropping is a random, isolated event. But thousands of phones vibrating in a synchronized pattern is a clear, strong signal that is highly unlikely to be due to chance.</p>
<p>This is a direct application of the principle that the standard error of the mean is inversely proportional to the square root of the sample size (<span class="math inline">\(s_{\bar x} = s/\sqrt{n}\)</span>). Here, <span class="math inline">\(n\)</span> is the number of phones. With a massive <span class="math inline">\(n\)</span>, the standard error of the average measurement becomes incredibly small. This allows the system to have a very high level of confidence that the detected event is a real earthquake, enabling it to send out timely alerts to people who may be in danger. It’s a powerful demonstration of how aggregating many weak, unreliable signals can produce a single, highly reliable and actionable insight.</p>
</div>
</section>
<section id="confidence-intervals" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="confidence-intervals"><span class="header-section-number">5.2</span> Confidence Intervals</h2>
<p>The fact that the distribution of the simulated means from the Pyx example can be described well by a normal bell curve, in fact has a theoretical justification. It is called the <em>Central Limit Theorem</em>. The Central Limit Theorem states that, given a sufficiently large sample size, the distribution of the sample means will be approximately normally distributed, regardless of the shape of the population distribution. This normal distribution is also known as the Gaussian distribution.</p>
<p>There are a few conditions. The sampled observations must be independent. In practice, this means that the sampling should be random, and one observation should not influence another. Further, the sample size should be sufficiently large. While there is no strict rule for what constitutes ‘large enough,’ a common guideline is a sample size of 30 or more. However, if the population distribution is far from normal, a larger sample size may be required.</p>
<p>We can estimate the mean of this bell curve using <span class="math inline">\(\bar x\)</span> and the standard deviation (standard error) using <span class="math inline">\(s/\sqrt{n}\)</span>.</p>
<p>The square-root nature of this relation is somewhat unfortunate. To double your certainty about the population mean, you need to quadruple the sample size.</p>
<p>One of the main applications of this result is the construction of <em>confidence intervals</em>. A confidence interval is a range of values that is likely to contain the true value of the population mean. It is a plausible range for the quantity we are trying to estimate. The confidence interval is calculated using the sample mean <span class="math inline">\(\bar x\)</span> and the standard error <span class="math inline">\(s/\sqrt{n}\)</span>. The confidence interval is calculated as follows <span class="math display">\[
\bar x \pm 1.96s_{\bar x}, ~ s_{\bar x} = \frac{s}{\sqrt{n}}.
\]</span></p>
<p>The theorem applies to a wide range of population distributions, including distributions that are not normal. This universality makes it one of the most powerful and widely-used theorems in statistics.</p>
<p>Here are a few conclusions we can make thus far</p>
<ol type="1">
<li><p>Mean estimates are based on random samples and therefore random (uncertain) themselves<br>
We need to account for this uncertainty!</p></li>
<li><p>Standard Error measures the uncertainty of an estimate</p></li>
<li><p>Using properties of the Normal distribution, we can construct <span class="math inline">\(95\)</span>% Confidence Intervals<br>
This provides us with a plausible range for the quantity we are trying to estimate.</p></li>
</ol>
<p>Recall the Patriots coin toss example from <a href="03-bl.html" class="quarto-xref"><span>Chapter 3</span></a>, we know that they won 19 out of 25 tosses during the 2014-2015 season. In this example, our observations are values 0 (lost toss) and 1 (won toss) and the average over those 0-1 observations is called the <em>proportion</em> and is denoted by <span class="math inline">\(\hat p\)</span> <em>instead of</em> <span class="math inline">\(\bar x\)</span>. When we deal with proportions, we can calculate the sample variance from its mean <span class="math inline">\(\hat p\)</span> as follows <span class="math display">\[
s^2_{\hat p} = \frac{\hat p(1-\hat p)}{n}.
\]</span> Thus, we know that given our observations and CLT, the sampling distribution of our estimator <span class="math inline">\(\hat{p}\)</span> is normal. Our best guess at the mean <span class="math inline">\(\hat p\)</span> is <span class="math inline">\(19/25 = 0.76\)</span> and variance <span class="math inline">\(s^2 = 0.76(1-0.76)/25 = 0.0073\)</span> <span class="math display">\[
\hat p \sim N(0.76, 0.0073).
\]</span> Then a <span class="math inline">\(95\%\)</span> Confidence Interval is calculated by</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fl">0.76</span> <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.96</span>,<span class="fl">1.96</span>)<span class="sc">*</span><span class="fu">sqrt</span>(<span class="fl">0.0073</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.59 0.93</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Since 0.5 is outside the confidence interval, we say that we do not have enough evidence to say that the coin tosses were fair.</p>
<p>Then we formulate a hypothesis that we are to test. Our status-quo assumption (there is no effect) is called the null hypothesis and is typically denoted by <span class="math inline">\(H_0\)</span>.</p>
<section id="mythbusters-example" class="level3">
<h3 class="anchored" data-anchor-id="mythbusters-example">Mythbusters Example</h3>
<p>While A/B testing is industry-standard for software, the same methodology applies to testing physical phenomena or human behavior, dealing with small sample sizes where uncertainty is higher. In 2006 the creators of Mythbusters TV show on Discovery channel wanted to test whether yawning is contagious in humans. They recruited 50 participants and each of those went through an interview. At the end of 34 randomly selected interviews the interviewer did yawn. Then participants were asked to wait in a next door room. Out of 34 participants from the experimental group, 10 did yawn (29.4%) and only 4 out of 16 (25%) in the control group did yawn. The difference in the proportion of those who did yawn was 4.4%. The show hosts Kari Byron, Tory Belleci and Scottie Chapman concluded that yawn is indeed contagious.</p>
<p>To translate the question from this experiment into language of hypothesis testing, we say that our null hypothesis is that proportion of yawning participants in control (<span class="math inline">\(\hat p_c\)</span>) and experimental group (<span class="math inline">\(\hat p_e\)</span>) is the same <span class="math inline">\(H_0: \hat p_c - \hat p_e = 0\)</span>, and the alternative hypothesis is <span class="math inline">\(H_a: \hat p_c &lt; \hat p_e\)</span>. The goal is to use the data to tell us if the hypothesis is correct or not.</p>
<p>A key statistical fact behind the hypothesis testing is the Central Limit Theorem. It states that if we have a sample <span class="math inline">\(\{x_1,\ldots,x_n\}\)</span> with <span class="math inline">\(n\)</span> observations from any distribution <span class="math inline">\(x_i \sim p(x)\)</span>, then the average of the sample follows a Normal distribution with mean <span class="math inline">\(\mu\)</span> and variance <span class="math inline">\(\sigma^2/n\)</span> <span class="math display">\[
\bar X = \frac{1}{n}\sum_{i=1}^{n}X_i \sim N(\mu, \sigma^2/n)
\]</span></p>
<p>Let us use a simple simulated data set to demonstrate the central limit theorem. We generate 100 outcomes of a Bernoulli trial with <span class="math inline">\(p=0.3\)</span> and calculate the mean of this sample <span class="math inline">\(\hat p\)</span>. We repeat it 2000 times and compare the empirical distribution of <span class="math inline">\(\hat p\)</span> with <span class="math inline">\(N(0.3, 0.046)\)</span>.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="fu">replicate</span>(<span class="dv">2000</span>,<span class="fu">mean</span>(<span class="fu">rbinom</span>(<span class="dv">100</span>,<span class="dv">1</span>,<span class="fl">0.3</span>)))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(a), <span class="at">main=</span><span class="st">""</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>se <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fl">0.3</span><span class="sc">*</span>(<span class="dv">1</span><span class="fl">-0.3</span>)<span class="sc">/</span><span class="dv">100</span>)  <span class="co">#  0.046</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">0.5</span>,<span class="at">length.out =</span> <span class="dv">300</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x,<span class="fu">dnorm</span>(x,<span class="at">mean =</span> <span class="fl">0.3</span>,<span class="at">sd =</span> se), <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="05-ab_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>There are three ways to quantify uncertainty in hypothesis testing. The first approach relies on calculating confidence intervals, as we did for the yawn example. There are two complementary approaches. One is to calculate what is called a <span class="math inline">\(p\)</span>-value, that is the probability of getting the result observed in the data, assuming null-hypothesis is true. If <span class="math inline">\(p\)</span>-value is low, then we reject the null-hypothesis. For the yawn example, the conditional probability that the observed difference in proportions is greater than 0.044, given null hypothesis is true is given by</p>
<p><span class="math display">\[
p\text{-value} = P(\hat p_e - \hat p_c \ge 0.044 \mid H_0),
\]</span> which can be calculated using <code>pnorm</code> function</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="fl">0.044</span>,<span class="dv">0</span>,<span class="fu">sqrt</span>(<span class="fl">0.0177</span>))     </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.37</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The <span class="math inline">\(p\)</span>-value of 0.37 means that there is a 37% chance to observe the difference to be greater than 0.044 assuming the null-hypothesis. It is quite high! We want the <span class="math inline">\(p\)</span>-value to be low, only then we can claim that we have discovered a new fact, i.e.&nbsp;that yawning is contagious. In many applications we require this number to be at most 0.005. The smallest acceptable <span class="math inline">\(p\)</span>-value is called the <em>significance level</em> and is typically denoted as <span class="math inline">\(\alpha\)</span>. We can test the hypothesis at different levels of significance <span class="math inline">\(\alpha\)</span>. Further we assume that the statistic we are analyzing follows the sampling distribution. The probability distribution of the statistics values is either Normal, or <span class="math inline">\(t\)</span>-distribution for continuous variable.</p>
<p>Fundamentally, a statistical hypothesis is a testable statement about a population parameter that can be evaluated using observed data. To summarize the process of testing a significance of our discovery for proportions, we perform the hypothesis testing following the 5-step process.</p>
<ul>
<li><em>Step 1</em>: Formulate the Null Hypothesis (<span class="math inline">\(H_0\)</span>), which we assume to be true unless there is sufficient evidence to the contrary. Then, alternative Hypothesis (<span class="math inline">\(H_1\)</span>): test against the null, e.g.&nbsp;<span class="math inline">\(H_0: p_e - p_c = 0\)</span>, and <span class="math inline">\(H_a: p_e - p_c &gt; 0\)</span>. If there is evidence that <span class="math inline">\(H_0\)</span> is false, we accept <span class="math inline">\(H_1\)</span>.</li>
<li><em>Step 2</em>: Select the significance level <span class="math inline">\(\alpha\)</span>. While <span class="math inline">\(\alpha = 0.05\)</span> (the 5% level) is the most commonly used, <span class="math inline">\(\alpha = 0.01\)</span> (the 1% level) is prevalent in medical and quality assurance examples.</li>
<li><em>Step 3</em>: Compute the Test Statistic (<span class="math inline">\(Z\)</span> or <span class="math inline">\(T\)</span>)</li>
<li><em>Step 4</em>: Formulate the Decision Rule. For example, reject the Null hypothesis if <span class="math inline">\(|Z| &gt; 1.96\)</span></li>
<li><em>Step 5</em>: Make a Decision, Compute the p-value. p-value is the smallest significance level at which a null hypothesis can be rejected. If <span class="math inline">\(p\)</span>-value <span class="math inline">\(&lt;\alpha\)</span>, we have evidence that <span class="math inline">\(H_1\)</span> is true, we accept <span class="math inline">\(H_1\)</span> and claim we have a discovery. If <span class="math inline">\(p\)</span>-value is <span class="math inline">\(\ge \alpha\)</span>, then we cannot reject the null-hypothesis.</li>
</ul>
<p>In Steps 1-2 we formulate the hypothesis. In steps 3-5 we make a decision.</p>
<p>In the context of hypothesis testing, we come back to the type I and type II errors we already discussed. They can be used to describe two types of errors you can make when testing</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Error Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Type I Error</td>
<td>Rejecting a true <span class="math inline">\(H_0\)</span></td>
</tr>
<tr class="even">
<td>Type II Error</td>
<td>Not rejecting a false <span class="math inline">\(H_0\)</span></td>
</tr>
</tbody>
</table>
<p>And the significance level is then <span class="math display">\[
P(\mbox{reject } H_0 \mid H_0 \; \mbox{ true}) =
P(\mbox{type I error}).
\]</span></p>
<p>Hypothesis testing is often used in scientific reporting. For example, the discovery of Higgs Boson was announced as a result of hypothesis testing. Scientists used the five-sigma concept to test the Higgs-Boson hypothesis. This concept, however, is somewhat counter-intuitive. If the particle doesn’t exist, one in 3.5 million is the chance an experiment just like the one announced would nevertheless come up with a result appearing to confirm it does exist. In other words, one in 3.5 million is the likelihood of finding a false positive—a fluke produced by random statistical fluctuation that seems as definitive as the findings released by two teams of researchers at the CERN laboratory in Geneva. So we can talk about the significance level as <span class="math inline">\(p\)</span>-value to be one-in-3.5-million and then the <span class="math inline">\(Z\)</span>-score is five.</p>
<p>The test statistic (<span class="math inline">\(T\)</span> or <span class="math inline">\(Z\)</span>) quantifies uncertainty between the null-hypothesis value and the observed one and is equal to the number of standard deviations they are apart from each other. This value is called the <span class="math inline">\(Z\)</span>-score, and is calculated as <span class="math display">\[
Z = \frac{ \bar{x} - \mu_0 }{s/\sqrt{n}},
\]</span> where <span class="math inline">\(\mu_0\)</span> is the mean assumed under null-hypothesis. The square root of the statistic’s variance <span class="math inline">\(s/\sqrt{n}\)</span> is called standard error and is denoted by <span class="math inline">\(se(\bar X)\)</span>.</p>
<p>Let’s calculate the <span class="math inline">\(Z\)</span>-score for the yawning example. Let <span class="math inline">\(\mu_0 = 0\)</span>, <span class="math inline">\(\hat{p} = \hat p_e - \hat p_c = 0.044\)</span>, <span class="math inline">\(\Var{\hat p }=\Var{\hat p_e - \hat p_c} = 0.0177\)</span>, we get <span class="math inline">\(Z\)</span> statistic to be 0.33. Thus, our observed difference is very close to 0.</p>
<p>To summarize the duality of confidence interval, <span class="math inline">\(p\)</span>-value and <span class="math inline">\(Z\)</span>-score, the following statements are equivalent:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Statement</th>
<th>Condition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0 is inside the 95% confidence interval</td>
<td><span class="math inline">\(p\)</span>-value is greater than 0.05</td>
</tr>
<tr class="even">
<td><span class="math inline">\(p\)</span>-value is greater than 0.05</td>
<td><span class="math inline">\(Z\)</span>-statistic is less than 1.96</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(Z\)</span>-statistic is less than 1.96</td>
<td>0 is inside the 95% confidence interval</td>
</tr>
</tbody>
</table>
<div id="exm-crash1987" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.3 (Stock market crash 1987 (Z-score))</strong></span> Prior to the October, 1987 crash, SP500 monthly returns were 1.2% with a risk/volatility of 4.3%. The question is how extreme was the 1987 crash of <span class="math inline">\(-21.76\)</span>%? <span class="math display">\[
X \sim N \left(1.2, 4.3^2 \right )
\]</span> This probability distribution can be standardized to yield <span class="math display">\[
Z =\frac{X-\mu}{\sigma} = \frac{X - 1.2}{4.3} \sim N(0,1) .
\]</span> Now, we calculate the observed <span class="math inline">\(Z\)</span>, given the outcome of the crash event <span class="math display">\[
Z = \frac{-0.2176 - 0.012}{0.043} = -5.27
\]</span> That is a <span class="math inline">\(5\)</span>-sigma event in terms of the distribution of <span class="math inline">\(X\)</span>. Meaning that -0.2176 is 5 standard deviations away from the mean. Under a normal model that is equivalent to <span class="math inline">\(P(X &lt; -0.2176) = 4.6593\times 10^{-8}\)</span>.</p>
</div>
</section>
<section id="other-applications" class="level3">
<h3 class="anchored" data-anchor-id="other-applications">Other Applications</h3>
<p>Here we consider three examples of hypothesis testing in action: the famous “Coke vs Pepsi” challenge, the dispute over the drug Avonex, and safety statistics for Viagra.</p>
<div id="exm-coke" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.4 (Coke vs Pepsi)</strong></span> The most famous hypothesis test in history in whether people can decide the difference between Coke and Pepsi. We run a double blind experiment, neither the experimenter or subject know the allocation. Pepsi claimed that more than half of Diet Coke drinkers said they preferred to drink Diet Pepsi. That is our null hypothesis. The data comes from a random sample of <span class="math inline">\(100\)</span> drinkers. We find that <span class="math inline">\(56\)</span> favor Pepsi.</p>
<p>This is a hypothesis test about the proportion of drinkers who prefer Pepsi <span class="math display">\[H_0 : p = \frac{1}{2} \; \; \mathrm{ and} \; \; H_1 : p &gt; \frac{1}{2}\]</span> Let’s estimate our statistics form data: <span class="math display">\[\hat{p} = X/n = 56/100 = 0.56\]</span></p>
<p>This is my best estimate of the true <span class="math inline">\(p\)</span>. The standard error of my statistic <span class="math display">\[se(\hat{p}) =  \sqrt{\hat{p}(1-\hat{p})/n} = 0.0496 .\]</span></p>
<p>The <span class="math inline">\(95\)</span>% is then <span class="math display">\[0.56 \pm 1.96 (0.0496) = 0.56 \pm 0.098 = ( 0.463, 0.657 )\]</span> <span class="math inline">\(p=0.5\)</span> lies inside the confidence interval. Pepsi was lying!</p>
<p>The <span class="math inline">\(Z\)</span>-score now with <span class="math inline">\(s_{ \hat{p} }= \sqrt{ p_0(1-p_0)/n} = 0.05\)</span> <span class="math display">\[Z = \frac{ \hat{p} - p_0 }{ s_{\hat{p} }} = \frac{ 0.56-0.5}{0.05} = 1.2 &lt; 1.64\]</span> Let’s take the usual <span class="math inline">\(\alpha = 0.05\)</span>.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.test</span>(<span class="dv">56</span>,<span class="dv">100</span>,<span class="at">alternative=</span><span class="st">'greater'</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>) <span class="sc">%&gt;%</span> <span class="fu">fmt_prop_test</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">est</th>
<th style="text-align: right;">stat</th>
<th style="text-align: right;">p</th>
<th style="text-align: right;">param</th>
<th style="text-align: right;">low</th>
<th style="text-align: right;">high</th>
<th style="text-align: left;">alt</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.56</td>
<td style="text-align: right;">1.2</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">greater</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Don’t reject <span class="math inline">\(H_0\)</span> for a one-sided test at <span class="math inline">\(5\)</span>% level (p-value: 0.14). We need a larger <span class="math inline">\(n\)</span> to come to a more definitive conclusion. We might come to a different conclusion with a larger sample size. One of the downsides of hypothesis testing is that it generates a yes/no answer without having any uncertainty associated with it.</p>
</div>
<div id="exm-Avonex" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.5 (Avonex)</strong></span> Biogen made the following assertion: “Avonex delivers the highest rate of satisfaction: 95% among patients” In response to that statement, the U.S. Food and Drug Administration (FDA) on October 30th, 2002 informed the biotech company Biogen to stop publishing misleading promotions for its multiple sclerosis drug Avonex. To clarify the issue, FDA did run an experiment. The FDA found that in a random sample of <span class="math inline">\(75\)</span> patients surveyed, only 60% said they were satisfied with Avonex. The question is: Who is right?</p>
<p>Let’s use hypothesis testing to get an answer. Following our five-step process to set up a Hypothesis Test: 1. Formulate the Null Hypothesis: <span class="math inline">\(H_0 : p = 0.95 = p_0\)</span>. The alternative hypothesis: <span class="math inline">\(H_1 : p &lt; 0.95\)</span>. A 1-sided alternative. 2. We’ll use a small significance level, 1%. 3. The appropriate test statistic is <span class="math inline">\(Z = -14\)</span>.</p>
<p>To complete our analysis, we need to determine the critical region and calculate the <span class="math inline">\(p\)</span>-value for this test. For a one-sided test at the 1% significance level, the critical region is <span class="math inline">\(Z &lt; -2.32\)</span>. Since our observed test statistic of <span class="math inline">\(Z = -14\)</span> falls well within this rejection region, we reject the null hypothesis.</p>
<p>This procedure can be implemented in <code>R</code> in the <code>prop.test</code> function.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.test</span>(<span class="dv">45</span>,<span class="dv">75</span>,<span class="fl">0.95</span>) <span class="sc">%&gt;%</span> <span class="fu">fmt_prop_test</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">est</th>
<th style="text-align: right;">stat</th>
<th style="text-align: right;">p</th>
<th style="text-align: right;">param</th>
<th style="text-align: right;">low</th>
<th style="text-align: right;">high</th>
<th style="text-align: left;">alt</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.6</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">0.71</td>
<td style="text-align: left;">two.sided</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The p-value is less than <span class="math inline">\(2.2 \times 10^{-16}\)</span>, which is essentially zero. This extremely small <span class="math inline">\(p\)</span>-value provides overwhelming statistical evidence that the FDA is correct and Biogen’s claim is false.</p>
</div>
<div id="exm-Pfizer" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.6 (Pfizer)</strong></span> Pfizer introduced Viagra in early 1998. During <span class="math inline">\(1998\)</span> of the <span class="math inline">\(6\)</span> million Viagra users <span class="math inline">\(77\)</span> died from coronary problems such as heart attacks. Pfizer claimed that this rate is no more than the general population. A clinical study found <span class="math inline">\(11\)</span> out of <span class="math inline">\(1,500,000\)</span> men who were not on Viagra died of coronary problems during the same length of time as the <span class="math inline">\(77\)</span> Viagra users who died in <span class="math inline">\(1998\)</span>. The question is whether the drug is safe. Let’s calculate the confidence interval. A 95% confidence interval for a difference in proportions <span class="math inline">\(p_1 - p_2\)</span> is <span class="math display">\[
( \hat{p}_1 - \hat{p}_2 ) \pm 1.96
\sqrt{ \frac{ \hat{p}_1 ( 1 - \hat{p}_1 ) }{ n_1 }  +
    \frac{ \hat{p}_2 ( 1 - \hat{p}_2 ) }{ n_2 } }
\]</span></p>
<p>We can do a confidence interval or a <span class="math inline">\(Z\)</span>-score test. With Viagra, <span class="math inline">\(\hat{p}_1 = 77/6000000 = 0.00001283\)</span> and without Viagra <span class="math inline">\(\hat{p}_2 = 11/1500000 = 0.00000733\)</span>. We need to test whether these are equal. With a <span class="math inline">\(95\)</span>% confidence interval for <span class="math inline">\((p_1 - p_2)\)</span> you get an interval <span class="math inline">\(( 0.00000549 , 0.0000055).\)</span></p>
<p>Since this confidence interval does not contain zero, we have evidence that the proportion of deaths from coronary problems is significantly higher among Viagra users compared to the general population. Despite the small proportions involved, the measurement is highly accurate due to the large sample sizes in both groups. For hypothesis testing, we would use a one-sided test with a significance level of <span class="math inline">\(\alpha = 0.01\)</span> to test whether the proportion of deaths is higher in the Viagra group. The difference in proportions can be analyzed as follows:</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.test</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">77</span>), <span class="at">n=</span><span class="fu">c</span>(<span class="dv">1500000</span>,<span class="dv">6000000</span>), <span class="at">alternative=</span><span class="st">'greater'</span>,<span class="at">conf.level=</span>.<span class="dv">95</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fmt_prop_test</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">stat</th>
<th style="text-align: right;">p</th>
<th style="text-align: right;">param</th>
<th style="text-align: right;">low</th>
<th style="text-align: right;">high</th>
<th style="text-align: left;">alt</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2.6</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">greater</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The p-value for the Null is <span class="math inline">\(1-0.948 =0.052\)</span>. This p-value is greater than 0.01, so we cannot reject the null hypothesis.</p>
</div>
<div id="exm-Rayleigh" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.7 (Lord Rayleigh’s Argon Discovery)</strong></span> Lord Rayleigh won the Nobel Prize for discovery of Argon. This discovery occurred when he noticed a small discrepancy between two sets of measurements on nitrogen gas that he had extracted from the air and one he had made in the lab.</p>
<p>First, he removed all oxygen from a sample of air. He measured the density of the remaining gas in a fixed volume at constant temperature and pressure. Second, he prepared the same volume of pure nitrogen by the chemical decomposition of nitrous oxide (<span class="math inline">\(N_2 O\)</span>) and nitric oxide <span class="math inline">\(NO\)</span>. Here’s the results. Table on the left shows the measurements. Boxplot on the right shows the distribution of the measurements.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>air <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">2.31017</span>, <span class="fl">2.30986</span>, <span class="fl">2.31010</span>, <span class="fl">2.31001</span>, <span class="fl">2.31024</span>, <span class="fl">2.31010</span>, <span class="fl">2.31028</span>, <span class="cn">NA</span>) <span class="co"># Missing data point</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>decomp <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">2.30143</span>, <span class="fl">2.29890</span>, <span class="fl">2.29816</span>, <span class="fl">2.30182</span>, <span class="fl">2.29869</span>, <span class="fl">2.29940</span>, <span class="fl">2.29849</span>, <span class="fl">2.29889</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="st">"Air"</span><span class="ot">=</span>air,<span class="st">"Chemical Decomposition"</span><span class="ot">=</span>decomp)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(d, <span class="at">booktabs =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(d, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"green"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2" data-null_prefix="true" data-layout-align="center">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Air</th>
<th style="text-align: right;">Chemical.Decomposition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2.3</td>
<td style="text-align: right;">2.3</td>
</tr>
<tr class="even">
<td style="text-align: right;">2.3</td>
<td style="text-align: right;">2.3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2.3</td>
<td style="text-align: right;">2.3</td>
</tr>
<tr class="even">
<td style="text-align: right;">2.3</td>
<td style="text-align: right;">2.3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2.3</td>
<td style="text-align: right;">2.3</td>
</tr>
<tr class="even">
<td style="text-align: right;">2.3</td>
<td style="text-align: right;">2.3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2.3</td>
<td style="text-align: right;">2.3</td>
</tr>
<tr class="even">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2.3</td>
</tr>
</tbody>
</table>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="05-ab_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</div>
<p>Although the averages are very close 2.31 vs 2.30, the small standard deviations (<span class="math inline">\(1.43 \times 10^{-4}\)</span> and <span class="math inline">\(1.38 \times 10^{-3}\)</span>) suggest that the measurements are very precise.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(air,decomp,<span class="at">var.equal=</span>T)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  Two Sample t-test</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="do">## data:  air and decomp</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="do">## t = 20, df = 13, p-value = 0.00000000003</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="do">## alternative hypothesis: true difference in means is not equal to 0</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 95 percent confidence interval:</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  0.0095 0.0118</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="do">## sample estimates:</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="do">## mean of x mean of y </span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="do">##       2.3       2.3</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The t-test confirms that with the t-statistic of 20, the difference is statistically significant. It is a 20-sigma event and we’ve found Argon!</p>
</div>
</section>
</section>
<section id="ab-testing-applications" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="ab-testing-applications"><span class="header-section-number">5.3</span> A/B Testing Applications</h2>
<p>While we have established the foundations of hypothesis testing, let’s look at specific applications in industry.</p>
<div id="exm-simcity" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.8 (SimCity)</strong></span> In the gaming industry, A/B testing is crucial for optimizing revenue. Electronic Arts is a company that makes video games. SimCity 5, one of EA’s most popular video games, sold 1.1 million copies in the first two weeks of its launch. 50% of sales were digital downloads, thanks to a strong A/B testing strategy designed to maximize the conversion rate of pre-orders.</p>
<p>As EA prepared to release the new version of SimCity, they released a promotional offer to drive more game pre-orders. The offer was displayed as a banner across the top of the pre-order page – front-and-center for shoppers. But according to the team, the promotion was not driving the increase in pre-orders they had expected.</p>
<p>They decided to test some other options to see what design or layout would drive more revenue.</p>
<div id="fig-simsity" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-simsity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fig/simcity_original.jpg" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Original</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fig/simcity_variation.jpg" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Variation4</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-simsity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.2: SimCity banner
</figcaption>
</figure>
</div>
<p>One variation removed the promotional offer from the page altogether. The test led to some very surprising results: The variation with no offer messaging whatsoever drove 43.4% more purchases. Data revealed that customers preferred a direct purchase path, indicating that additional incentives were unnecessary.</p>
<p>Most people believe that direct promotions drive purchases, but for EA, this turned out to be totally false. Testing gave them the information needed to maximize revenue in a way that would not have been otherwise possible.</p>
<p>We define the <code>abtestfunc</code> function to examine whether a black or pink background results in more purchases. Run experiment for one week:</p>
<ul>
<li><p>Pink background: <span class="math inline">\(40\)</span>% purchase rate with <span class="math inline">\(500\)</span> visitors</p></li>
<li><p>Black background: <span class="math inline">\(30\)</span>% purchase rate with <span class="math inline">\(550\)</span> visitors</p></li>
</ul>
<p>Let’s run the AB test to see which is more effective, we will calculate the confidence intervals for conversion rates for each variation of site using the <code>abtestfunc</code> function.</p>
<p>The <code>abtestfunc</code>function below calculates CIs (80% significance, <span class="math inline">\(Z=1.28\)</span>).</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>site1 <span class="ot">=</span> <span class="fu">c</span>(.<span class="dv">40</span>, <span class="dv">500</span>) <span class="co"># pink</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>site2 <span class="ot">=</span> <span class="fu">c</span>(.<span class="dv">30</span>, <span class="dv">550</span>) <span class="co"># black</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>abtestfunc <span class="ot">&lt;-</span> <span class="cf">function</span>(ad1, ad2){</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sterror1 <span class="ot">=</span> <span class="fu">sqrt</span>( ad1[<span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>ad1[<span class="dv">1</span>]) <span class="sc">/</span> ad1[<span class="dv">2</span>] )</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>sterror2 <span class="ot">=</span> <span class="fu">sqrt</span>( ad2[<span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>ad2[<span class="dv">1</span>]) <span class="sc">/</span> ad2[<span class="dv">2</span>] )</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>minmax1 <span class="ot">=</span> <span class="fu">c</span>((ad1[<span class="dv">1</span>] <span class="sc">-</span> <span class="fl">1.28</span><span class="sc">*</span>sterror1) <span class="sc">*</span> <span class="dv">100</span>, (ad1[<span class="dv">1</span>] <span class="sc">+</span> <span class="fl">1.28</span><span class="sc">*</span>sterror1) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>minmax2 <span class="ot">=</span> <span class="fu">c</span>((ad2[<span class="dv">1</span>] <span class="sc">-</span> <span class="fl">1.28</span><span class="sc">*</span>sterror2) <span class="sc">*</span> <span class="dv">100</span>, (ad2[<span class="dv">1</span>] <span class="sc">+</span> <span class="fl">1.28</span><span class="sc">*</span>sterror2) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>( <span class="fu">round</span>(minmax1,<span class="dv">2</span>) )</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>( <span class="fu">round</span>(minmax2,<span class="dv">2</span>) )</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abtestfunc</span>(site1, site2)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 37 43</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 28 32</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The confidence intervals are [37, 42] for the pink background and [28, 32] for the black background. Since these intervals do not overlap, we can conclude that the purchase rate for the pink background is significantly higher than for the black background at the 80% confidence level.</p>
</div>
<div id="exm-Mythbusters" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.9 (Mythbusters)</strong></span> We now return to the Mythbusters yawning experiment to analyze it using the standard error of the difference in proportions.</p>
<p>The question is what happens if we are to re-run this experiment several times with different groups of participants, will we see the same difference of 4.4%? The fact is that from one experiment to another calculated proportions of yawners in both groups will be different.</p>
<p>In our example, the proportion of yawners in the experimental group is <span class="math inline">\(\hat p_e = 0.294\)</span> and in the control group is <span class="math inline">\(\hat p_c = 0.25\)</span>. Thus, <span class="math display">\[
\hat \sigma^2_e = 0.294(1-0.294) = 0.208,~~~\hat \sigma^2_c = 0.25(1-0.25) = 0.188
\]</span></p>
<p>We can apply CLT and calculate the uncertainty about <span class="math inline">\(\hat p_{e}\)</span> and <span class="math inline">\(\hat p_{c}\)</span> <span class="math display">\[
\hat p_e\sim N(0.294, 0.208/34),~~~ \hat p_c\sim N(0.25, 0.188/16).
\]</span> Now, instead of comparing proportions (numbers), we can compare their distributions and thus quantify uncertainties. If we plot density functions of those two Normal variables, we can see that although means are different, there is a large overlap of the two density functions.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="fu">seq</span>(<span class="fl">0.0</span>,<span class="fl">0.6</span>, <span class="at">length.out =</span> <span class="dv">200</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p,<span class="fu">dnorm</span>(p,<span class="fl">0.25</span>, <span class="fu">sqrt</span>(<span class="fl">0.188</span><span class="sc">/</span><span class="dv">16</span>)), <span class="at">col=</span><span class="dv">2</span>, <span class="at">type=</span><span class="st">'l'</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">ylab=</span><span class="st">"Density"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(p,<span class="fu">dnorm</span>(p,<span class="fl">0.294</span>, <span class="fu">sqrt</span>(<span class="fl">0.208</span><span class="sc">/</span><span class="dv">34</span>)), <span class="at">col=</span><span class="dv">3</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>))</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="fu">c</span>(<span class="st">"control"</span>, <span class="st">"experiment"</span>), <span class="at">col=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>), <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">bty=</span><span class="st">'n'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="05-ab_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>The amount of overlap is the measure of how certain we are that <span class="math inline">\(p_e\)</span> and <span class="math inline">\(p_c\)</span> are different. Large overlap means we are not very certain if proportions are truly different. For example, both <span class="math inline">\(p_e\)</span> and <span class="math inline">\(p_c\)</span> have a high probability of being between 0.2 and 0.4. We can use properties of normal distribution to say specifically what is the amount of this overlap by calculating the corresponding 95% confidence interval of the difference between the proportions. Note that the difference of two Normal random variables is another Normal <span class="math display">\[
\hat p_e - \hat p_c \sim N(0.294 - 0.25, 0.208/34 + 0.188/16) = N(0.044, 0.0177)
\]</span> Now we can calculate 95% confidence interval for <span class="math inline">\(\hat p_e - \hat p_c\)</span>, again using properties of Normal</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fl">0.044</span> <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.96</span>,<span class="fl">1.96</span>)<span class="sc">*</span><span class="fu">sqrt</span>(<span class="fl">0.0177</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="do">## -0.22  0.30</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The interval is wide and most importantly, it does contain 0. Thus, we cannot say for sure that the proportions are different. They might just appear to be different due to chance (sampling error). Meaning, that if we are to re-run the experiment we should expect the difference to be anywhere between -0.22 and 0.31 in 95% of the cases.</p>
<p>Thus, statistical analysis does not confirm the conclusion made by the show hosts and indicates that there is no evidence that the proportion of yawners is different between the control and experimental groups.</p>
</div>
<div id="exm-googe" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.10 (Search algorithm)</strong></span> For tech giants, even small improvements in metrics can lead to massive gains. Let’s look at another example and test effectiveness of Google’s new search algorithm. We measure effectiveness by the number of users who clicked on one of the search results. As users send the search requests, they will be randomly processed with Algo 1 or Algo 2. We wait until 2500 search requests were processed by each of the algorithms and calculate the following table based on how often people clicked through</p>
<table class="caption-top table">
<caption>Google Search Algorithm</caption>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">Algo1</th>
<th style="text-align: center;">Algo2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>success</td>
<td style="text-align: center;">1755</td>
<td style="text-align: center;">1828</td>
</tr>
<tr class="even">
<td>failure</td>
<td style="text-align: center;">745</td>
<td style="text-align: center;">682</td>
</tr>
<tr class="odd">
<td>total</td>
<td style="text-align: center;">2500</td>
<td style="text-align: center;">2500</td>
</tr>
</tbody>
</table>
<p>The probability of success is estimated to be <span class="math inline">\(\hat{p}_1 = 1755/2500 = 0.702\)</span> for the current algorithm and <span class="math inline">\(\hat{p}_2 = 1828/2500 = 0.731\)</span> for the new algorithm. We can calculate the 95% confidence interval or 95% Bayesian credible region for both estimated proportions.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> <span class="dv">1755</span><span class="sc">/</span><span class="dv">2500</span>; p2 <span class="ot">=</span> <span class="dv">1828</span><span class="sc">/</span><span class="dv">2500</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>Algo1 <span class="ot">=</span> <span class="fu">round</span>(p1 <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.96</span>,<span class="fl">1.96</span>)<span class="sc">*</span><span class="fu">sqrt</span>(p1<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p1)<span class="sc">/</span><span class="dv">2500</span>), <span class="dv">3</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>Algo2 <span class="ot">=</span> <span class="fu">round</span>(p2 <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.96</span>,<span class="fl">1.96</span>)<span class="sc">*</span><span class="fu">sqrt</span>(p2<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p2)<span class="sc">/</span><span class="dv">2500</span>), <span class="dv">3</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">rbind</span>(Algo1, Algo2), <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Lower"</span>, <span class="st">"Upper"</span>), <span class="at">caption =</span> <span class="st">"95% Confidence Interval for the Proportions"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>95% Confidence Interval for the Proportions</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Lower</th>
<th style="text-align: right;">Upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Algo1</td>
<td style="text-align: right;">0.68</td>
<td style="text-align: right;">0.72</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algo2</td>
<td style="text-align: right;">0.71</td>
<td style="text-align: right;">0.75</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Given that the intervals do slightly overlap, there is not enough evidence to say that algorithms are different, and the new Algo 2 is not necessarily more efficient.</p>
<p>We will get a slightly more precise estimation of uncertainty if we calculate confidence interval for the difference of the proportions. Since <span class="math inline">\(p_1\)</span> and <span class="math inline">\(p_2\)</span> both follow Normal distribution, their difference is also normally distributed <span class="math display">\[
p_1 - p_2 \sim N(\hat p_1 - \hat p_2, s_1^2/n + s_2^2/n).
\]</span> Applying this formula for the Google search algorithm experiment, we calculate the 95% confidence interval for the difference</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>diff <span class="ot">=</span> p1 <span class="sc">-</span> p2  <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.96</span>,<span class="fl">1.96</span>)<span class="sc">*</span><span class="fu">sqrt</span>(p1<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p1)<span class="sc">/</span><span class="dv">2500</span> <span class="sc">+</span> p2<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p2)<span class="sc">/</span><span class="dv">2500</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(diff, <span class="at">digits =</span> <span class="dv">5</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="do">## -0.0541696 -0.0042304</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The confidence interval for the difference does not contain 0, and thus we can say that we are confident that algorithms are different!</p>
<p>More generally, if the number of observations in two groups are different, say <span class="math inline">\(n_1\)</span> and <span class="math inline">\(n_2\)</span> then the <span class="math display">\[
s_{ \bar{X}_1 - \bar{X}_2 } = \sqrt{ \frac{ s^2_{ \bar{X}_1 }}{n_1} + \frac{ s^2_{ \bar{X}_2 }}{n_2} }
\]</span> or for proportions, we compute <span class="math display">\[
s_{ \hat{p}_1 - \hat{p}_2 } = \sqrt{ \frac{ \hat{p}_1 (1- \hat{p}_1)}{n_1} + \frac{ \hat{p}_2 (1- \hat{p}_2)}{n_2} }.
\]</span></p>
</div>
<div id="exm-google-unequal" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.11 (Search Algorithm with Unequal Sample Sizes)</strong></span> Let’s consider a variation of the previous example where the sample sizes are different. Suppose we have the following data:</p>
<table class="caption-top table">
<caption>Google Search Algorithm with Unequal Sample Sizes</caption>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">Algo1</th>
<th style="text-align: center;">Algo2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>success</td>
<td style="text-align: center;">1824</td>
<td style="text-align: center;">1867</td>
</tr>
<tr class="even">
<td>failure</td>
<td style="text-align: center;">776</td>
<td style="text-align: center;">683</td>
</tr>
<tr class="odd">
<td>total</td>
<td style="text-align: center;">2600</td>
<td style="text-align: center;">2550</td>
</tr>
</tbody>
</table>
<p>The probability of success is estimated to be <span class="math inline">\(\hat{p}_1 = 1824/2600 = 0.702\)</span> for Algo1 and <span class="math inline">\(\hat{p}_2 = 1867/2550 = 0.732\)</span> for Algo2. Now we calculate the 95% confidence interval for the difference in proportions using the formula for unequal sample sizes:</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> <span class="dv">1824</span><span class="sc">/</span><span class="dv">2600</span>; p2 <span class="ot">=</span> <span class="dv">1867</span><span class="sc">/</span><span class="dv">2550</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>diff <span class="ot">=</span> p1 <span class="sc">-</span> p2  <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.96</span>,<span class="fl">1.96</span>)<span class="sc">*</span><span class="fu">sqrt</span>(p1<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p1)<span class="sc">/</span><span class="dv">2600</span> <span class="sc">+</span> p2<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p2)<span class="sc">/</span><span class="dv">2550</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(diff, <span class="at">digits =</span> <span class="dv">5</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="do">## -0.0552111 -0.0060257</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The confidence interval for the difference does not contain 0, and thus we can say that we are confident that algorithms are different!</p>
</div>
</section>
<section id="challenges-in-ab-testing" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="challenges-in-ab-testing"><span class="header-section-number">5.4</span> Challenges in A/B Testing</h2>
<section id="multiple-testing" class="level3">
<h3 class="anchored" data-anchor-id="multiple-testing">Multiple Testing</h3>
<p>Consider this simple multiple-testing scenario. If we want to test 1000 hypotheses and we test each hypothesis one-by-one, say the ground truth is that only 10% (100) of those hypotheses are true. Using <span class="math inline">\(\alpha=0.05\)</span> rule, we assume that out of 900 false hypotheses <span class="math inline">\(0.05 \cdot 900 = 45\)</span> will show up as positive (false positives). Now we run our one-by-one hypothesis tests and our procedure correctly identified 80 out of 100 true positives and incorrectly identified 45 false positives and 20 false negatives. Now, among 125 hypotheses identified as positives 45 in fact are not! Another way to look at it is to calculate the probability of at least one false positive <span class="math inline">\(P(\mbox{at least one false positive}) = 1 - (1-0.05)^{1000} = 1\)</span>. We are almost guaranteed to see at least one false positive.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">1</span> <span class="sc">-</span> (<span class="dv">1</span><span class="fl">-0.05</span>)<span class="sc">^</span>{<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>}, <span class="at">type=</span><span class="st">'l'</span>, <span class="at">ylab=</span><span class="st">"False Positive Rate"</span>, <span class="at">xlab=</span><span class="st">"Number of Tests"</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="05-ab_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="576"></p>
<figcaption>Probability of At Least 1 False Positive</figcaption>
</figure>
</div>
</div>
</div>
<p>One way to deal with the problem is to lower the cut-off to <span class="math inline">\(\alpha/n\)</span>. This approach is called the Bonferroni correction. For the case of 1000 hypotheses we set <span class="math inline">\(\alpha = 0.00005\)</span>. However this conservative approach will lead to many false negatives. The probability of identifying at least one significant result is then <span class="math inline">\(1 - (1-0.00005)^{1000} = 0.049\)</span></p>
<table class="caption-top table">
<caption>Classification of results for a testing procedure. T/F = True/False, D/N = Discovery/Non-discovery. We observe <span class="math inline">\(m\)</span>, <span class="math inline">\(D\)</span> and <span class="math inline">\(N\)</span>.</caption>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;"><span class="math inline">\(H_0\)</span> Accepted</th>
<th style="text-align: center;"><span class="math inline">\(H_0\)</span> Rejected</th>
<th style="text-align: center;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(H_0\)</span> True</td>
<td style="text-align: center;">TN</td>
<td style="text-align: center;">FD</td>
<td style="text-align: center;"><span class="math inline">\(T_0\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(H_0\)</span> False</td>
<td style="text-align: center;">FN</td>
<td style="text-align: center;">TD</td>
<td style="text-align: center;"><span class="math inline">\(T_1\)</span></td>
</tr>
<tr class="odd">
<td>Total</td>
<td style="text-align: center;"><span class="math inline">\(N\)</span></td>
<td style="text-align: center;"><span class="math inline">\(D\)</span></td>
<td style="text-align: center;"><span class="math inline">\(m\)</span></td>
</tr>
</tbody>
</table>
<p>A more practical approach is to use the <em>False Discovery Rate</em> <span class="math display">\[
\text{FDR} = \E{\frac{FD}{D}}
\]</span> which is the proportion of false positives among all significant results. We aim to set a cutoff so that FDR <span class="math inline">\(&lt; Q\)</span>. The FDR approach allows us to increase the power while maintaining some principled bound on error.</p>
<p>Benjamini and Hochberg developed a procedure based on FDR to perform multiple testing. Under their procedure, we put individual <span class="math inline">\(p\)</span>-values in order from smallest to largest. Then we choose the largest <span class="math inline">\(p_k\)</span> value that is smaller than <span class="math inline">\((k/m)/Q\)</span> where <span class="math inline">\(Q\)</span> is the false discovery rate you choose. Then all hypotheses with index <span class="math inline">\(i&lt;k\)</span> are significant. Benjamini and Hochberg showed that under this procedure the FDR <span class="math inline">\(&lt;Q\)</span>.</p>
<p>As an example, <span class="citation" data-cites="garcia-arenzana2014calorie">García-Arenzana et al. (<a href="references.html#ref-garcia-arenzana2014calorie" role="doc-biblioref">2014</a>)</span> tested associations of 25 dietary variables with mammographic density, an important risk factor for breast cancer, in Spanish women. They found the following results:</p>
<div class="cell" data-layout-align="center" data-null_prefix="true" data-tab-cap="Dietary Risk Factors of Cancer">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"../data/cancer-diet.csv"</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(d[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,], <span class="at">booktabs =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Dietary Risk Factors of Cancer</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Label</th>
<th style="text-align: right;">p.value</th>
<th style="text-align: right;">Rank</th>
<th style="text-align: right;">BH</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Total calories</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="even">
<td style="text-align: left;">Olive oil</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.02</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Whole milk</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.03</td>
</tr>
<tr class="even">
<td style="text-align: left;">White meat</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.04</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Proteins</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.05</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>If we choose <span class="math inline">\(Q = 0.25\)</span>, then <span class="math inline">\(k=5\)</span> (Proteins) is our cut-off rank. Thus we reject <span class="math inline">\(H_0\)</span> for the first five tests. Note that traditional hypothesis testing procedure only controls for Type 1 error and FDR-based procedure controls for both error types.</p>
</section>
</section>
<section id="sec-ab-rct" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="sec-ab-rct"><span class="header-section-number">5.5</span> Randomized experiments and Causality</h2>
<p>Florence Nightingale (1820-1910), widely known for her role in the Crimean War, was also a pioneering statistician and a champion of evidence-based medicine. She can be considered the mother of observational studies. To her, every piece of legislation was an experiment in the laboratory of society deserving study and demanding evaluation. Nightingale recognized the importance of collecting accurate and reliable data to understand healthcare outcomes. She developed standardized methods for collecting data on hospital admissions, deaths, causes of death, and other relevant factors. This systematic data collection allowed for more rigorous and reliable analysis of healthcare practices and their impact on patient outcomes. During the Crimean War (1853-1856), she collected and analyzed data on mortality rates among soldiers. She created statistical diagrams, such as the famous polar area diagram or “coxcomb,” to illustrate the causes of mortality. These visual representations helped to convey complex information in a clear and understandable way. Nightingale’s observations and statistical analyses led her to emphasize the importance of sanitation and hygiene in healthcare settings. She advocated for improvements in cleanliness, ventilation, and sanitation in hospitals, recognizing the impact of these factors on the health and well-being of patients. Beyond the battlefield, Nightingale continued her work in public health. She used statistical evidence to advocate for healthcare reforms and improvements in public health infrastructure. Her efforts played a crucial role in shaping public health policies and practices.</p>
<p>The work of Nightingale would nowadays be classified as an observational study. An observational study is a research design where researchers observe and collect data on existing groups of people or phenomena without intervening or manipulating any variables. Unlike randomized controlled trials, researchers do not assign participants to different groups and do not directly influence the outcome.</p>
<p>In contrast, George Washington (1732-1799) advanced agriculture through rigorous experimentation, employing methods remarkably similar to modern controlled experiments. He was deeply interested in improving agricultural techniques and conducted numerous experiments at his Mount Vernon estate. One of his most notable experiments involved dividing his land into plots and testing different crop rotations and fertilization methods. Washington recognized the importance of sustainable agriculture and the detrimental effects of monoculture (growing the same crop year after year) on soil fertility. He observed how tobacco, his primary cash crop at the time, depleted the soil nutrients, leading to diminishing yields. To address this issue and improve the long-term health of his land, he began experimenting with crop rotation and soil management techniques.</p>
<p>Washington divided his land into several plots, each receiving different treatments. He experimented with various crop rotations, including wheat-fallow, wheat-rye-fallow, and corn-wheat-fallow. These rotations aimed to prevent soil depletion and promote its natural restoration by planting nitrogen-fixing crops like rye and clover. He also tested different fertilizer applications on various plots. He used manure, compost, and even imported materials like gypsum and marl to improve soil fertility and crop yields.</p>
<p>Washington meticulously documented his experiments in his agricultural diaries. He recorded planting dates, yields, weather conditions, and observations on crop growth and soil health. This meticulous record-keeping allowed him to analyze the effectiveness of different treatments and compare their impact on crop yields and soil quality.</p>
<p>Washington’s experiments yielded valuable insights into sustainable agricultural practices. He discovered that crop rotation and fertilization improved soil health and increased crop yields over time. He abandoned tobacco as his primary crop and shifted towards wheat, which was less soil-depleting and offered a more stable income source.</p>
<p>The historic trades staff at Mount Vernon have recreated Washington’s experiment at the Pioneer Farm, using the same plot layout, crops, and fertilization methods described in his diaries. This allows visitors to learn about his innovative farming techniques and their impact on the land. <a href="#fig-gw" class="quarto-xref">Figure&nbsp;<span>5.3</span></a> shows the plot layout at the Pioneer Farm.</p>
<!-- https://www.mountvernon.org/george-washington/farming/re-creating-a-washington-farming-experiment/#:~:text=George%20Washington%20often%20used%20experimental,wheat%2C%20oats%2C%20and%20barley. -->
<div id="fig-gw" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-gw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="fig/mv.jpeg" class="img-fluid figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.3: Plot layout at the Mount Vernon’s Pioneer Farm
</figcaption>
</figure>
</div>
<p>George Washington’s commitment to experimentation and innovation made him a pioneer in American agriculture. His plot-based experiments demonstrated the effectiveness of crop rotation and soil management in promoting sustainable farming practices. His work continues to inspire farmers today and serves as a valuable resource for understanding agricultural history and best practices.</p>
<p>Later, at the turn of the 20th century, Ronald Fisher (1890-1962) developed the theory of experimental design which allowed for controlled experiments, known as randomized controlled trials (RCT). Fisher’s work laid the foundation for modern experimental design and analysis, providing a rigorous statistical framework for conducting randomized controlled trials. His contributions to experimental design and ANOVA were crucial in establishing the importance of randomized trials in research. He emphasized the importance of randomization and control groups in experimental design, recognizing their crucial role in establishing causal relationships.</p>
<section id="the-question-of-causation" class="level3">
<h3 class="anchored" data-anchor-id="the-question-of-causation">The question of causation</h3>
<p>Randomized controlled trials (RCTs) and field experiments are widely considered the gold standard for establishing causation because they allow researchers to isolate the effect of a specific intervention or treatment from other confounding factors. The main principle of RCTs and field experiments is randomization, which ensures that the treatment and control groups are similar in all respects except for the treatment. This allows researchers to attribute any differences in outcomes between the two groups to the treatment, rather than to other factors.</p>
<p>Randomization helps to control for confounding variables, which are factors that are associated with both the treatment and the outcome variable. By randomly assigning participants to groups, researchers can ensure that any confounding variables are evenly distributed between the groups. The control group serves as a baseline for comparison. It is a group that is not exposed to the treatment or intervention being studied. By comparing the outcomes of the treatment group and the control group, researchers can isolate the effect of the treatment. Any differences in the outcomes between the two groups can be attributed to the treatment.</p>
<p>From a Bayesian modeling perspective, randomization is a practical route to approximate exchangeability between groups, making comparisons less sensitive to unobserved confounding (<a href="03-bl.html" class="quarto-xref"><span>Chapter 3</span></a>).</p>
<p>The modern randomized controlled trial (RCT) in medicine is most often attributed to Sir Austin Bradford Hill. In 1948, Hill published a landmark paper titled “Streptomycin Treatment of Pulmonary Tuberculosis” in the British Medical Journal, which described the first fully randomized, double-blind clinical trial. This study is considered a turning point in the history of medical research and established the RCT as the gold standard for evaluating the effectiveness of medical treatments.</p>
<p>Randomized trials and observational studies are two distinct approaches to gathering and analyzing data in research studies. Here’s a breakdown of their key differences:</p>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="column quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<section id="randomized-trials" class="level4">
<h4 class="anchored" data-anchor-id="randomized-trials">Randomized trials</h4>
<ul>
<li><em>Definition</em>: Participants are randomly assigned to different groups, with one group receiving the intervention being studied and the other group receiving a control intervention or placebo.</li>
<li><em>Purpose</em>: Determine whether the intervention causes the observed outcome by controlling for other factors that might influence the results.</li>
<li><em>Strengths</em>: High internal validity, strong causal inference due to randomization, allows for isolating the effect of the intervention, minimizes selection bias through random assignment.</li>
<li><em>Weaknesses</em>: Can be expensive and time-consuming to conduct, may not be ethical or feasible for all interventions, may not be generalizable to real-world settings.</li>
</ul>
</section>
</div>
<div class="column quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<section id="observational-data" class="level4">
<h4 class="anchored" data-anchor-id="observational-data">Observational data</h4>
<ul>
<li><em>Definition</em>: Data is collected on existing groups of people without any intervention being implemented. Researchers observe and analyze the data to identify relationships between variables.</li>
<li><em>Purpose</em>: Explore potential associations between variables, generate hypotheses for further research, and investigate the natural course of a phenomenon.</li>
<li><em>Strengths</em>: Often less expensive and time-consuming, can provide insights into real-world settings, can investigate interventions that are not ethically feasible to test in randomized trials.</li>
<li><em>Weaknesses</em>: Lower internal validity, susceptibility to confounding variables, cannot establish causal relationships conclusively.</li>
</ul>
</section>
</div>
</div>
</div>
<p>If you happen to have a choice between randomized trials and observational data (often you do not have that choice), which one should you choose? Consider the following:</p>
<ul>
<li><em>Research question</em>: If the research question aims to establish causation, a randomized trial is generally preferred. However, if the goal is to explore associations or generate hypotheses, observational data may be sufficient.</li>
<li><em>Available resources</em>: Randomized trials require significant resources, while observational studies can be less expensive and time-consuming.</li>
<li><em>Ethical considerations</em>: Randomizing individuals to certain interventions may be unethical, making observational data the only option.</li>
<li><em>Generalizability</em>: Randomized trials often involve carefully controlled environments, which may limit their generalizability to real-world settings. Observational data can provide insights into how interventions work in real-world situations.</li>
</ul>
<p>Ultimately, both randomized trials and observational data play crucial roles in research. Combining these two approaches provides a more comprehensive understanding of the relationship between interventions and outcomes.</p>
<div id="exm-russianfraud" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.12 (Russian election fraud: a field experiment)</strong></span> <span class="citation" data-cites="enikolopov2013field">Enikolopov et al. (<a href="references.html#ref-enikolopov2013field" role="doc-biblioref">2013</a>)</span> show how a field experiment can be used to estimate electoral fraud in Russian parliamentary elections held on December 4, 2011. They randomly assigned independent observers to 156 of 3,164 polling stations in the city of Moscow. The observers were trained by the nongovernmental organization Citizen Observer. The authors compared the vote shares of the incumbent United Russia party at polling stations with and without observers. They found that the presence of observers decreased the reported vote share of United Russia by almost 11 percentage points. This suggests that the extent of the fraud was sufficient to have changed the outcome of the elections.</p>
<div class="cell" data-layout-nrow="3" data-layout-align="center" data-null_prefix="true">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"../data//PNAS_data_2011.csv"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>er_share, <span class="at">fill=</span><span class="fu">as.factor</span>(s))) <span class="sc">+</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha=</span><span class="fl">0.6</span>, <span class="at">color=</span><span class="st">"#e9ecef"</span>) <span class="sc">+</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">""</span>) <span class="sc">+</span> </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span> </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"#69b3a2"</span>, <span class="st">"#404080"</span>)) </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>turnout_share, <span class="at">fill=</span><span class="fu">as.factor</span>(s))) <span class="sc">+</span> </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha=</span><span class="fl">0.6</span>, <span class="at">color=</span><span class="st">"#e9ecef"</span>) <span class="sc">+</span> </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">""</span>) <span class="sc">+</span> </span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span> </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"#69b3a2"</span>, <span class="st">"#404080"</span>)) </span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>apple_share, <span class="at">fill=</span><span class="fu">as.factor</span>(s))) <span class="sc">+</span> </span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha=</span><span class="fl">0.6</span>, <span class="at">color=</span><span class="st">"#e9ecef"</span>) <span class="sc">+</span> </span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">""</span>) <span class="sc">+</span> </span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span> </span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"#69b3a2"</span>, <span class="st">"#404080"</span>)) </span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>sr_share, <span class="at">fill=</span><span class="fu">as.factor</span>(s))) <span class="sc">+</span> </span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha=</span><span class="fl">0.6</span>, <span class="at">color=</span><span class="st">"#e9ecef"</span>) <span class="sc">+</span> </span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">""</span>) <span class="sc">+</span> </span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span> </span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"#69b3a2"</span>, <span class="st">"#404080"</span>)) </span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>ldpr_share, <span class="at">fill=</span><span class="fu">as.factor</span>(s))) <span class="sc">+</span> </span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha=</span><span class="fl">0.6</span>, <span class="at">color=</span><span class="st">"#e9ecef"</span>) <span class="sc">+</span> </span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">""</span>) <span class="sc">+</span> </span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span> </span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"#69b3a2"</span>, <span class="st">"#404080"</span>)) </span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>com_share, <span class="at">fill=</span><span class="fu">as.factor</span>(s))) <span class="sc">+</span> </span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha=</span><span class="fl">0.6</span>, <span class="at">color=</span><span class="st">"#e9ecef"</span>) <span class="sc">+</span> </span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill=</span><span class="st">""</span>) <span class="sc">+</span> </span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"beta"</span>) <span class="sc">+</span> </span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"#69b3a2"</span>, <span class="st">"#404080"</span>)) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="fig-russianfraud" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-russianfraud-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-russianfraud" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-russianfraud-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-russianfraud-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05-ab_files/figure-html/fig-russianfraud-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-ref-parent="fig-russianfraud" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-russianfraud-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) United Russia Share
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-russianfraud" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-russianfraud-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-russianfraud-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05-ab_files/figure-html/fig-russianfraud-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-ref-parent="fig-russianfraud" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-russianfraud-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Turnout Share
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-russianfraud" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-russianfraud-3" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-russianfraud-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05-ab_files/figure-html/fig-russianfraud-3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-ref-parent="fig-russianfraud" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-russianfraud-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Yabloko Share
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-russianfraud" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-russianfraud-4" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-russianfraud-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05-ab_files/figure-html/fig-russianfraud-4.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-ref-parent="fig-russianfraud" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-russianfraud-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d) Just Russia Share
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-russianfraud" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-russianfraud-5" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-russianfraud-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05-ab_files/figure-html/fig-russianfraud-5.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-ref-parent="fig-russianfraud" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-russianfraud-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(e) LDPR Share
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-russianfraud" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-russianfraud-6" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-russianfraud-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05-ab_files/figure-html/fig-russianfraud-6.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-ref-parent="fig-russianfraud" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-russianfraud-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(f) Communists Share
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-russianfraud-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.4: Histogram comparison of the share of votes received by different parties and the share of those eligible voters who actually voted (turnout)
</figcaption>
</figure>
</div>
</div>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>dl <span class="ot">=</span> d <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">"_share"</span>),s,uik)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>dl <span class="ot">=</span> dl <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(er_share,apple_share,turnout_share,sr_share,ldpr_share,com_share),<span class="at">names_to =</span> <span class="st">"party"</span>,<span class="at">values_to =</span> <span class="st">"share"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> dl <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(party,s) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mu =</span> <span class="fu">mean</span>(share),<span class="at">sd =</span> <span class="fu">sd</span>(share)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">n</span>()))</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df2, <span class="fu">aes</span>(<span class="at">x=</span>party, <span class="at">y=</span>mu, <span class="at">fill=</span><span class="fu">as.factor</span>(s)))<span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>, <span class="at">color =</span> <span class="st">"#e9ecef"</span>, <span class="at">position=</span><span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>mu<span class="fl">-2.58</span><span class="sc">*</span>sd, <span class="at">ymax=</span>mu<span class="fl">+2.58</span><span class="sc">*</span>sd), <span class="at">width=</span>.<span class="dv">2</span>,<span class="at">position=</span><span class="fu">position_dodge</span>(.<span class="dv">9</span>)) <span class="sc">+</span> </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#69b3a2"</span>, <span class="st">"#404080"</span>),<span class="at">name =</span> <span class="st">""</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Control group"</span>, <span class="st">"Treatment Group"</span>)) <span class="sc">+</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Yabloko"</span>, <span class="st">"Communist"</span>, <span class="st">"United Russia"</span>, <span class="st">"LDPR"</span>, <span class="st">"Just Russia"</span>, <span class="st">"Turnout"</span>)) <span class="sc">+</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Mean Share"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>, <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="sc">-</span><span class="dv">5</span>), <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="sc">-</span><span class="dv">10</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-russianfraud2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-russianfraud2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05-ab_files/figure-html/fig-russianfraud2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="624">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-russianfraud2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.5: Bar plot comparison of the share of votes received by different parties and the share of those eligible voters who actually voted (turnout)
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-russianfraud" class="quarto-xref">Figure&nbsp;<span>5.4</span></a> and <a href="#fig-russianfraud2" class="quarto-xref">Figure&nbsp;<span>5.5</span></a> show the results of the experiments and plot histograms of the vote shares. The first histogram compares the share of the ruling United Russia party at the polling stations without observers (treatment = 0) and with observers (treatment = 1). On average, United Russia vote share is decreased by 11 percent when observers were present. The calculations made by <span class="citation" data-cites="enikolopov2013field">Enikolopov et al. (<a href="references.html#ref-enikolopov2013field" role="doc-biblioref">2013</a>)</span> showed that this amount of manipulation was enough to preserve the majority of United Russia in the parliament; it would have lost it without manipulations. While “adding” votes for UR, the results indicate that all other parties were hurt by electoral fraud. The Liberal Democratic Party of Russia (LDPR) was hurt the least and is believed to be the most loyal to the ruling party.</p>
</div>
<div id="exm-pollution" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.13 (Pollution in India)</strong></span> Randomized Controlled Trials (RCTs) have revolutionized economic research and policy-making by providing a rigorous methodology to establish causal relationships between interventions and outcomes. The 2019 Nobel Prize in Economics awarded to Esther Duflo, Abhijit Banerjee, and Michael Kremer recognized their pioneering work in applying experimental approaches to alleviating global poverty and transforming development economics. Their experimental approach has fundamentally changed how economists tackle complex social problems by breaking them down into smaller, more manageable questions that can be answered through carefully designed experiments.</p>
<p>The paper “Truth-telling by Third-party Auditors and the Response of Polluting Firms: Experimental Evidence from India” by Duflo, Greenstone, Pande, and Ryan exemplifies this experimental approach. This two-year field experiment conducted in Gujarat, India, examined how altering the market structure for environmental audits could improve the accuracy of pollution reporting and ultimately reduce industrial pollution. The study demonstrates how RCTs can identify causal mechanisms in complex regulatory environments and provide evidence for effective policy reforms.</p>
<p>The researchers randomly assigned 473 industrial plants to either a treatment or control group. In the treatment group, they implemented a package of reforms to the environmental audit system:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 38%">
<col style="width: 61%">
</colgroup>
<thead>
<tr class="header">
<th>Reform</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><em>Random Assignment</em></td>
<td>Auditors were randomly assigned to plants (rather than plants choosing their auditors)</td>
</tr>
<tr class="even">
<td><em>Central Payment</em></td>
<td>Auditors were paid from a central pool at a fixed rate</td>
</tr>
<tr class="odd">
<td><em>Random Backchecks</em></td>
<td>Independent technical agencies conducted random backchecks of auditor reports</td>
</tr>
<tr class="even">
<td><em>Incentive Pay</em></td>
<td>In the second year, incentive pay was provided for accurate reporting</td>
</tr>
</tbody>
</table>
<p>In the control group, auditors were paid by the plants they audited. This created a blatant conflict of interest: plants could simply hire auditors who would provide favorable reports, leading to systematic misreporting of pollution levels. In contrast, the treatment group broke this client-auditor relationship by paying auditors from a central pool and independently verifying their work. The random backchecks served as a robust deterrent against misreporting, while the incentive pay further encouraged honesty.</p>
<p>Further, researchers performed backchecks, which are independent verification. Backchecks are follow-up visits conducted by independent technical agencies to verify the accuracy of pollution readings reported by third-party auditors. They serve as a quality control mechanism to monitor whether auditors are truthfully reporting actual pollution levels or manipulating data to show false compliance with regulatory standards.</p>
<p>The figure below (copied from the original paper) displays the distribution of Suspended Particulate Matter (SPM) concentrations measured in boiler-stack samples during the midline survey. Left plot presents the distributions of readings from both audits and backchecks at control plants, while right plot presents the corresponding distributions for treatment plants. A vertical line indicates the regulatory maximum concentration limit of 150 mg/N m3 for SPM, with the region between 75% and 100% of this limit highlighted in gray shading.</p>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fig/control-plants.jpg" class="img-fluid figure-img"></p>
<figcaption>Control plants</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fig/treatment-plants.jpg" class="img-fluid figure-img"></p>
<figcaption>Treatment plants</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>This figure clearly demonstrates how the RCT revealed systematic misreporting in the status quo audit system and how the treatment intervention improved reporting accuracy. The stark difference between audit reports and backcheck readings in the control group (Panel A) provides visual evidence of corruption that would have been difficult to establish through observational methods alone.</p>
<p>The experiment yielded three main results. First, regarding status quo corruption, under the existing system, auditors systematically reported plant emissions just below the regulatory standard, even though true emissions were typically higher. Second, the treatment improved reporting accuracy, causing auditors to report pollution levels more truthfully, with treatment auditors reporting pollution readings 50-70% higher than control auditors. Third, plants in the treatment group reduced their actual emissions by 0.21 standard deviations, with reductions concentrated among the highest-polluting plants.</p>
<p>The work of Duflo, Banerjee, Kremer, and their collaborators has fundamentally changed how economists approach questions of causality and policy effectiveness. By adapting experimental methods from medical research to address economic and social questions, they have created a powerful toolkit for identifying effective interventions to address poverty and other global challenges.</p>
<p>The Gujarat environmental audit experiment exemplifies how RCTs can uncover hidden mechanisms—in this case, corruption in regulatory reporting—and test solutions that might not have been evident from observational data alone. The study’s findings demonstrate that reformed incentives for third-party auditors can improve their reporting and make regulation more effective, with tangible benefits for environmental quality.</p>
<p>As RCTs continue to evolve and spread across different domains of economics, they promise to further strengthen the evidence base for policy decisions, ultimately leading to more effective interventions and better outcomes for society.</p>
</div>
</section>
<section id="split-plot-designs-and-rothamsted" class="level3">
<h3 class="anchored" data-anchor-id="split-plot-designs-and-rothamsted">Split-plot designs and Rothamsted</h3>
<p>While Fisher championed randomization, practical constraints in agriculture often made complete randomization difficult. At the Rothamsted Experimental Station, where Fisher worked, researchers frequently encountered situations where some factors were difficult or expensive to randomize across small individual plots, while others were easy.</p>
<p>For example, consider an experiment testing the effects of two factors: irrigation methods (Factor A) and fertilizer types (Factor B). Applying different irrigation methods (e.g., flood vs.&nbsp;drip) typically requires large equipment and infrastructure, making it impractical to switch methods for every small plot of land. In contrast, changing fertilizer types is relatively easy and can be done by hand on smaller patches.</p>
<p>If we were to use a completely randomized design, we would have to randomly assign irrigation and fertilizer combinations to every small plot, which might require an impossible amount of plumbing/setup changes. Fisher and his colleagues formalized the split-plot design to handle this.</p>
<p>In a split-plot design, the experimental units are nested: 1. Whole Plots: Large areas of land to which the “hard-to-change” factor (e.g., irrigation) is applied. 2. Subplots: Smaller divisions within each whole plot to which the “easy-to-change” factor (e.g., fertilizer) is applied.</p>
<p>This design is a compromise. By restricting randomization of the main factor to larger blocks, we sacrifice some precision in estimating the main effect of Factor A (irrigation). However, we gain higher precision in estimating the effect of Factor B (fertilizer) and the interaction between A and B, because comparisons between fertilizers are made within the same whole plot, holding the irrigation method constant.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fig/split-plot-gpt.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption>Split-plot design</figcaption>
</figure>
</div>
<p>This hierarchical structure is not limited to agriculture. In modern industrial and medical experiments, we often see similar structures. For instance, in a hospital trial, a new sanitation protocol (Factor A) might be applied to entire hospital wings (Whole Plots) because it’s hard to have different protocols for adjacent rooms, while individual patients within those wings (Subplots) might be randomized to receive different medications (Factor B). Understanding these constraints is crucial ensuring that the statistical analysis accounts for the correlations among subplots within the same whole plot; ignoring this nesting leads to underestimated standard errors and overconfident conclusions.</p>
</section>
<section id="digital-experimentation-ab-testing" class="level3">
<h3 class="anchored" data-anchor-id="digital-experimentation-ab-testing">Digital experimentation (A/B testing)</h3>
<p>For many years, the main areas of application of randomized trials were medicine and agriculture. However, with the rise of the internet, randomized trials have become increasingly popular for testing the effectiveness of online interventions, such as email campaigns, website designs, and social media ads. When applied to user experience and marketing, randomized trials are often called A/B tests. The idea of A/B testing is the same as in traditional RCTs: randomly assign users to different versions of a website or an email campaign and compare the outcomes.</p>
<p>However, digital A/B tests often operate with fewer constraints on randomization protocols and sample selection than clinical or agricultural trials. There are fewer strict rules about ethics, randomization, sample size, and statistical analysis. For example, randomization is sometimes completely ignored in A/B testing. Instead of assigning users randomly to groups, they are divided into groups based on factors like time of day, location, or browsing history. This can introduce bias into the results, as the groups may not be comparable. As a result, A/B testing is cheap and quick to conduct, as it can be done online without the need for IRB approval or recruitment of participants. A/B testing is primarily focused on measuring the comparative performance of variations without necessarily establishing a causal relationship (e.g., “Which version of our web page leads to more clicks?”).</p>
</section>
<section id="the-era-of-observational-data" class="level3">
<h3 class="anchored" data-anchor-id="the-era-of-observational-data">The era of observational data</h3>
<p>Yet, not all digital data comes from structured experiments. We rely heavily on observational data streams. Diane Lambert was a pioneer in promoting proper statistical methods for observational data in the tech industry. She highlighted how to detect selection bias in data streams drawn from transaction logs and ad systems, and how to use diagnostics to judge when confounding bias is severe enough to overwhelm the causal signal. She advocated for practical fixes such as propensity-score weighting and simulation to ensure that credible causal conclusions can still be drawn from field data.</p>
<p>The advent of digital data has fundamentally transformed the practice of statistics, shifting the field from a discipline focused on small, carefully collected samples to one that must grapple with massive, often messy datasets generated as byproducts of digital systems. In the pre-digital era, statisticians worked primarily with structured, purposefully collected data through surveys, experiments, and clinical trials. Today, organizations routinely collect terabytes of data from web traffic, sensor networks, financial transactions, and social media interactions. This shift has necessitated new statistical approaches that can handle high-dimensional data and complex dependencies. Machine learning algorithms have become essential tools for extracting patterns from these vast datasets. However, this transition has also introduced new challenges: the need to distinguish correlation from causation in observational data, the importance of addressing selection bias in non-random samples, and the ethical considerations of privacy and algorithmic fairness.</p>
</section>
<section id="from-experiments-to-observational-data" class="level3">
<h3 class="anchored" data-anchor-id="from-experiments-to-observational-data">From experiments to observational data</h3>
<p>While randomized controlled trials remain the gold standard for establishing causality, conducting them is not always feasible. In many real-world scenarios—especially in policy, economics, and social science—we cannot ethically or practically assign treatments randomly. We are often left with observational data, where the “treatment” (e.g., a job training program, a medical procedure, or a new law) was assigned based on complex, often unobserved, human decisions. This brings us back to the fundamental problem of causal inference: how do we estimate the effect of a treatment when the treated and control groups are systematically different? To solve this, we need rigorous statistical frameworks that can adjust for these differences and impute the missing counterfactual outcomes.</p>
<p>Tree-based Bayesian methods are one modern approach to this problem. In particular, BART-based causal inference is developed in the tree chapter; see <a href="14-tree.html#sec-bart-causal" class="quarto-xref"><span>Section 14.5</span></a>.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-enikolopov2013field" class="csl-entry" role="listitem">
Enikolopov, Ruben, Vasily Korovkin, Maria Petrova, Konstantin Sonin, and Alexei Zakharov. 2013. <span>“Field Experiment Estimate of Electoral Fraud in <span>Russian</span> Parliamentary Elections.”</span> <em>Proceedings of the National Academy of Sciences</em> 110 (2): 448–52.
</div>
<div id="ref-garcia-arenzana2014calorie" class="csl-entry" role="listitem">
García-Arenzana, Nicolás, Eva María Navarrete-Muñoz, Virginia Lope, Pilar Moreo, Carmen Vidal, Soledad Laso-Pablos, Nieves Ascunce, et al. 2014. <span>“<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4166692">Calorie Intake, Olive Oil Consumption and Mammographic Density Among <span>Spanish</span> Women</a>.”</span> <em>International Journal of Cancer</em> 134 (8): 1916–25.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./04-dec.html" class="pagination-link" aria-label="Utility, Risk and Decisions">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Utility, Risk and Decisions</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./06-hyp.html" class="pagination-link" aria-label="Bayesian Hypothesis Testing">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Bayesian Hypothesis Testing</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>