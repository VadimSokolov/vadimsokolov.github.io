<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>12&nbsp; Linear Regression – Bayes, AI and Deep Learning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./13-logistic.html" rel="next">
<link href="./11-pattern.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-680e7c22d93ef26f016bec9199f8e6d8.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>
  // Load MathJax with custom macros
  window.MathJax = {
    tex: {
      macros: {
        Cov: ["\\mathrm{Cov}\\left(#1\\right)", 1],
        Cor: ["\\mathrm{Cor}\\left(#1\\right)", 1],
        Var: ["\\mathrm{Var}\\left(#1\\right)", 1],
        sd: ["\\mathrm{sd}\\left(#1\\right)", 1],
        E: ["\\mathrm{E}_{#1}\\left(#2\\right)", 2, ""],
        prob: ["\\mathrm{P}\\left(#1\\right)", 1],
        defeq: "\\stackrel{\\mathrm{def}}{=}",
        mini: "\\operatorname*{minimize}"
      }
    }
  };
</script>

<style>
  /* Custom styling for math content */
  .MathJax {
    font-size: 1em !important;
  }
  
  /* Ensure consistent math rendering */
  mjx-container[jax="CHTML"] {
    line-height: 1.2;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="12&nbsp; Linear Regression – Bayes, AI and Deep Learning">
<meta property="og:description" content="">
<meta property="og:image" content="12-regression_files/figure-html/unnamed-chunk-2-1.png">
<meta property="og:site_name" content="Bayes, AI and Deep Learning">
<meta name="twitter:title" content="12&nbsp; Linear Regression – Bayes, AI and Deep Learning">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="12-regression_files/figure-html/unnamed-chunk-2-1.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./10-data.html">AI</a></li><li class="breadcrumb-item"><a href="./12-regression.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Linear Regression</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Bayes, AI and Deep Learning</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Modern AI Playbook</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Bayes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-prob.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Probability and Uncertainty</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Bayes Rule</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-bl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Bayesian Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-dec.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Utility, Risk and Decisions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-ab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">A/B Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-hyp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Bayesian Hypothesis Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-sp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Stochastic Processes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-gp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Gaussian Processes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-rl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Reinforcement Learning</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">AI</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Unreasonable Effectiveness of Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-pattern.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Pattern Matching</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-regression.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Linear Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Logistic Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-tree.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Tree Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-forecasting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Forecasting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-rct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Randomized Controlled Trials</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-select.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Model Selection</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-theoryai.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Theory of AI: From MLE to Bayesian Regularization</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Deep Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-nn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Neural Networks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-theorydl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Theory of Deep Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-sgd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Gradient Descent</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-qnn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Quantile Neural Networks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-cnn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Convolutional Neural Networks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-nlp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Natural Language Processing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25-llm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Large Language Models: A Revolution in AI</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./26-robots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">AI Agents</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Exercises</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#statistical-properties-of-linear-models" id="toc-statistical-properties-of-linear-models" class="nav-link active" data-scroll-target="#statistical-properties-of-linear-models"><span class="header-section-number">12.1</span> Statistical Properties of Linear Models</a>
  <ul class="collapse">
  <li><a href="#estimates-and-intervals" id="toc-estimates-and-intervals" class="nav-link" data-scroll-target="#estimates-and-intervals">Estimates and Intervals</a></li>
  </ul></li>
  <li><a href="#factor-regression-and-feature-engineering" id="toc-factor-regression-and-feature-engineering" class="nav-link" data-scroll-target="#factor-regression-and-feature-engineering"><span class="header-section-number">12.2</span> Factor Regression and Feature Engineering</a>
  <ul class="collapse">
  <li><a href="#logarithmic-and-power-transformations" id="toc-logarithmic-and-power-transformations" class="nav-link" data-scroll-target="#logarithmic-and-power-transformations">Logarithmic and Power Transformations</a></li>
  </ul></li>
  <li><a href="#interactions" id="toc-interactions" class="nav-link" data-scroll-target="#interactions"><span class="header-section-number">12.3</span> Interactions</a></li>
  <li><a href="#categorical-variables-and-dummy-encoding" id="toc-categorical-variables-and-dummy-encoding" class="nav-link" data-scroll-target="#categorical-variables-and-dummy-encoding"><span class="header-section-number">12.4</span> Categorical Variables and Dummy Encoding</a></li>
  <li><a href="#bayes-regression" id="toc-bayes-regression" class="nav-link" data-scroll-target="#bayes-regression"><span class="header-section-number">12.5</span> Bayes Regression</a>
  <ul class="collapse">
  <li><a href="#horseshoe-for-linear-regression" id="toc-horseshoe-for-linear-regression" class="nav-link" data-scroll-target="#horseshoe-for-linear-regression">Horseshoe for Linear regression</a></li>
  </ul></li>
  <li><a href="#quantile-regression" id="toc-quantile-regression" class="nav-link" data-scroll-target="#quantile-regression"><span class="header-section-number">12.6</span> Quantile Regression</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./10-data.html">AI</a></li><li class="breadcrumb-item"><a href="./12-regression.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Linear Regression</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Linear Regression</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>The simplest form of a parametric model is a linear model that assumes a linear relationship between the input variables and the output variable. There are several ways to specify such a family of functions, for example as linear combinations of inputs <span class="math display">\[
f_{\beta}(x)=\beta_0+\beta_1x_1 + \ldots + \beta_p x_p.
\]</span> Technically, this is not a linear function. In mathematics, it is called an affine function, which is a linear function with an additional constant term (<span class="math inline">\(\beta_0\)</span>). However, if we add a dummy variable <span class="math inline">\(x_0 = 1\)</span> to the input vector <span class="math inline">\(x\)</span>, we can rewrite the function as a linear function of the parameters <span class="math inline">\(\beta = (\beta_0,\beta_1,\ldots,\beta_p)\)</span> using vector notation <span class="math display">\[
f_{\beta}(x) = \beta^Tx, ~ x = (1,x_1,\ldots,x_p).
\]</span></p>
<p>Note that instead of using a generic notation <span class="math inline">\(\theta\)</span> for the parameters, we use <span class="math inline">\(\beta\)</span> to emphasize that we are talking about the parameters of the linear model. The vector <span class="math inline">\(\beta\)</span> is called the <em>regression coefficients</em>.</p>
<p>Regression analysis is the most widely used statistical tool for understanding relationships among variables. It provides a conceptually simple method for investigating functional relationships between one or more factors and an outcome of interest. This relationship is expressed in the form of an equation, which we call the model, connecting the response or dependent variable and one or more explanatory or predictor variables.</p>
<p>A more general form of a linear model is a linear combination of basis functions <span class="math display">\[
f_{\beta}(x)= \beta_0 + \beta_1 \psi_1(x) + \ldots + \beta_M \psi_M(x) = \beta^T \psi(x),
\]</span> where <span class="math inline">\(\psi_1,\ldots,  \psi_M\)</span> are the basis functions and <span class="math inline">\(\psi(x) = (1, \psi_1(x),\ldots,\psi_M(x))\)</span>.</p>
<p>Notice in the latter case, the function <span class="math inline">\(f\)</span> is <em>linear in the parameters</em> <span class="math inline">\(\beta = (\beta_0,\beta_1,\ldots, \beta_p)\)</span> but not in the input variables <span class="math inline">\(x\)</span>. The goal of the modeler is to choose an appropriate set of predictors and basis functions that will lead to a good reconstruction of the input-output relations. After we’ve specified what the function <span class="math inline">\(f\)</span> is, we need to find the best possible values of parameters <span class="math inline">\(\beta\)</span>.</p>
<p>Finding a predictive rule <span class="math inline">\(f_{\beta}(x)\)</span> starts by defining the criterion of what is a good prediction. We assume that the function <span class="math inline">\(f_{\beta}(x)\)</span> is parameterized by a vector of parameters <span class="math inline">\(\beta\)</span> and we want to find the best value of <span class="math inline">\(\beta\)</span> that will give us the best prediction.</p>
<p>We will use a loss function that quantifies the difference between the predicted and actual values of the output variable. It is closely related to the loss function used in decision theory (thus the name). In decision theory, a loss function is a mathematical representation of the “cost” associated with making a particular decision in a given state of the world. It quantifies the negative consequences of choosing a specific action and helps guide decision-makers towards optimal choices. You can think of the loss function in predictive problems as a “cost” associated with making an inaccurate prediction given the values of the input variables <span class="math inline">\(x\)</span>.</p>
<p>The <em>least squares</em> loss function, discussed in <a href="11-pattern.html" class="quarto-xref"><span>Chapter 11</span></a>, is the sum of squared differences between the predicted and actual values. Given observed data set <span class="math inline">\(\{(x_1,y_1),\ldots,(x_n,y_n)\}\)</span>, the least squares estimator is the value of <span class="math inline">\(\beta\)</span> that minimizes the sum of squared errors <span class="math display">\[
\min_{\beta}\sum_{i=1}^n (y_i - \hat y_i)^2, ~ \hat y_i =  \hat \beta^T \psi(x).
\]</span></p>
<p>In the unconditional case, when we do not observe any inputs <span class="math inline">\(x\)</span>, the least squares estimator is the sample mean. We can solve this minimization problem by taking the derivative of the loss function and setting it to zero <span class="math display">\[
\frac{d}{d\beta}\sum_{i=1}^n (y_i - \beta_0)^2 = -2\sum_{i=1}^n (y_i - \beta_0) = 0
\]</span> which gives us the solution <span class="math display">\[
\hat{\beta}_0 = \frac{1}{n}\sum_{i=1}^n y_i
\]</span> which is the sample average.</p>
<div id="exm-houses" class="theorem example">
<p><span class="theorem-title"><strong>Example 12.1 (Housing Price Prediction)</strong></span> To demonstrate linear regression we develop a model that predicts the price of a house, given its square footage. This is a simplified version of a regression model used by Zillow, a house pricing site. First, we look at property sales data where we know the price and some observed characteristics. Let’s look at the scatter plot of living areas measured in square feet and the price measured in thousands of dollars.</p>
<p>Second, we build a model that predicts price as a function of the observed characteristics. Now, we need to decide on what characteristics do we use. There are many factors or variables that affect the price of a house, for example location. Some other basic ones include size, number of rooms, and parking.</p>
<p>We will use the <code>SaratogaHouses</code> dataset from the <code>mlbench</code> package. This dataset contains information about house sales in Saratoga County, New York, between 2004 and 2007. The dataset contains 1,172 observations and 16 variables. We will use the <code>price</code> variable as the dependent variable and the <code>livingArea</code> variable as the independent variable. The <code>price</code> variable contains the sale price of the house in thousands of dollars, and the <code>livingArea</code> variable contains the living area of the house in square feet. <span class="math display">\[
\mathrm{price} = \beta_0 + \beta_1 \mathrm{livingArea}
\]</span> The value that we seek to predict, <code>price</code>, is called the dependent variable, and we denote this by <span class="math inline">\(y\)</span>. The variable that we use to construct our prediction, <code>livingArea</code>, is the predictor variable, and we denote it with <span class="math inline">\(x\)</span>.</p>
<p>First, let’s see what the data looks like?</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"../data/SaratogaHouses.csv"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>price <span class="ot">=</span> d<span class="sc">$</span>price<span class="sc">/</span><span class="dv">1000</span>; d<span class="sc">$</span>livingArea <span class="ot">=</span> d<span class="sc">$</span>livingArea<span class="sc">/</span><span class="dv">1000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We use <code>lm</code> function to estimate the parameters of the line</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>l <span class="ot">=</span> <span class="fu">lm</span>(price <span class="sc">~</span> livingArea, <span class="at">data=</span>d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This R code is fitting a linear regression model using the <code>lm</code> function. Let’s break down the code:</p>
<ol type="1">
<li><p><code>lm</code>: This is the function used for fitting linear models, it uses least squares loss function.</p></li>
<li><p><code>price</code>: This is the dependent variable, the variable you are trying to predict. It is assumed to be in the dataset specified by the <code>data</code> argument.</p></li>
<li><p><code>~</code>: In the context of the formula inside <code>lm</code>, the tilde (<code>~</code>) separates the dependent variable from the independent variable(s).</p></li>
<li><p><code>livingArea</code>: This is the independent variable or predictor. In this case, the model is trying to predict the variable <code>price</code> based on the values of <code>livingArea</code>.</p></li>
<li><p><code>data = d</code>: This specifies the dataset that contains the variables <code>price</code> and <code>livingArea</code>. The dataset is named <code>d</code>.</p></li>
</ol>
<p>So, in plain English, this <code>R</code> code is fitting a linear regression model where the <code>price</code> is predicted based on the <code>livingArea</code> in the dataset <code>d</code>. The model is trying to find a coefficient for <code>livingArea</code> to minimize the difference between the predicted values and the actual values of <code>price</code>.</p>
<p>We can use <code>coef</code> function to find out the slope and the intercept of this line.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)  livingArea 
         13         113 </code></pre>
</div>
</div>
<p>The intercept value is in units of <span class="math inline">\(y\)</span> ($1000). The slope is in units of <span class="math inline">\(y\)</span> per units of <span class="math inline">\(x\)</span> ($1000/1 sq. feet). In our housing example, we find that <span class="math inline">\(\beta_0 = 13.439394\)</span> and <span class="math inline">\(\beta_1 =113.1225418\)</span>. Thus, every <span class="math inline">\(1000\)</span> sqft increase the price of the house by $1.1312254^{5} and the price of a lot of land without a house is 13.439394. The magnitude of <span class="math inline">\(\beta_1\)</span> shows the <em>economic significance</em> of house’s square footage.</p>
<p>We can now predict the price of a house when we only know that size: take the value off the regression line. For example, given a house size of <span class="math inline">\(x = 2.2\)</span>. Predicted price is <span class="math display">\[
\hat{y} = 13.4 + 113.1\times 2.2 = 262.3.
\]</span></p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(d<span class="sc">$</span>livingArea, d<span class="sc">$</span>price, <span class="st">'p'</span>, <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">xlab=</span><span class="st">"Living Area"</span>, <span class="at">ylab=</span><span class="st">"Price"</span>, <span class="at">bg=</span><span class="st">"lightblue"</span>, <span class="at">cex=</span><span class="fl">0.8</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(l, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw a line between the two points</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fl">2.2</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>yhat <span class="ot">=</span> x<span class="sc">*</span><span class="fu">coef</span>(l)[<span class="dv">2</span>]<span class="sc">+</span><span class="fu">coef</span>(l)[<span class="dv">1</span>]</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(x,x), <span class="fu">c</span>(<span class="dv">0</span>,yhat), <span class="at">col=</span><span class="st">"green"</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="dv">0</span>,x), <span class="fu">c</span>(yhat,yhat), <span class="at">col=</span><span class="st">"green"</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(x<span class="fl">-0.7</span>,yhat<span class="sc">+</span><span class="dv">30</span>, <span class="fu">TeX</span>(<span class="st">"$</span><span class="sc">\\</span><span class="st">hat{y} =  262.3$"</span>), <span class="at">cex=</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-regression_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</div>
<p>We used <code>lm</code> function to fit the linear model for the housing data. This function uses least squares loss function to estimate the parameters of the line. One of the nice properties of the least squares estimator is that it has a closed-form solution. This means that we can find the values of the parameters that minimize the loss function by solving a system of linear equations rather than using an optimization algorithm. The linear system is obtained by taking the gradient (multivariate derivative) of the loss function with respect to the parameters and setting it to zero. The loss function <span class="math display">\[
\mathcal{L}(\beta) = \sum_{i=1}^n (y_i - f_{\beta}(x_i))^2
\]</span> is a quadratic function of the parameters, so the solution is unique and can be found analytically. The gradient of the loss function with respect to the parameters is <span class="math display">\[
\nabla \mathcal{L}(\beta) = -2\sum_{i=1}^n (y_i - f_{\beta}(x_i))\nabla f_{\beta}(x_i).
\]</span> Given that <span class="math inline">\(f_{\beta}(x_i) = \beta^T \psi(x_i)\)</span>, the gradient of the loss function with respect to the parameters is <span class="math display">\[
\nabla \mathcal{L}(\beta)  = -2\sum_{i=1}^n (y_i - \beta^T \psi(x_i))\psi(x_i)^T.
\]</span> Setting the gradient to zero gives us the normal equations <span class="math display">\[
\sum_{i=1}^n y_i \psi(x_i)^T = \sum_{i=1}^n \beta^T \psi(x_i) \psi(x_i)^T.
\]</span> In matrix form, the normal equations are <span id="eq-normal-equations"><span class="math display">\[
\Psi^Ty = \Psi^T\Psi\beta
\tag{12.1}\]</span></span> where <span class="math inline">\(\Psi\)</span> is the design matrix with rows <span class="math inline">\(\psi(x_i)^T\)</span> and <span class="math inline">\(y\)</span> is the vector of output values. The solution to the normal equations is <span class="math display">\[
\hat{\beta} = (\Psi^T\Psi)^{-1}\Psi^Ty.
\]</span></p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> d<span class="sc">$</span>price; Psi <span class="ot">=</span> <span class="fu">cbind</span>(<span class="dv">1</span>,d<span class="sc">$</span>livingArea);</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>lhs <span class="ot">=</span> <span class="fu">t</span>(Psi)<span class="sc">%*%</span>Psi; rhs <span class="ot">=</span> <span class="fu">t</span>(Psi)<span class="sc">%*%</span>y</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">=</span> <span class="fu">solve</span>(lhs,rhs)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>beta[,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  13 113</code></pre>
</div>
</div>
<p>The function <code>solve</code> solves the <a href="#eq-normal-equations" class="quarto-xref">Equation&nbsp;<span>12.1</span></a>, and indeed finds the same values as the <code>lm</code> function. Essentially this is what the <code>lm</code> function does under the hood. The <code>solve</code> function uses the elimination method to solve the system of linear equations. The method we all learned when we were introduced to linear equations. The technique is known in linear algebra as LU decomposition.</p>
<p>In our housing example we used a linear model to predict the price of a house based on its square footage. The model is simple and easy to interpret, making it suitable for both prediction and interpretation. The model provides insights into the relationship between house size and price, allowing us to understand how changes in house size affect the price. The model can also be used to make accurate predictions of house prices based on square footage. This demonstrates the versatility of linear models for both prediction and interpretation tasks.</p>
<p>Let’s consider another example of using a linear model that allows us to understand the relationship between the performance of stock portfolio managed by John Maynard Keynes and overall market performance.</p>
<div id="exm-keynes" class="theorem example">
<p><span class="theorem-title"><strong>Example 12.2 (Keynes Investment Performance)</strong></span> John Maynard Keynes was a good investor, achieving a long-term average annual return of 16% while managing the King’s College Cambridge endowment fund from 1921 to 1946. This performance significantly outperformed the overall market during that period. In the 1921-1929 period he experimented with investments in art and currency, as well as cyclical equity investing. However, later in 1930s and onwards Keynes transitioned to a value investing strategy, focusing on undervalued stocks with strong fundamentals. This coincided with the Great Depression, where such investments offered significant opportunities. This shift led to consistent outperformance, with the King’s College endowment generating returns exceeding the market on average. In our analysis we consider his returns during the 1928-1945 period. Below is the plot of his returns.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>keynes <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"../data/keynes.csv"</span>,<span class="at">header=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Year</th>
<th style="text-align: right;">Keynes</th>
<th style="text-align: right;">Market</th>
<th style="text-align: right;">Rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1928</td>
<td style="text-align: right;">-3.4</td>
<td style="text-align: right;">7.9</td>
<td style="text-align: right;">4.2</td>
</tr>
<tr class="even">
<td style="text-align: right;">1929</td>
<td style="text-align: right;">0.8</td>
<td style="text-align: right;">6.6</td>
<td style="text-align: right;">5.3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1930</td>
<td style="text-align: right;">-32.4</td>
<td style="text-align: right;">-20.3</td>
<td style="text-align: right;">2.5</td>
</tr>
<tr class="even">
<td style="text-align: right;">1931</td>
<td style="text-align: right;">-24.6</td>
<td style="text-align: right;">-25.0</td>
<td style="text-align: right;">3.6</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1932</td>
<td style="text-align: right;">44.8</td>
<td style="text-align: right;">-5.8</td>
<td style="text-align: right;">1.5</td>
</tr>
<tr class="even">
<td style="text-align: right;">1933</td>
<td style="text-align: right;">35.1</td>
<td style="text-align: right;">21.5</td>
<td style="text-align: right;">0.6</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(keynes)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Year,Keynes,<span class="at">pch=</span><span class="dv">20</span>,<span class="at">col=</span><span class="dv">34</span>, <span class="at">cex=</span><span class="dv">3</span>, <span class="at">type=</span><span class="st">'l'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-regression_files/figure-html/keynes-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(Keynes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 13</code></pre>
</div>
</div>
<p>Let’s compare his performance to the overall stock market. The Dow Jones Industrial Average, grew at an average annual rate of 8.5% during the same period (1921-1946). Keynes was able to consistently generate alpha, exceeding the market’s overall returns.</p>
<p>The plot below shows the relationship scatterplot of the market returns vs Keynes portfolio returns. The correlation coefficient is 0.76, which is high; when markets are doing well, Keynes also did well.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Market, Keynes, <span class="at">xlab=</span><span class="st">"Market Return"</span>, <span class="at">ylab=</span><span class="st">"Keynes Excess Return"</span>,<span class="at">col=</span><span class="dv">20</span>, <span class="at">pch=</span><span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-regression_files/figure-html/keynes-plot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>The correlation coefficient is</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(Keynes,Market)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> 0.74</code></pre>
</div>
</div>
<p>Now we fit a linear regression model <span class="math display">\[
\text{Keynes} = \alpha + \beta \text{Market}
\]</span> Note that here instead of generic notations <span class="math inline">\(\beta_0\)</span> for intercept and <span class="math inline">\(\beta_1\)</span> for slope, we use <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>, which are common in finance literature.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Market, Keynes, <span class="at">xlab=</span><span class="st">"Market Return"</span>, <span class="at">ylab=</span><span class="st">"Keynes Excess Return"</span>,<span class="at">col=</span><span class="dv">20</span>, <span class="at">pch=</span><span class="dv">16</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">lm</span>(Keynes<span class="sc">~</span>Market)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(model, <span class="at">lwd=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-regression_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the model coefficients</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)      Market 
       13.2         1.7 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(model)</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>model <span class="sc">%&gt;%</span>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">13.2</td>
<td style="text-align: right;">4.75</td>
<td style="text-align: right;">2.8</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="even">
<td style="text-align: left;">Market</td>
<td style="text-align: right;">1.7</td>
<td style="text-align: right;">0.39</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">0.00</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The intercept of the least squares line is <span class="math inline">\(\alpha = 13.2\)</span>, which is significantly higher than 0. This indicates that Keynes was able to generate higher returns than the market, even when the market was performing well. This is consistent with his value investing strategy, which allowed him to identify undervalued stocks and generate significant alpha.</p>
<p>Now we adjust for the risk-free returns and calculate excess return.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>Keynes <span class="ot">=</span> Keynes <span class="sc">-</span> Rate</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>Market <span class="ot">=</span> Market <span class="sc">-</span> Rate</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>modelnew <span class="ot">=</span> <span class="fu">lm</span>(Keynes<span class="sc">~</span>Market)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>modelnew <span class="sc">%&gt;%</span>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">14.5</td>
<td style="text-align: right;">4.69</td>
<td style="text-align: right;">3.1</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="even">
<td style="text-align: left;">Market</td>
<td style="text-align: right;">1.8</td>
<td style="text-align: right;">0.37</td>
<td style="text-align: right;">4.8</td>
<td style="text-align: right;">0.00</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We see that after the adjustment, the intercept <span class="math inline">\(\alpha=14.46\)</span> is now even larger.</p>
</div>
<section id="statistical-properties-of-linear-models" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="statistical-properties-of-linear-models"><span class="header-section-number">12.1</span> Statistical Properties of Linear Models</h2>
<p>Previously we demonstrated how the Central Limit Theorem enables us to derive key statistical properties of the sample mean, including its asymptotic normality, unbiasedness, and the relationship between sample size and estimation precision. These same principles extend naturally to linear models, where we can derive analogous properties for the least squares estimators of regression coefficients.</p>
<p>First, we introduce a regression model using the language of probability. A regression model assumes that the mean of the output variable <span class="math inline">\(y\)</span> depends linearly on predictors <span class="math inline">\(x_1,\ldots,x_p\)</span> <span class="math display">\[
y = \beta_0 +  \beta_1 x + \ldots + \beta_p x_p + \epsilon,~ \text{where}~\epsilon \sim N(0, \sigma^2).
\]</span> Often, we use simpler dot-product notation <span class="math display">\[
y = \beta^Tx + \epsilon,
\]</span> where <span class="math inline">\(\beta = (\beta_0,\beta_1,\ldots,\beta_p)\)</span> is the vector of regression coefficients and <span class="math inline">\(x = (1,x_1,\ldots,x_p)\)</span> is the vector of predictors, with 1 appended to the beginning.</p>
<p>A more convenient form of the model is as follows <span class="math display">\[
y \mid x \overset{iid}{\sim}  N(\beta^Tx, \sigma^2).
\]</span></p>
<p>The additional term <span class="math inline">\(\epsilon\)</span> is a random variable that captures the uncertainty in the relationship between <span class="math inline">\(y\)</span> and <span class="math inline">\(x\)</span>; it is called the error term or the residual. The error term is assumed to be normally distributed with mean zero and variance <span class="math inline">\(\sigma^2\)</span>. Thus, the linear regression model has a new parameter <span class="math inline">\(\sigma^2\)</span> that models dispersion of <span class="math inline">\(y_i\)</span> around the mean <span class="math inline">\(\beta^Tx\)</span>, let’s see an example.</p>
<section id="estimates-and-intervals" class="level3">
<h3 class="anchored" data-anchor-id="estimates-and-intervals">Estimates and Intervals</h3>
<p>In our housing example, we estimated the parameter <span class="math inline">\(\beta_1\)</span> to be equal to 113.12 and made a conclusion that the price of the house goes up by that amount when the living area goes up by one unit. However, the estimated value is based on a sample. The sample is a result of well-designed data collection procedure and is representative of the population, and we should expect the estimated value to be close to the true value. However, the estimated value is not the true value of the parameter, but an estimate of it. The true value of the parameter is unknown and the estimated value is subject to sampling error.</p>
<p>The sampling error is modeled by the normal distribution. The standard error of the estimate is a measure of the uncertainty in the estimated value of the parameter. The standard error is calculated from the sample data and is used to calculate confidence intervals and p-values for the estimated parameter.</p>
<p>We used the <code>lm</code> function to estimate the parameters of the linear model. The estimated values of the parameters are given in the <code>Estimate</code> column of the output. The estimated value of the intercept is <span class="math inline">\(\hat \beta_0 = 13.439394\)</span> and the estimated value of the slope is <span class="math inline">\(\hat \beta_1 = 113.1225418\)</span>. These values are calculated using the least squares loss function, which minimizes the sum of squared differences between the predicted and actual values of the output variable. The estimated values of the parameters are subject to sampling error, which is modeled by the normal distribution. The standard error of the estimates is given in the <code>Std. Error</code> column of the output. The standard error is a measure of the uncertainty in the estimated values of the parameters. The t-statistic is the ratio of the estimated coefficient to its standard error. The p-value is the probability of observing a value at least as extreme as the one observed, assuming the null hypothesis is true. In this case, the p-value for the <code>livingArea</code> coefficient is less than 0.05, so we conclude that the coefficient is statistically significant. This means that the size of the house is a statistically significant predictor of the price. The Residual standard error is the standard deviation of the residuals <span class="math inline">\(\hat y_i - y_i,~i=1,\ldots,n\)</span>.</p>
<div id="exm-houses2" class="theorem example">
<p><span class="theorem-title"><strong>Example 12.3 (House Prices)</strong></span> Let’s go back to the Saratoga Houses dataset</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"../data/SaratogaHouses.csv"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>price <span class="ot">=</span> d<span class="sc">$</span>price<span class="sc">/</span><span class="dv">1000</span>; d<span class="sc">$</span>livingArea <span class="ot">=</span> d<span class="sc">$</span>livingArea<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>l <span class="ot">=</span> <span class="fu">lm</span>(price <span class="sc">~</span> livingArea, <span class="at">data=</span>d)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>l <span class="sc">%&gt;%</span> <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">5.0</td>
<td style="text-align: right;">2.7</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="even">
<td style="text-align: left;">livingArea</td>
<td style="text-align: right;">113</td>
<td style="text-align: right;">2.7</td>
<td style="text-align: right;">42.2</td>
<td style="text-align: right;">0.00</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The output of the <code>lm</code> function has several components. Besides calculating the estimated values of the coefficients, given in the <code>Estimate</code> column, the method also calculates standard error (<code>Std. Error</code>) and t-statistic (<code>t value</code>) for each coefficient. The t-statistic is the ratio of the estimated coefficient to its standard error. The p-value (<code>Pr(&gt;|t|)</code>) is the probability of observing a value at least as extreme as the one observed, assuming the null hypothesis is true. The null hypothesis is that the coefficient is equal to zero. If the p-value is less than 0.05, we typically reject the null hypothesis and conclude that the coefficient is statistically significant. In this case, the p-value for the <code>livingArea</code> coefficient is less than 0.05, so we conclude that the coefficient is statistically significant. This means that the size of the house is a statistically significant predictor of the price. The Residual standard error is the standard deviation of the residuals <span class="math inline">\(\hat y_i - y_i,~i=1,\ldots,n\)</span>.</p>
</div>
<p>The estimated values of the parameters were calculated using least squares loss function discussed above. The residual standard error is also relatively easy to calculate from the model residuals <span class="math display">\[
s_e = \sqrt{ \frac{1}{n-2} \sum_{i=1}^n ( \hat y_i - y_i )^2 }.
\]</span> Now the question is, how was the p-value for the estimates calculated? And why did we assume that <span class="math inline">\(\epsilon\)</span> is normally distributed in the first place? The normality of <span class="math inline">\(\epsilon\)</span> and as a consequence, the conditional normality of <span class="math inline">\(y \mid x \overset{iid}{\sim}  N(\beta^Tx, \sigma^2)\)</span> is easy to explain; it is simply due to mathematical convenience. Plus, this assumption happens to describe the reality well in a wide range of applications. One of those conveniences is our ability to calculate the mean and variance of the distribution of <span class="math inline">\(\hat \beta_0\)</span> and <span class="math inline">\(\hat \beta_1\)</span>.</p>
<p>To understand how to calculate the p-values, we first notice that there is uncertainty about the values of the parameters <span class="math inline">\(\beta_i\)</span>s. To get a feeling for the amount of variability in our experiments, imagine that we have two sample data sets. For example, we have housing data from two different realtor firms. Do you think that the estimated value of price per square foot will be the same for both of those? The answer is no. Let’s demonstrate with an example; we simulate 20 data sets from the same distribution and estimate 20 different linear models.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">92</span>) <span class="co">#Kuzy</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"../data/SaratogaHouses.csv"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>price <span class="ot">=</span> d<span class="sc">$</span>price<span class="sc">/</span><span class="dv">1000</span>; d<span class="sc">$</span>livingArea <span class="ot">=</span> d<span class="sc">$</span>livingArea<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(d<span class="sc">$</span>livingArea, d<span class="sc">$</span>price, <span class="at">pch=</span><span class="dv">20</span>, <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">xlab=</span><span class="st">"Living Area"</span>, <span class="at">ylab=</span><span class="st">"Price"</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sample with replacement</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  dnew <span class="ot">=</span> d[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(d),<span class="at">replace=</span>T),]</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit a linear model</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  l <span class="ot">=</span> <span class="fu">lm</span>(price <span class="sc">~</span> livingArea, <span class="at">data=</span>dnew, <span class="at">subset =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(d),<span class="dv">100</span>))</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(l, <span class="at">col=</span><span class="st">"green"</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-simbeta" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-simbeta-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="12-regression_files/figure-html/fig-simbeta-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-simbeta-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.1: Twenty different linear models estimated using randomly selected subsample of the data.
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-simbeta" class="quarto-xref">Figure&nbsp;<span>12.1</span></a> shows the results of this simulation. We can see that the estimated coefficients <span class="math inline">\(\hat \beta_i\)</span> are different for each of the 20 samples. This is due to the sampling error. The sampling error is the difference between the estimated value of a parameter and its true value. The value of <span class="math inline">\(\beta_1\)</span> will differ from sample to sample. In other words, it will be a random variable. The sampling distribution of <span class="math inline">\(\beta_1\)</span> describes how it varies over different samples with the <span class="math inline">\(x\)</span> values fixed. Statistical view of linear regression allows us to calculate confidence and prediction intervals for estimated parameters. It turns out that when least squares principle is used, the estimated <span class="math inline">\(\hat\beta_1\)</span> is normally distributed: <span class="math inline">\(\hat\beta_1\mid \beta_1 \sim N( \beta_1 , s_1^2 )\)</span>. Let’s see how we can derive this result.</p>
<p>The extension of the central limit theorem, sometimes called the Lindeberg CLT, states that a linear combination of independent random variables that satisfy some mild condition are approximately normally distributed. We can show that estimates of <span class="math inline">\((\beta_0\ldots,\beta_p)\)</span> are linear combinations of the observed values of <span class="math inline">\(y\)</span> and are therefore normally distributed. Indeed, if we write the linear regression model in matrix form <span class="math display">\[
Y = X \beta + \epsilon,
\]</span> where <span class="math inline">\(Y\)</span> is the vector of observed values of the dependent variable, <span class="math inline">\(X\)</span> is the matrix of observed values of the independent variables, <span class="math inline">\(\beta\)</span> is the vector of unknown parameters, and <span class="math inline">\(\epsilon\)</span> is the vector of errors. Then, if we take the derivative of the loss function for linear regression and set it to zero, we get the following expression for the estimated parameters <span class="math display">\[
\hat \beta =  AY,
\]</span> where <span class="math inline">\(A = (X^TX)^{-1}X^T\)</span>. Due to Lindeberg central limit theorem, <span class="math inline">\(\hat \beta\)</span> is normally distributed. This is a useful property that allows us to calculate confidence intervals and p-values for the estimated parameters.</p>
<p>Now, we need to compute the mean and variance of <span class="math inline">\(\hat \beta\)</span>. The mean is easy to compute, since the expectation of the sum is the sum of expectations, we have <span class="math inline">\(\hat{\beta} = A(X\beta + \epsilon)\)</span>, hence <span class="math display">\[
\hat{\beta} = \beta + A\epsilon
\]</span></p>
<p>The expectation and variance of <span class="math inline">\(\hat{\beta}\)</span> are then: <span class="math display">\[\begin{align*}
\E{\hat{\beta}} = &amp; \E{\beta + A\epsilon} = \E{\beta} + \E{A\epsilon} = \beta\\
\Var{\hat{\beta}} = &amp; \Var{A\epsilon} = A\Var{\epsilon}A^T = \sigma^2 A(X^TX)^{-1}A^T = \sigma^2 (X^TX)^{-1}
\end{align*}\]</span> Putting together the expectation and variance, we get the following distribution for <span class="math inline">\(\hat{\beta}\)</span>: <span class="math display">\[
\hat{\beta} \sim N(\beta, \sigma^2 (X^TX)^{-1}).
\]</span></p>
<p>We can think of the estimated coefficients <span class="math inline">\(\hat \beta_i\)</span> as an average amount of change in <span class="math inline">\(y\)</span>, when <span class="math inline">\(x_i\)</span> goes up by one unit. Since this average was calculated using a sample data, it is subject to sampling error and the sampling error is modeled by the normal distribution. Assuming that residuals <span class="math inline">\(\epsilon\)</span> are independently normally distributed with a variance that does not depend on <span class="math inline">\(x\)</span> (homoscedasticity), we can calculate the mean and variance of the distribution of <span class="math inline">\(\hat \beta_i\)</span>. This is a useful property that allows us to calculate confidence intervals and p-values for the estimated parameters.</p>
<p>In summary, the statistical view of the linear regression model is useful for understanding the uncertainty associated with the estimated parameters. It also allows us to calculate confidence intervals and prediction intervals for the output variable.</p>
<ol type="1">
<li>Average value of output <span class="math inline">\(y\)</span> is a linear function of input <span class="math inline">\(x\)</span> and lie on the straight line of regression <span class="math inline">\(\hat y_i = \beta^Tx_i\)</span>.</li>
<li>The values of <span class="math inline">\(y\)</span> are statistically independent.</li>
<li>The true value of <span class="math inline">\(y = \hat y_i + \epsilon_i\)</span> is a random variable, and it is normally distributed around the mean with variance <span class="math inline">\(\sigma^2\)</span>. This variance is the same for all values of <span class="math inline">\(y\)</span>.</li>
<li>The estimated values of the parameters <span class="math inline">\(\hat \beta_i\)</span> are calculated from observed data and are subject to the sampling error and we are not certain about them. This uncertainty is modeled by the normally distributed around the true values <span class="math inline">\(\beta\)</span>. Given that errors <span class="math inline">\(\epsilon_i\)</span> are homoscedastic and independent, we have <span class="math inline">\(Var(\hat{\beta}) = \sigma^2 (X^TX)^{-1}\)</span>.</li>
</ol>
<p>Again, consider a house example. Say in our data we have 10 houses with the same squire footage, say 2000. Now the third point states, that the prices of those houses should follow a normal distribution and if we are to compare prices of 2000 sqft houses and 2500 sqft houses, they will have the same standard deviation. The second point means that price of one house does not depend on the price of another house.</p>
<p>All of the assumptions in the regression model can be written using probabilist notations: <span class="math display">\[
y \mid x \overset{iid}{\sim}  N(\beta^Tx, \sigma^2).
\]</span></p>
<p>In the case when we have only one predictor the variance of the estimated slope <span class="math inline">\(\hat \beta_1\)</span> is given by <span class="math display">\[
\Var{\hat \beta_1} = \frac{\sigma^2}{\sum_{i=1}^n ( x_i - \bar{x} )^2 } = \frac{ \sigma^2 }{ (n-1) s_x^2 },
\]</span> where <span class="math inline">\(s_x^2\)</span> is the sample variance of <span class="math inline">\(x\)</span>. Thus, there are three factors that impact the size of standard error for <span class="math inline">\(\beta_1\)</span>: sample size (<span class="math inline">\(n\)</span>), error variance (<span class="math inline">\(\sigma^2\)</span>), and <span class="math inline">\(x\)</span>-spread, <span class="math inline">\(s_x\)</span>.</p>
<p>We can empirically demonstrate the sampling error by simulating several samples from the same distribution and estimating several linear models. We can see that the estimated coefficients <span class="math inline">\(\hat \beta_i\)</span> are normally distributed around the true values <span class="math inline">\(\beta_i\)</span>. If we plot coefficients for 1000 different models, we can see that the empirical distribution resembles a normal distribution.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">92</span>) <span class="co">#Kuzy</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Read housing data</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"../data/SaratogaHouses.csv"</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>price <span class="ot">=</span> d<span class="sc">$</span>price<span class="sc">/</span><span class="dv">1000</span>; d<span class="sc">$</span>livingArea <span class="ot">=</span> d<span class="sc">$</span>livingArea<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate 1000 samples</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a matrix to store the results</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow=</span>n, <span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate 1000 samples</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sample with replacement</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  dnew <span class="ot">=</span> d[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(d),<span class="at">replace=</span>T),]</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit a linear model</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  l <span class="ot">=</span> <span class="fu">lm</span>(price <span class="sc">~</span> livingArea, <span class="at">data=</span>dnew)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store the coefficients</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  beta[i,] <span class="ot">=</span> <span class="fu">coef</span>(l)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>ind <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the results</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(beta[,<span class="dv">1</span>], beta[,<span class="dv">2</span>], <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">xlab=</span><span class="st">"Intercept"</span>, <span class="at">ylab=</span><span class="st">"Slope"</span>, <span class="at">bg=</span><span class="st">"lightblue"</span>, <span class="at">cex=</span><span class="fl">0.8</span>)</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fu">coef</span>(l)[<span class="dv">2</span>], <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">coef</span>(l)[<span class="dv">1</span>], <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-regression_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">cbind</span>(<span class="dv">1</span>, d<span class="sc">$</span>livingArea)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the variance of the coefficients</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>var <span class="ot">=</span> <span class="fu">sigma</span>(l)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>varb <span class="ot">=</span> var[ind,ind]<span class="sc">/</span><span class="fl">0.63</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(beta[,ind], <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">xlab=</span><span class="st">"Intercept"</span>, <span class="at">main=</span><span class="st">""</span>,<span class="at">freq=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-regression_files/figure-html/unnamed-chunk-8-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>bt <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">80</span>,<span class="dv">140</span>,<span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Accounting for uncertainty in <span class="math inline">\(\hat \beta\)</span>s we can calculate confidence intervals for the predicted average <span class="math inline">\(\hat y\)</span>. When we additionally account for the uncertainty in the predicted value <span class="math inline">\(\hat y\)</span>, we can calculate prediction intervals.</p>
<p>Another advantage of adopting a statistical view of the linear regression model is ability to quantify information about potential outliers. Outliers are points that are extreme relative to our model predictions. Recall, that residual is <span class="math inline">\(e_i  = y_i- \hat y_i\)</span>. Since our predicted value <span class="math inline">\(\hat y_i\)</span> follows a normal distribution, the residual also follows a normal distribution, since it is a difference of normal random variable <span class="math inline">\(\hat y_i\)</span> and a constant <span class="math inline">\(y_i\)</span>. It easy to see that <span class="math display">\[e_i \sim N(0, s_e^2),\]</span> where <span class="math inline">\(s_e^2\)</span> is an empirical estimate of the error’s variance.</p>
<p>Consider the relation between the <em>fitted values</em> <span class="math inline">\(\hat y_i\)</span> and residuals <span class="math inline">\(e_i\)</span>. Our predictions are given by the line. The residual <span class="math inline">\(e_i\)</span> and predicted value <span class="math inline">\(\hat y_i\)</span> for the <span class="math inline">\(i\)</span>th observation are related via <span class="math display">\[
y_i = \hat{y}_i + ( y_i - \hat{y}_i ) = \hat{y}_i + e_i.
\]</span></p>
<p>Residuals allow us to define outliers. They simply have large residuals. We re-scale the residuals by their standard errors. This lets us define <span class="math display">\[r_i = \frac{ e_i }{ s_{ e} } =\frac{y_i - \hat{y}_i   }{ s_{ e } }\]</span> Since residuals follow normal distribution <span class="math inline">\(e \sim N(0,\sigma^2)\)</span>, in 95% of the time we expect the standardized residuals to satisfy <span class="math inline">\(- 2 &lt; r_i &lt; 2\)</span>. Any observation with <span class="math inline">\(|r_i| &gt; 3\)</span> is an extreme outlier; it is three sigmas away from the mean.</p>
<p>Another type of observations we are interested in are the <em>influential points</em>. These are observations that affect the magnitude of our estimates <span class="math inline">\(\hat{\beta}\)</span>s. They are important to find as they typically have economic consequences. We will use Cook’s distance to assess the significance of an influential point. Cook’s distance associated with sample <span class="math inline">\(i\)</span> measures the change in estimated model parameters <span class="math inline">\(\hat \beta\)</span> when sample <span class="math inline">\(i\)</span> is removed from the training data set.</p>
<p>Intuitively, we model regression-back-to-the-mean effect. This is one of the most interesting statistical effects you’ll see in daily life. In statistics, regression does not mean “going backwards”, but rather the tendency for a variable that is extremely high or low to move closer to the average upon subsequent measurement. For example, Francis Galton, who was a cousin of Charles Darwin, in his study on regression to the mean height showed that if your parents are taller than the average, you’ll regress back to the average. While people might expect the children of tall parents to be even taller and the children of short parents to be even shorter, Galton found that this wasn’t the case. Instead, he observed that the heights of the children tended to be closer to the average height for the population. Galton termed this phenomenon “regression towards mediocrity” (now more commonly known as “regression to the mean”). It meant that extreme characteristics (in this case, height) in parents were likely to be less extreme (closer to the average) in their children. It is a classic example that helped introduce and explain this statistical concept. Galton’s finding was one of the first insights into what is now a well-known statistical phenomenon. It doesn’t imply that all individual cases will follow this pattern; rather, it’s a trend observed across a population. It’s important to understand that regression to the mean doesn’t suggest that extreme traits diminish over generations but rather that an extreme measurement is partly due to random variation and is likely to be less extreme upon subsequent measurement.</p>
<p>Another example was documented by Daniel Kahneman and Amos Tversky in their book Thinking, Fast and Slow. They found that when a person performs a task, their performance is partly due to skill and partly due to luck. They observed that when a person performs a task and achieves an extreme result, their subsequent performance is likely to be less extreme. Particularly they studied effect of criticism and praise used by Israeli Air Force fighter pilots trainers. After criticism, the low-scoring pilots were retested. Often, their scores improve. At first glance, this seems like a clear effect of feedback from the trainer. However, some of this improvement is likely a statistical artifact and demonstrates the regression to the mean effect.</p>
<p>Why? Those pilots who initially scored poorly were, statistically speaking, somewhat unlucky. Their low scores may have been due to a bad day, stress, or other factors. When retested, their scores are likely to be closer to their true skill level, which is closer to the average. This natural movement towards the average can give the illusion that the intervention (praise or criticism) was more effective than it actually was. Conversely, if the top performers were praised and retested, we might find their scores decrease slightly, not necessarily due to the inefficacy of the praise but due to their initial high scores being partly due to good luck or an exceptionally good day. In conclusion, in pilot training and other fields, it’s important to consider regression to the mean when evaluating the effectiveness of interventions. Without this consideration, one might draw incorrect conclusions about the impact of training or other changes.</p>
<div id="exm-googspy" class="theorem example">
<p><span class="theorem-title"><strong>Example 12.4 (Google vs S&amp;P 500)</strong></span> We will demonstrate how we can use statistical properties of a linear regression model to understand the relationship between returns of a google stock and the S&amp;P 500 index. We will use Capital Asset Pricing Model (CAPM) regression model to estimate the expected return of an investment into Google stock and to price the risk. The CAPM model is</p>
<p><span class="math display">\[
\mathrm{GOOG} = \alpha + \beta \mathrm{SP500} + \epsilon
\]</span> On the left hand side, we have the return that investors expect to earn from investing into Google stock. In the CAPM model, this return is typically modeled as a dependent variable.</p>
<p>The input variable <code>SP500</code> represents the average return of the entire US market. Beta measures the volatility or systematic risk of a security or a portfolio in comparison to the market as a whole. A beta greater than 1 indicates that the security is more volatile than the market, while a beta less than 1 indicates it is less volatile. Alpha is the intercept of the regression line, it measures the excess return of the security over the market. The error term <span class="math inline">\(\epsilon\)</span> captures the uncertainty in the relationship between the returns of Google stock and the market.</p>
<p>In a CAPM regression analysis, the goal is to find out how well the model explains the returns of a security based on its beta. This involves regressing the security’s excess returns (returns over the risk-free rate) against the excess returns of the market. The slope of the regression line represents the beta, and the intercept should ideally be close to the risk-free rate, although in practice it often deviates. This model helps in understanding the relationship between the expected return and the systematic risk of an investment.</p>
<p>Based on the uncertainty associated with the estimates for alpha and beta, we can formulate several hypothesis tests, for example:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 54%">
<col style="width: 45%">
</colgroup>
<thead>
<tr class="header">
<th>Hypothesis</th>
<th>Question</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(H_0: \beta = 0\)</span></td>
<td>Is Google related to the market?</td>
</tr>
<tr class="even">
<td><span class="math inline">\(H_0: \alpha = 0\)</span></td>
<td>Does Google outperform the market in a consistent fashion?</td>
</tr>
</tbody>
</table>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getSymbols</span>(<span class="at">Symbols =</span> <span class="fu">c</span>(<span class="st">"GOOG"</span>,<span class="st">"SPY"</span>),<span class="at">from=</span><span class="st">'2017-01-03'</span>,<span class="at">to=</span><span class="st">'2023-12-29'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> "GOOG" "SPY" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>gret <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">dailyReturn</span>(GOOG))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>spyret <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">dailyReturn</span>(SPY))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>l <span class="ot">=</span> <span class="fu">lm</span>(gret <span class="sc">~</span> spyret)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(l) <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">0.0003</td>
<td style="text-align: right;">0.0003</td>
<td style="text-align: right;">1.1</td>
<td style="text-align: right;">0.27</td>
</tr>
<tr class="even">
<td style="text-align: left;">spyret</td>
<td style="text-align: right;">1.1706</td>
<td style="text-align: right;">0.0240</td>
<td style="text-align: right;">48.8</td>
<td style="text-align: right;">0.00</td>
</tr>
</tbody>
</table>
<p>Google vs S&amp;P 500 returns between 2017-2023</p>
</div>
</div>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gret, spyret, <span class="at">bg=</span><span class="st">"lightblue"</span>, <span class="at">xlab=</span><span class="st">"Google Return"</span>, <span class="at">ylab=</span><span class="st">"SPY Return"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(l, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-regression_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="576"></p>
<figcaption>Google vs S&amp;P 500 returns between 2017-2023</figcaption>
</figure>
</div>
</div>
</div>
<p>Here’s what we get after we fit the model using function</p>
<p>Our best estimates are <span class="math display">\[
\hat \alpha = 0.0004 \; , \; \hat{\beta} = 1.01
\]</span></p>
<p>Now we can provide the results for the hypotheses we set at the beginning. Given that the p-value for <span class="math inline">\(H_0: \beta = 0\)</span> is <code>&lt;2e-16</code> we can reject the null hypothesis and conclude that Google is related to the market. The p-value for <span class="math inline">\(H_0: \alpha = 0\)</span> is 0.06, which is greater than 0.05, so we cannot reject the null hypothesis and conclude that Google does not outperform the market in a consistent fashion in the 2017-2023 period.</p>
<p>Further, we can answer some of the other important questions, such as how much will Google move if the market goes up <span class="math inline">\(10\)</span>%?</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">=</span> <span class="fu">coef</span>(l)[<span class="dv">1</span>]</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">=</span> <span class="fu">coef</span>(l)[<span class="dv">2</span>]</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the expected return</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>alpha <span class="sc">+</span> beta<span class="sc">*</span><span class="fl">0.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
       0.12 </code></pre>
</div>
</div>
<p>However, if we look at the earlier period between 2005-2016 (the earlier days of Google) the results will be different.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getSymbols</span>(<span class="at">Symbols =</span> <span class="fu">c</span>(<span class="st">"GOOG"</span>,<span class="st">"SPY"</span>),<span class="at">from=</span><span class="st">'2005-01-03'</span>,<span class="at">to=</span><span class="st">'2016-12-29'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> "GOOG" "SPY" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>gret <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">dailyReturn</span>(GOOG))</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>spyret <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">dailyReturn</span>(SPY))</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>l <span class="ot">=</span> <span class="fu">lm</span>(gret <span class="sc">~</span> spyret)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(l) <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-googspy" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-null_prefix="true" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-googspy-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;12.1: Google vs S&amp;P 500 returns between 2005-2016
</figcaption>
<div aria-describedby="tbl-googspy-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">0.0006</td>
<td style="text-align: right;">0.0003</td>
<td style="text-align: right;">2.2</td>
<td style="text-align: right;">0.03</td>
</tr>
<tr class="even">
<td style="text-align: left;">spyret</td>
<td style="text-align: right;">0.9231</td>
<td style="text-align: right;">0.0230</td>
<td style="text-align: right;">40.1</td>
<td style="text-align: right;">0.00</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(spyret, gret, <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">ylab=</span><span class="st">"Google Return"</span>, <span class="at">xlab=</span><span class="st">"SPY Return"</span>, <span class="at">bg =</span> <span class="st">"lightblue"</span>, <span class="at">cex=</span><span class="fl">0.8</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(l, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-googspy" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-googspy-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="12-regression_files/figure-html/fig-googspy-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-googspy-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.2: Google vs S&amp;P 500 returns between 2005-2016
</figcaption>
</figure>
</div>
</div>
</div>
<p>In this period Google did consistently outperform the market. The p-value for <span class="math inline">\(H_0: \alpha = 0\)</span> is 0.03.</p>
</div>
<div id="exm-yahoo-capm" class="theorem example">
<p><span class="theorem-title"><strong>Example 12.5 (CAPM Model for Yahoo! Stock)</strong></span> Rather than estimate <span class="math inline">\(\mu\)</span> directly, the CAPM estimates the difference between <span class="math inline">\(\mu\)</span> and the risk-free rate <span class="math inline">\(r_f\)</span>. This quantity <span class="math inline">\(\mu-r_f\)</span> is known as the expected excess return (excess relative to a risk-free investment). The CAPM relates the expected excess return of a stock to that of an underlying benchmark, typically a broad-based market index. Let <span class="math inline">\(\mu_M\)</span> and <span class="math inline">\(\sigma_M\)</span> denote the return and volatility on the market index. The implication of CAPM is that there is a linear relationship between the expected excess return of a stock, <span class="math inline">\(\mu-r_f\)</span>, and the excess return of the market, <span class="math inline">\(\mu_M-r_f\)</span>.<br>
<span class="math display">\[
\text{Excess \; Return}_{\text{Stock}} =  \beta \;  \text{Excess \;
Return}_{\text{Market}}
\]</span> <span class="math display">\[
\mu-r_f = \beta(\mu_M - r_f )
\]</span> Put simply, the expected excess return of a stock is <span class="math inline">\(\beta\)</span> times the excess expected return of the market. Beta (<span class="math inline">\(\beta\)</span>) is a measure of a stock’s risk in relation to the market. A beta of 1.3 implies that the excess return on the stock is expected to move up or down 30% more than the market. A beta bigger than one implies the stock is riskier than the market and goes up (and down) faster than the market goes up (and down). A beta less than one implies the stock is less risky than the market.</p>
<p>Using the CAPM, the expected return of the stock can now be defined as the risk free interest rate plus beta times the expected excess return of the market, <span class="math display">\[
\mu = \text{Expected \; Return}_{\text{Stock}} = r_f+\beta (\mu_M-r_f)
\]</span> Beta is typically estimated from a regression of the individual stock’s returns on those of the market. The other parameters are typically measured as the historical average return on the market <span class="math inline">\(\mu_M\)</span> and the yield on Treasury Bills <span class="math inline">\(r_f\)</span>. Together these form an estimate of <span class="math inline">\(\mu\)</span>. The volatility parameter <span class="math inline">\(\sigma\)</span> is estimated by the standard deviation of historical returns.</p>
<p>Our qualitative discussion implicitly took the year as the unit of time. For our example, we make one minor change and consider daily returns so that <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span> are interpreted as a daily rate of return and daily volatility (or standard deviation). We use an annual risk-free rate of 5%; this makes a daily risk-free rate of .019%, <span class="math inline">\(r_f = 0.00019\)</span>, assuming there are 252 trading days in a year. A simple historical average is used to estimate the market return (<span class="math inline">\(\mu_M\)</span>) for the Nasdaq 100. The average annual return is about 23%, with corresponding daily mean <span class="math inline">\(\mu_M = 0.00083\)</span>. A regression using daily returns from 1996-2000 leads to an estimate of <span class="math inline">\(\beta = 1.38\)</span>. Combining these (pieces) leads to an estimated expected return of Yahoo!, <span class="math inline">\(\mu_{Yahoo} = 0.00019+1.38(0.00083-0.00019) = 0.00107\)</span> on a daily basis. Note that the CAPM model estimates a future return that is much lower than the observed rate over the last three-plus years of .42% per day or 289% per year.</p>
<p>To measure the riskiness of Yahoo! notice that the daily historical volatility is 5%, i.e.&nbsp;<span class="math inline">\(\sigma = 0.05\)</span>. On an annual basis this implies a volatility of <span class="math inline">\(\sigma \sqrt{T} = 0.05 \sqrt{252} = 0.79\)</span>, that is 79%. For comparison, the benchmark Nasdaq 100 has historical daily volatility 1.9% and an annual historical volatility of 30%. The estimates of all the parameters are recorded in <a href="#tbl-returns" class="quarto-xref">Table&nbsp;<span>12.2</span></a>.</p>
<div id="tbl-returns" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-returns-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;12.2: Key Parameter Estimates Based on Daily Returns 1996–2000
</figcaption>
<div aria-describedby="tbl-returns-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 19%">
<col style="width: 23%">
<col style="width: 24%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th>Asset</th>
<th>Expected return</th>
<th>Volatility</th>
<th>Regression coefft (s.e.)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Yahoo!</td>
<td><span class="math inline">\(\mu = 0.00107\)</span></td>
<td><span class="math inline">\(\sigma = 0.050\)</span></td>
<td><span class="math inline">\(\beta = 1.38 (.07)\)</span></td>
</tr>
<tr class="even">
<td>Nasdaq 100</td>
<td><span class="math inline">\(\mu_M = 0.00083\)</span></td>
<td><span class="math inline">\(\sigma_M = 0.019\)</span></td>
<td>1</td>
</tr>
<tr class="odd">
<td>Treasury Bills</td>
<td><span class="math inline">\(r_f = 0.00019\)</span></td>
<td>–</td>
<td>–</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</section>
</section>
<section id="factor-regression-and-feature-engineering" class="level2" data-number="12.2">
<h2 data-number="12.2" class="anchored" data-anchor-id="factor-regression-and-feature-engineering"><span class="header-section-number">12.2</span> Factor Regression and Feature Engineering</h2>
<p>A linear model assumes that output variable is proportional to the input variable plus an offset. However, this is not always the case. Often, we need to transform input variables by combining multiple inputs into a single predictor, for example by taking a ratio or putting inputs on a different scale, e.g.&nbsp;log-scale. In machine learning, this process is called feature engineering.</p>
<p>One of the classic examples of feature engineering is Fama-French three-factor model which is used in asset pricing and portfolio management. The model states that asset returns depend on (1) market risk, (2) the outperforming of small versus big companies, and (3) the outperformance of high book/market versus small book/market companies, mathematically <span class="math display">\[r = R_f + \beta(R_m - R_f) + b_s\cdot SMB + b_v\cdot HML + \alpha\]</span> Here <span class="math inline">\(R_f\)</span> is risk-free return, <span class="math inline">\(R_m\)</span> is the return of market, <span class="math inline">\(SMB\)</span> stands for "Small market capitalization Minus Big" and <span class="math inline">\(HML\)</span> for "High book-to-market ratio Minus Low"; they measure the historic excess returns of small caps over big caps and of value stocks over growth stocks. These factors are calculated with combinations of portfolios composed by ranked stocks (BtM ranking, Cap ranking) and available historical market data.</p>
<section id="logarithmic-and-power-transformations" class="level3">
<h3 class="anchored" data-anchor-id="logarithmic-and-power-transformations">Logarithmic and Power Transformations</h3>
<p>Consider, the growth of the Apple stock between 2000 and 2024. With the exception of the 2008 financial crisis period and 2020 COVID 19 related declines, the stock price has been growing exponentially. <a href="#fig-aapl" class="quarto-xref">Figure&nbsp;<span>12.3</span></a> shows the price of the Apple stock between 2000 and 2024. The price is closely related to the company’s growth.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getSymbols</span>(<span class="at">Symbols =</span> <span class="st">"AAPL"</span>,<span class="at">from=</span><span class="st">'2000-01-01'</span>,<span class="at">to=</span><span class="st">'2023-12-31'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> "AAPL"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(AAPL<span class="sc">$</span>AAPL.Adjusted, <span class="at">type=</span><span class="st">'l'</span>, <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">xlab=</span><span class="st">"Date"</span>, <span class="at">ylab=</span><span class="st">"Price"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-aapl" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-aapl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="12-regression_files/figure-html/fig-aapl-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-aapl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.3: Apple stock price growth in the 2000-2024 period
</figcaption>
</figure>
</div>
</div>
</div>
<p>The 2008 and 2020 declines are more related to extraneous factors, rather than the growth of the company. Thus, we can conclude that the overall growth of the company is exponential. The growth of a successful company typically follows the rule of compounding. Compounding is a fundamental principle that describes how some quantity grows over time when this quantity increases by a fixed percentage periodically. This is a very common phenomenon in nature and business. For example, if two parents have 2.2 children on average, then the population increases by 10% every generation. Another example is growth of investment in a savings account.</p>
<p>A more intuitive example is probably an investment in a savings account. If you invest <span class="math inline">\(1000\)</span> in a savings account with <span class="math inline">\(10\%\)</span> annual interest rate and you get paid once a year, then your account value will be <span class="math inline">\(1100\)</span> by the end of the year. However, if you get paid <span class="math inline">\(n\)</span> times a year, and initially invest <span class="math inline">\(y_0\)</span>, the final value <span class="math inline">\(y\)</span> of the account after <span class="math inline">\(t\)</span> years will be <span class="math display">\[
y = y_0 \times (1 + r/n)^{nt}
\]</span> where <span class="math inline">\(r\)</span> is the annual interest rate. When you get paid every month (<span class="math inline">\(n=12\)</span>), a traditional payout schedule used by banks, then <span class="math display">\[
y = 1000 \times (1 + 0.1/12)^{12} = 1105.
\]</span> A value slightly higher than the annual payout of 1100.</p>
<p>The effect of compounding is minimal in the short term. However, the effect of compounding is more pronounced when the growth rate is higher and time periods are longer. For example at <span class="math inline">\(r=2\)</span>, <span class="math inline">\(n=365\)</span> and 4-year period <span class="math inline">\(t=4\)</span>, you get <span class="math display">\[
y = 1000 \times (1 + 2/365)^{3\times 365} = 2,916,565.
\]</span> Your account is close to 3 million dollars! Compared to <span class="math inline">\(n=1\)</span> scenario <span class="math display">\[
y = 1000 \times (1 + 2)^{4} = 81,000,
\]</span> when you will end up with merely 81 thousand. This is why compounding is often referred to as the “eighth wonder of the world” in investing contexts, emphasizing its power in growing wealth over time.</p>
<p>In general, as <span class="math inline">\(n\)</span> goes up, the growth rate of the quantity approaches the constant</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>T <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>r <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(T, (<span class="dv">1</span><span class="sc">+</span>r<span class="sc">/</span>T)<span class="sc">^</span>T, <span class="at">type=</span><span class="st">'l'</span>, <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">ylab=</span><span class="st">"Future Value"</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fu">exp</span>(r), <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-compound" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-compound-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="12-regression_files/figure-html/fig-compound-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-compound-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.4: Growth of an investment in a savings account when n increases and return rate is 100% per year
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-compound" class="quarto-xref">Figure&nbsp;<span>12.4</span></a> shows the growth of an investment in a savings account when <span class="math inline">\(n\)</span> increases and return rate is <span class="math inline">\(100\%\)</span> per year. We can see that the growth rate approaches the constant <span class="math inline">\(e \approx 2.72\)</span> as <span class="math inline">\(n\)</span> increases. <span class="math display">\[
(1+r/n)^n \rightarrow e^r,~\text{as}~n \rightarrow \infty.
\]</span> This limit was first delivered by Leonhard Euler and the number <span class="math inline">\(e\)</span> is known as Euler’s number.</p>
<p>Coming back to the growth of the Apple company, we can think of it growing at a small constant rate every day. The relation between the time and size of Apple is multiplicative. Meaning when time increases by one day, the size of the company increases by a small constant percentage. This is a multiplicative relation. In contrast, linear relation is additive, meaning that when time increases by one day, the size of the company increases by a constant amount. The exponential growth model is given by the formula <span class="math display">\[
y = y_0 \times e^{\beta^Tx}.
\]</span> There are many business and natural science examples where multiplicative relation holds. IF we apply the <span class="math inline">\(\log\)</span> function to both sides of the equation, we get <span class="math display">\[
\log y = \log y_0 + \beta^Tx.
\]</span> This is a linear relation between <span class="math inline">\(\log y\)</span> and <span class="math inline">\(x\)</span>. Thus, we can use linear regression to estimate the parameters of the exponential growth model by putting the output variable <span class="math inline">\(y\)</span> on the log-scale.</p>
<p>Another example of nonlinear relation that can be analyzed using linear regression is when variables are related via a power law. This concept helps us model proportional relationships or ratios. In a multiplicative relationship, when one variable changes on a percent scale, the other changes in a directly proportional manner, as long as the multiplying factor remains constant. For example, the relation between the size of a city and the number of cars registered in the city is given by a power law. When the size of the city doubles, the number of cars registered in the city is also expected to double. The power law model is given by the formula <span class="math display">\[
y = \beta_0 x^{\beta_1}.
\]</span> If we apply the <span class="math inline">\(\log\)</span> function to both sides of the equation, we get <span class="math display">\[
\log y = \log \beta_0 + \beta_1 \log x.
\]</span> This is a linear relation between <span class="math inline">\(\log y\)</span> and <span class="math inline">\(\log x\)</span>. Thus, we can use linear regression to estimate the parameters of the power law model by putting the output variable <span class="math inline">\(y\)</span> and input variable <span class="math inline">\(x\)</span> on the log-scale.</p>
<p>However, there are several caveats when putting variables on the log-scale. We need to make sure that the variable is positive. This means that we cannot apply log transformations to dummy or count variables.</p>
<div id="exm-mammal" class="theorem example">
<p><span class="theorem-title"><strong>Example 12.6 (World’s Smartest Mammal)</strong></span> We will demonstrate the power relation using data on brain (measured in grams) and body (measured in kilograms) weights for 62 mammal species. The data was collected by Harry J. Jerison in 1973. The dataset contains the following variables:</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>mammals <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"../data/mammals.csv"</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(mammals))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Mammal</th>
<th style="text-align: right;">Brain</th>
<th style="text-align: right;">Body</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">African_elephant</td>
<td style="text-align: right;">5712.0</td>
<td style="text-align: right;">6654.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">African_giant_pouched_rat</td>
<td style="text-align: right;">6.6</td>
<td style="text-align: right;">1.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Arctic_Fox</td>
<td style="text-align: right;">44.5</td>
<td style="text-align: right;">3.38</td>
</tr>
<tr class="even">
<td style="text-align: left;">Arctic_ground_squirrel</td>
<td style="text-align: right;">5.7</td>
<td style="text-align: right;">0.92</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Asian_elephant</td>
<td style="text-align: right;">4603.0</td>
<td style="text-align: right;">2547.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">Baboon</td>
<td style="text-align: right;">179.5</td>
<td style="text-align: right;">10.55</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Let’s build a linear model.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(mammals)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">lm</span>(Brain<span class="sc">~</span>Body)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Body,Brain, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">bg=</span><span class="st">"lightblue"</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(model, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-regression_files/figure-html/mammals-1.png" class="img-fluid figure-img" width="576"></p>
<figcaption>Brain vs Body weight for 62 mammal species</figcaption>
</figure>
</div>
</div>
</div>
<p>We see a few outliers with suggests that normality assumption is violated. We can check the residuals by plotting residuals against fitted values and plotting fitted vs true values.</p>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model<span class="sc">$</span>fitted.values, model<span class="sc">$</span>residuals, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">bg=</span><span class="st">"lightblue"</span>, <span class="at">xlab=</span><span class="st">"Fitted y"</span>, <span class="at">ylab=</span><span class="st">"Residuals"</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Brain, model<span class="sc">$</span>fitted.values, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">bg=</span><span class="st">"lightblue"</span>, <span class="at">xlab=</span><span class="st">"True y"</span>, <span class="at">ylab=</span><span class="st">"Fitted y"</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>,<span class="at">b=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel" data-null_prefix="true" data-layout-ncol="2" data-layout-align="center">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-mammals-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mammals-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="12-regression_files/figure-html/fig-mammals-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mammals-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.5: Fitted y vs Residuals
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-mammals-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mammals-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="12-regression_files/figure-html/fig-mammals-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mammals-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.6: Fitted y vs True y
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>Remember, that residuals should roughly follow a normal distribution with mean zero and constant variance. We can see that the residuals are not normally distributed and the variance increases with the fitted values. This is a clear indication that we need to transform the data. We can try a log-log transformation.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">lm</span>(<span class="fu">log</span>(mammals<span class="sc">$</span>Brain)<span class="sc">~</span><span class="fu">log</span>(mammals<span class="sc">$</span>Body))</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>model <span class="sc">%&gt;%</span>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">2.18</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">log(mammals$Body)</td>
<td style="text-align: right;">0.74</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model<span class="sc">$</span>fitted.values, model<span class="sc">$</span>residuals, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">bg=</span><span class="st">"lightblue"</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">log</span>(Brain), model<span class="sc">$</span>fitted.values, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">bg=</span><span class="st">"lightblue"</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>,<span class="at">b=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel" data-null_prefix="true" data-layout-ncol="2" data-layout-align="center">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-mammalslog-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mammalslog-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="12-regression_files/figure-html/fig-mammalslog-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mammalslog-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.7: Fitted y vs Residuals
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-mammalslog-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mammalslog-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="12-regression_files/figure-html/fig-mammalslog-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mammalslog-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.8: Fitted y vs True y
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>That is much better! The residuals variance is constant and the plot of fitted vs true values shows a linear relationship. The log-log model is given by the formula <span class="math display">\[
\log \mathrm{Brain} = 2.18 + 0.74 \log \mathrm{Body}.
\]</span> seem to achieve two important goals, namely linearity and constant variance. The coefficients are highly significant.</p>
<p>Although the log-log model fits the data rather well, there are a couple of outliers there. Let us print the observations with the largest residuals.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># res = rstudent(model)</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">=</span> model<span class="sc">$</span>residuals<span class="sc">/</span><span class="fu">sd</span>(model<span class="sc">$</span>residuals)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>outliers <span class="ot">=</span> <span class="fu">order</span>(res,<span class="at">decreasing =</span> T)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(mammals[outliers,],</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">Std.Res =</span> res[outliers], <span class="at">Residual=</span>model<span class="sc">$</span>residuals[outliers],</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">Fit =</span> <span class="fu">exp</span>(model<span class="sc">$</span>fitted.values[outliers])) <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Mammal</th>
<th style="text-align: right;">Brain</th>
<th style="text-align: right;">Body</th>
<th style="text-align: right;">Std.Res</th>
<th style="text-align: right;">Residual</th>
<th style="text-align: right;">Fit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">11</td>
<td style="text-align: left;">Chinchilla</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: right;">3.41</td>
<td style="text-align: right;">2.61</td>
<td style="text-align: right;">4.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">34</td>
<td style="text-align: left;">Man</td>
<td style="text-align: right;">1320</td>
<td style="text-align: right;">62.00</td>
<td style="text-align: right;">2.53</td>
<td style="text-align: right;">1.93</td>
<td style="text-align: right;">190.7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">50</td>
<td style="text-align: left;">Rhesus_monkey</td>
<td style="text-align: right;">179</td>
<td style="text-align: right;">6.80</td>
<td style="text-align: right;">2.06</td>
<td style="text-align: right;">1.58</td>
<td style="text-align: right;">36.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">6</td>
<td style="text-align: left;">Baboon</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">10.55</td>
<td style="text-align: right;">1.64</td>
<td style="text-align: right;">1.26</td>
<td style="text-align: right;">51.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">42</td>
<td style="text-align: left;">Owl_monkey</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">1.44</td>
<td style="text-align: right;">1.10</td>
<td style="text-align: right;">5.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">10</td>
<td style="text-align: left;">Chimpanzee</td>
<td style="text-align: right;">440</td>
<td style="text-align: right;">52.16</td>
<td style="text-align: right;">1.26</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">167.7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">27</td>
<td style="text-align: left;">Ground_squirrel</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">1.18</td>
<td style="text-align: right;">0.91</td>
<td style="text-align: right;">1.6</td>
</tr>
<tr class="even">
<td style="text-align: left;">43</td>
<td style="text-align: left;">Patas_monkey</td>
<td style="text-align: right;">115</td>
<td style="text-align: right;">10.00</td>
<td style="text-align: right;">1.11</td>
<td style="text-align: right;">0.85</td>
<td style="text-align: right;">49.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">60</td>
<td style="text-align: left;">Vervet</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">4.19</td>
<td style="text-align: right;">1.06</td>
<td style="text-align: right;">0.81</td>
<td style="text-align: right;">25.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: left;">Arctic_Fox</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">3.38</td>
<td style="text-align: right;">0.92</td>
<td style="text-align: right;">0.71</td>
<td style="text-align: right;">22.0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>There are two outliers, the Chinchilla and the Human, both have disproportionately large brains!</p>
<p>In fact, the Chinchilla has the largest standardized residual of 3.41. Meaning that the predicted value of 4.7 g is 3.41 standard deviations away from the recorded value of 64 g. This suggests that the Chinchilla is a master race of supreme intelligence! However, after checking more carefully we realized that there was a recording error and the actual weight of an average Chinchilla’s brain is 6.4. We mistyped the decimal separator! Thus the actual residual is 0.4.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">abs</span>(model<span class="sc">$</span>fitted.values[<span class="dv">11</span>] <span class="sc">-</span> <span class="fu">log</span>(<span class="fl">6.4</span>))<span class="sc">/</span><span class="fu">sd</span>(model<span class="sc">$</span>residuals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 11 
0.4 </code></pre>
</div>
</div>
<p>In reality Chinchilla’s brain is not far from an average mammal of this size!</p>
</div>
<div id="exm-Newfood" class="theorem example">
<p><span class="theorem-title"><strong>Example 12.7 (Newfood)</strong></span> A six month market test has been performed on the Newfood product, which is a breakfast cereal. The goal is to build a multiple regression model that provides accurate sales forecasts. This dataset represents the outcome of a controlled experiment in which the values of the independent variables that affect sales were carefully chosen by the analyst.</p>
<p>The analysis aims to identify the factors that contribute to sales of a new breakfast cereal and to quantify the effects of business decisions such as the choice of advertising level, location in store, and pricing strategies.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;">variable</th>
<th style="text-align: center;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>sales</code></td>
<td style="text-align: center;">new cereal sales</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>price</code></td>
<td style="text-align: center;">price</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>adv</code></td>
<td style="text-align: center;">low or high advertising (<span class="math inline">\(0\)</span> or <span class="math inline">\(1\)</span>)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>locat</code></td>
<td style="text-align: center;">bread or breakfast section (<span class="math inline">\(0\)</span> or <span class="math inline">\(1\)</span>)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>inc</code></td>
<td style="text-align: center;">neighborhood income</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>svol</code></td>
<td style="text-align: center;">size of store</td>
</tr>
</tbody>
</table>
<p>First, we need to understand which variables need to be transformed. We start by running the “kitchen-sink” regression with all variables. Then we perform diagnostic checks to assess model assumptions and identify potential issues. Based on these diagnostics, we decide which variables should be transformed. After running the new model with transformations, we perform additional diagnostics and variable selection to refine the model. Using the final model after transformations and eliminating variables, we examine what the largest Cook’s distance is to identify influential observations. Finally, we provide a summary of coefficients and their statistical significance.</p>
<p>First, let’s examine the correlation matrix to understand the relationships between all variables in the dataset. This will help us identify potential multicollinearity issues and understand the strength and direction of associations between variables before building our regression model.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>newfood <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"../data/newfood.csv"</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(newfood)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(newfood)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> "sales"  "price"  "adv"    "locat"  "income" "svol"   "city"   "indx"  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># knitr::kable()</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(newfood)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">sales</th>
<th style="text-align: right;">price</th>
<th style="text-align: right;">adv</th>
<th style="text-align: right;">locat</th>
<th style="text-align: right;">income</th>
<th style="text-align: right;">svol</th>
<th style="text-align: right;">city</th>
<th style="text-align: right;">indx</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">225</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.3</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">190</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.3</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">205</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.3</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">323</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8.3</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">210</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8.3</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">241</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8.3</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># correlation matrix</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">=</span> <span class="fu">cor</span>(<span class="fu">cbind</span>(sales,price,adv,locat,income,svol))</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>cm[<span class="fu">upper.tri</span>(cm, <span class="at">diag =</span> <span class="cn">TRUE</span>)] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># knitr::kable(as.table(round(cm, 3)))</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">as.table</span>(<span class="fu">round</span>(cm, <span class="dv">3</span>)) <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">sales</th>
<th style="text-align: right;">price</th>
<th style="text-align: right;">adv</th>
<th style="text-align: right;">locat</th>
<th style="text-align: right;">income</th>
<th style="text-align: right;">svol</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">sales</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">price</td>
<td style="text-align: right;">-0.66</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">adv</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">locat</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">income</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">-0.13</td>
<td style="text-align: right;">-0.75</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">svol</td>
<td style="text-align: right;">0.38</td>
<td style="text-align: right;">-0.18</td>
<td style="text-align: right;">-0.74</td>
<td style="text-align: right;">-0.04</td>
<td style="text-align: right;">0.81</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Remember, correlations between variables are not the same as regression coefficients (<span class="math inline">\(\beta\)</span>’s)! Looking at the correlation matrix, we can see that total sales volume (<code>svol</code>) is negatively correlated with advertising (<code>adv</code>), and income (<code>income</code>) is also negatively correlated with advertising (<code>adv</code>). The question is how might these negative correlations impact our ability to estimate the true advertising effects in our regression model?</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.table</span>(<span class="fu">round</span>(cm[<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="dv">3</span>)) <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">sales</th>
<th style="text-align: right;">price</th>
<th style="text-align: right;">adv</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">price</td>
<td style="text-align: right;">-0.66</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">adv</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">locat</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>There’s no correlation in the <span class="math inline">\(X\)</span>’s by design! Let’s start by only including <code>price</code>, <code>adv</code>, <code>locat</code></p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">lm</span>(sales<span class="sc">~</span>price<span class="sc">+</span>adv<span class="sc">+</span>locat)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>model <span class="sc">%&gt;%</span>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">562.31</td>
<td style="text-align: right;">53.1</td>
<td style="text-align: right;">10.58</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">price</td>
<td style="text-align: right;">-12.81</td>
<td style="text-align: right;">1.8</td>
<td style="text-align: right;">-7.20</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">adv</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">14.5</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.99</td>
</tr>
<tr class="even">
<td style="text-align: left;">locat</td>
<td style="text-align: right;">-0.22</td>
<td style="text-align: right;">14.5</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">0.99</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Why is the marketer likely to be upset by this regression? Why is the economist happy? Let’s add <code>income</code> and <code>svol</code> to the regression and use log-log model.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">lm</span>(<span class="fu">log</span>(sales) <span class="sc">~</span> <span class="fu">log</span>(price) <span class="sc">+</span> adv <span class="sc">+</span> locat <span class="sc">+</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>           <span class="fu">log</span>(income) <span class="sc">+</span> <span class="fu">log</span>(svol))</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>model <span class="sc">%&gt;%</span>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">8.41</td>
<td style="text-align: right;">1.39</td>
<td style="text-align: right;">6.06</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">log(price)</td>
<td style="text-align: right;">-1.74</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">-7.90</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">adv</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">1.49</td>
<td style="text-align: right;">0.14</td>
</tr>
<tr class="even">
<td style="text-align: left;">locat</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.99</td>
</tr>
<tr class="odd">
<td style="text-align: left;">log(income)</td>
<td style="text-align: right;">-0.52</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">-1.06</td>
<td style="text-align: right;">0.29</td>
</tr>
<tr class="even">
<td style="text-align: left;">log(svol)</td>
<td style="text-align: right;">1.03</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">4.04</td>
<td style="text-align: right;">0.00</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Why no logs for <code>adv</code> and <code>locat</code> variables? The log(<code>svol</code>) coefficient is close to one!</p>
<p>The reason we don’t apply logarithms to <code>adv</code> and <code>locat</code> variables is because they are binary categorical variables (taking values 0 or 1). Taking the logarithm of 0 is undefined, and taking the logarithm of 1 equals 0, which would not provide any meaningful transformation. For binary variables, the exponential transformation in the final model interpretation directly gives us the multiplicative effect on sales when the variable changes from 0 to 1.</p>
<p>Regarding the log(<code>svol</code>) coefficient being close to one (1.03), this suggests that sales scale approximately proportionally with store volume. A coefficient of 1.0 would indicate perfect proportional scaling, meaning a 1% increase in store volume would lead to a 1% increase in sales. Our coefficient of 1.03 indicates slightly more than proportional scaling—a 1% increase in store volume leads to a 1.03% increase in sales, suggesting some economies of scale or network effects in larger stores.</p>
<p>On the transformed scale (log-log model), <span class="math display">\[
\log sales=8.41 - 1.74 \log price + 0.150 {\text{adv}} + 0.001 {\text{locat}} - 0.524 \log inc  + 1.03 \log svol
\]</span> On the un-transformed scale, <span class="math display">\[
\text{sales} = e^{8.41} ( \text{price} )^{-1.74} e^{ 0.15 \text{adv} } e^{ 0.001 \text{locat}} ( \text{inc} )^{-0.524}  ( \text{svol} )^{1.03}
\]</span> In the log-log regression model, the relationship between sales and the continuous variables (price, income, and store volume) follows a power function relationship. This means that a 1% change in these variables leads to a proportional change in sales according to their respective coefficients. Specifically, a 1% increase in price leads to a 1.74% decrease in sales, a 1% increase in income leads to a 0.524% decrease in sales, and a 1% increase in store volume leads to a 1.03% increase in sales.</p>
<p>In contrast, the binary variables (advertising and location) follow an exponential relationship with sales. When advertising is present (adv=1), sales increase by a factor of e^0.15 = 1.16, representing a 16% improvement. Similarly, when a store is in a good location (locat=1), sales increase by a factor of e^0.001 = 1.001, representing a 0.1% improvement. This exponential relationship arises because these variables are binary (0 or 1) and cannot be log-transformed, so their effects are multiplicative on the original sales scale.</p>
<p>The log-log regression model reveals several important relationships between the independent variables and sales performance.</p>
<ul>
<li>Price elasticity is <span class="math inline">\(\hat{\beta}_{\text{price}} = - 1.74\)</span>. A <span class="math inline">\(1\)</span>% increase in price will drop sales <span class="math inline">\(1.74\)</span>%</li>
<li><span class="math inline">\(\mathrm{adv}=1\)</span> increases <code>sales</code> by a factor of <span class="math inline">\(e^{0.15} = 1.16\)</span>. That’s a <span class="math inline">\(16\)</span>% improvement</li>
</ul>
<p>We should delete the <code>locat</code> variable from our regression model because it is statistically insignificant. The coefficient for <code>locat</code> has a very small magnitude (0.001) and a high p-value, indicating that there is insufficient evidence to reject the null hypothesis that this variable has no effect on sales. Including statistically insignificant variables in a model can lead to overfitting and reduce the model’s predictive accuracy on new data. By removing <code>locat</code>, we create a more parsimonious model that focuses only on the variables that have meaningful relationships with the outcome variable.</p>
<p>Now, we are ready to use our model for prediction. <code>predict.lm</code> provides a <span class="math inline">\(\hat{Y}\)</span>-prediction given a new <span class="math inline">\(X_f\)</span></p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>modelnew <span class="ot">=</span> <span class="fu">lm</span>(<span class="fu">log</span>(sales)<span class="sc">~</span><span class="fu">log</span>(price)<span class="sc">+</span>adv<span class="sc">+</span><span class="fu">log</span>(income)<span class="sc">+</span><span class="fu">log</span>(svol))</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>modelnew  <span class="sc">%&gt;%</span> <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">8.41</td>
<td style="text-align: right;">1.37</td>
<td style="text-align: right;">6.1</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">log(price)</td>
<td style="text-align: right;">-1.74</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">-8.0</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">adv</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">0.14</td>
</tr>
<tr class="even">
<td style="text-align: left;">log(income)</td>
<td style="text-align: right;">-0.52</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">-1.1</td>
<td style="text-align: right;">0.29</td>
</tr>
<tr class="odd">
<td style="text-align: left;">log(svol)</td>
<td style="text-align: right;">1.03</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">4.1</td>
<td style="text-align: right;">0.00</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>newdata<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">price=</span><span class="dv">30</span>,<span class="at">adv=</span><span class="dv">1</span>,<span class="at">income=</span><span class="dv">8</span>,<span class="at">svol=</span><span class="dv">34</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict.lm</span>(modelnew, newdata, <span class="at">interval=</span><span class="st">"confidence"</span>, <span class="at">level=</span><span class="fl">0.99</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  fit lwr upr
1 5.2 4.9 5.5</code></pre>
</div>
</div>
<p>Exponentiate-back to find <span class="math inline">\(\text{sales} = e^{5.1739} = 176.60\)</span>.</p>
</div>
</section>
</section>
<section id="interactions" class="level2" data-number="12.3">
<h2 data-number="12.3" class="anchored" data-anchor-id="interactions"><span class="header-section-number">12.3</span> Interactions</h2>
<p>In many situations, <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span> interact when predicting <span class="math inline">\(Y\)</span>. An interaction occurs when the effect of one independent variable on the dependent variable changes at different levels of another independent variable. For example, consider a study analyzing the effect of study hours <span class="math inline">\(X_1\)</span> and a tutoring program <span class="math inline">\(X_2\)</span>, a binary variable where 0 = no tutoring, 1 = tutoring) on test scores <span class="math inline">\(Y\)</span>. Without an interaction term, we assume the effect of study hours on test scores is the same regardless of tutoring. With an interaction term, we can explore whether the effect of study hours on test scores is different for those who receive tutoring compared to those who do not. Here are a few more examples when there is potential interaction.</p>
<p>Examples of potential interactions include whether gender changes the effect of education on wages, whether patients recover faster when taking drug A, and how advertisement affects price sensitivity. Interactions are particularly useful with dummy variables. We can build a kitchen-sink model with all possible dummies (day of the week, gender, etc.).</p>
<p>If we think that the effect of <span class="math inline">\(X_1\)</span> on <span class="math inline">\(Y\)</span> depends on the value of <span class="math inline">\(X_2\)</span>, we model it using a linear relation <span class="math display">\[
\beta_1 = \beta_{10} + \beta_{11} X_2
\]</span> and the model without interaction <span class="math inline">\(Y = \beta_0 + \beta_1 X_1 + \beta_2 X_2\)</span> becomes <span class="math display">\[
Y = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \beta_3 X_1 X_2 + \epsilon.
\]</span> The interaction term captures the effect of <span class="math inline">\(X_1\)</span> on <span class="math inline">\(Y\)</span> when <span class="math inline">\(X_2=1\)</span>. The coefficient <span class="math inline">\(\beta_3\)</span> is the difference in the effect of <span class="math inline">\(X_1\)</span> on <span class="math inline">\(Y\)</span> when <span class="math inline">\(X_2=1\)</span> and <span class="math inline">\(X_2=0\)</span>. If <span class="math inline">\(\beta_3\)</span> is significant, then there is an interaction effect. If <span class="math inline">\(\beta_3\)</span> is not significant, then there is no interaction effect. The coefficients <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span> are called marginal effects.</p>
<p>In <code>R</code>:</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">lm</span>(<span class="at">y =</span> x1 <span class="sc">*</span> x2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>estimnates <span class="math inline">\(y = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \beta_3 X_1 X_2 + \epsilon\)</span>, and</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">lm</span>(<span class="at">y =</span> x1<span class="sc">:</span>x2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>estimates only <span class="math inline">\(y = \beta_3 X_1 X_2 + \epsilon\)</span></p>
<p>If <span class="math inline">\(\beta_3\)</span> is significant there’s an interaction effect and we must leave <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span> in the model whether they are significant or not.</p>
<p>When <span class="math inline">\(X_2 = D\)</span> is a dummy variable with values of zero or one, we typically run a regression of the form <span class="math display">\[y = \beta_0 + \beta_1 X_1 + \beta_2 X_1 \star D + \epsilon\]</span> The coefficient <span class="math inline">\(\beta_1 + \beta_2\)</span> is the effect of <span class="math inline">\(X_1\)</span> when <span class="math inline">\(D=1\)</span>. The coefficient <span class="math inline">\(\beta_1\)</span> is the effect when <span class="math inline">\(D=0\)</span>.</p>
<div id="exm-oj" class="theorem example">
<p><span class="theorem-title"><strong>Example 12.8 (Orange Juice)</strong></span> Understanding how advertising affects consumer price sensitivity is a fundamental question in marketing analytics. Do promotional campaigns make consumers more or less sensitive to price changes? To explore this question, we analyze a dataset from the orange juice category that includes sales data from 83 Chicagoland stores. This dataset provides rich information including price, sales volume (measured as log units moved), brand identity, and whether the product was featured in store displays or advertising circulars.</p>
<p>Let’s begin by examining the structure of the data and the basic relationships between variables.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>oj <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"./../data/oj.csv"</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(oj[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>], <span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 9%">
<col style="width: 15%">
<col style="width: 7%">
<col style="width: 12%">
<col style="width: 7%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 7%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">store</th>
<th style="text-align: left;">brand</th>
<th style="text-align: right;">week</th>
<th style="text-align: right;">logmove</th>
<th style="text-align: right;">feat</th>
<th style="text-align: right;">price</th>
<th style="text-align: right;">AGE60</th>
<th style="text-align: right;">EDUC</th>
<th style="text-align: right;">ETHNIC</th>
<th style="text-align: right;">INCOME</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">tropicana</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">9.0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3.9</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">tropicana</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">8.7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3.9</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">tropicana</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">8.2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3.9</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">tropicana</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">9.0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3.9</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">tropicana</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">9.1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3.9</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">11</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">lm</span>(logmove <span class="sc">~</span> <span class="fu">log</span>(price)<span class="sc">*</span>feat, <span class="at">data=</span>oj)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>model <span class="sc">%&gt;%</span>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">9.66</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">588</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">log(price)</td>
<td style="text-align: right;">-0.96</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">-51</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">feat</td>
<td style="text-align: right;">1.71</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">log(price):feat</td>
<td style="text-align: right;">-0.98</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">-23</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">lm</span>(<span class="fu">log</span>(price)<span class="sc">~</span> brand<span class="dv">-1</span>, <span class="at">data =</span> oj)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>model <span class="sc">%&gt;%</span>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">branddominicks</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">254</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">brandminute.maid</td>
<td style="text-align: right;">0.79</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">382</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">brandtropicana</td>
<td style="text-align: right;">1.03</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">500</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The dataset includes three major brands: Dominick’s (the store brand), Minute Maid, and Tropicana. We can visualize the price distributions and the relationship between price and sales for these brands.</p>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>brandcol <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"green"</span>,<span class="st">"red"</span>,<span class="st">"gold"</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>oj<span class="sc">$</span>brand <span class="ot">=</span> <span class="fu">factor</span>(oj<span class="sc">$</span>brand)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">log</span>(price) <span class="sc">~</span> brand, <span class="at">data=</span>oj, <span class="at">col=</span>brandcol)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(logmove <span class="sc">~</span> <span class="fu">log</span>(price), <span class="at">data=</span>oj, <span class="at">col=</span>brandcol[oj<span class="sc">$</span>brand], <span class="at">pch=</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel" data-null_prefix="true" data-layout-ncol="2" data-layout-align="center">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-regression_files/figure-html/oj-lm-plot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-regression_files/figure-html/oj-lm-plot-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</div>
<p>The boxplot reveals that Tropicana commands premium pricing, while Dominick’s store brand is positioned as the value option. The scatterplot shows a clear negative relationship between price and sales, as expected from basic economic theory: higher prices lead to lower sales volume.</p>
<p>A critical modeling decision is whether to use logarithmic transformations for our variables. Let’s examine the relationship between price and sales on both the original and log scales to determine which specification better captures the underlying relationship.</p>
<p>First, we plot sales against price on the original scale:</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-regression_files/figure-html/plot-oj-lm-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>The pattern suggests a nonlinear relationship that might be better captured with a transformation. Next, we examine the relationship between price and log(sales):</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>l1 <span class="ot">&lt;-</span> <span class="fu">loess</span>(logmove <span class="sc">~</span> price, <span class="at">data=</span>oj, <span class="at">span=</span><span class="dv">2</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>smoothed1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(l1) </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>ind <span class="ot">=</span> <span class="fu">order</span>(oj<span class="sc">$</span>price)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(logmove <span class="sc">~</span> price, <span class="at">data=</span>oj, <span class="at">col=</span>brandcol[oj<span class="sc">$</span>brand], <span class="at">pch=</span><span class="dv">16</span>, <span class="at">cex=</span><span class="fl">0.5</span>, <span class="at">ylab=</span><span class="st">"log(move)"</span>)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(smoothed1[ind], <span class="at">x=</span>oj<span class="sc">$</span>price[ind], <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-regression_files/figure-html/lines-smoothed1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>While this shows some improvement, the relationship still exhibits curvature. Finally, we examine the log-log specification:</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="at">bty=</span><span class="st">"n"</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(logmove <span class="sc">~</span> <span class="fu">log</span>(price), <span class="at">data=</span>oj, <span class="at">col=</span>brandcol[oj<span class="sc">$</span>brand], <span class="at">pch=</span><span class="dv">16</span>, <span class="at">cex=</span><span class="fl">0.5</span>, <span class="at">ylab=</span><span class="st">"log(move)"</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  brand_data <span class="ot">&lt;-</span> oj[oj<span class="sc">$</span>brand <span class="sc">==</span> <span class="fu">levels</span>(oj<span class="sc">$</span>brand)[i], ]</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  l2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(logmove <span class="sc">~</span> <span class="fu">log</span>(price), <span class="at">data=</span>brand_data)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  smoothed2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(l2)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  ind <span class="ot">&lt;-</span> <span class="fu">order</span>(brand_data<span class="sc">$</span>price)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(smoothed2[ind], <span class="at">x=</span><span class="fu">log</span>(brand_data<span class="sc">$</span>price[ind]), <span class="at">col=</span><span class="st">'blue'</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-regression_files/figure-html/lines-smoothed2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>The log-log specification produces a much more linear relationship. This makes economic sense: the relationship between price and sales is multiplicative rather than additive. A 10% increase in price leads to a proportional percentage decrease in sales, regardless of the starting price level. This constant elasticity model is the standard approach in demand analysis.</p>
<p>Our central research question is whether featuring a product in advertisements affects consumers’ price sensitivity. We start with a baseline model that includes both log price and the advertising indicator: <span class="math display">\[
\log(\mathrm{sales}) = \beta_0 + \beta_1\log(\mathrm{price}) + \beta_2 \mathrm{feat}.
\]</span></p>
<p>However, this model assumes that advertising only shifts demand up or down, without changing how consumers respond to price. To test whether advertising actually changes price sensitivity, we need to allow the price coefficient <span class="math inline">\(\beta_1\)</span> to vary with advertising. We can model this by assuming that the price sensitivity depends linearly on the advertising indicator: <span class="math display">\[
\beta_1 = \beta_3 +  \beta_4\mathrm{feat}.
\]</span></p>
<p>Substituting this into our demand equation gives us an interaction model: <span class="math display">\[
\log(\mathrm{sales}) = \beta_0 + (\beta_3 +  \beta_4\mathrm{feat})\log(\mathrm{price}) + \beta_2 \mathrm{feat}.
\]</span></p>
<p>Expanding this expression yields: <span class="math display">\[
\log(\mathrm{sales}) = \beta_0 + \beta_3\log(\mathrm{price}) +  \beta_4\mathrm{feat} \times \log(\mathrm{price}) + \beta_2 \mathrm{feat}.
\]</span></p>
<p>The coefficient <span class="math inline">\(\beta_4\)</span> on the interaction term tells us how much price sensitivity changes when the product is featured in advertising. Let’s estimate this model and compare it to simpler specifications.</p>
<p>First, we fit the basic model with only log price:</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(logmove <span class="sc">~</span> <span class="fu">log</span>(price), <span class="at">data=</span>oj) <span class="sc">%&gt;%</span>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">10.4</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">679</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">log(price)</td>
<td style="text-align: right;">-1.6</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">-87</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This simple model suggests a price elasticity of approximately -3.1, meaning a 1% increase in price leads to roughly a 3.1% decrease in sales.</p>
<p>Next, we add brand effects and the advertising indicator without interactions:</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(logmove <span class="sc">~</span> <span class="fu">log</span>(price) <span class="sc">+</span> feat <span class="sc">+</span> brand, <span class="at">data=</span>oj) <span class="sc">%&gt;%</span> </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">10.28</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">708</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">log(price)</td>
<td style="text-align: right;">-2.53</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">-116</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">feat</td>
<td style="text-align: right;">0.89</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">85</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">brandminute.maid</td>
<td style="text-align: right;">0.68</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">brandtropicana</td>
<td style="text-align: right;">1.30</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">88</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Now we estimate the full model with the interaction between price and advertising:</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>ojreg <span class="ot">&lt;-</span> <span class="fu">lm</span>(logmove <span class="sc">~</span> <span class="fu">log</span>(price)<span class="sc">*</span>feat, <span class="at">data=</span>oj)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>ojreg <span class="sc">%&gt;%</span>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">9.66</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">588</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">log(price)</td>
<td style="text-align: right;">-0.96</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">-51</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">feat</td>
<td style="text-align: right;">1.71</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">log(price):feat</td>
<td style="text-align: right;">-0.98</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">-23</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The results reveal a striking finding: the interaction coefficient is -0.98, which is highly statistically significant. When products are not featured (feat = 0), the price elasticity is -0.96. However, when products are featured in advertising (feat = 1), the price elasticity becomes <span class="math inline">\(-0.96 + (-0.98) = -1.94\)</span>, essentially doubling in magnitude. This means that advertising makes consumers nearly twice as sensitive to price changes.</p>
<p>This result seems counterintuitive at first. We might expect that advertising would make consumers less price-sensitive by building brand loyalty or highlighting non-price attributes. Why would advertising increase price sensitivity?</p>
<p>The explanation lies in the promotional strategy employed by retailers. Let’s examine the pricing behavior during advertising campaigns:</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="at">bty=</span><span class="st">"n"</span>) </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>doj <span class="ot">=</span> oj <span class="sc">%&gt;%</span> <span class="fu">filter</span>(brand<span class="sc">==</span><span class="st">"dominicks"</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="fl">4.2</span>,<span class="fl">4.6</span>,<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(price <span class="sc">~</span>  feat, <span class="at">data =</span> oj[oj<span class="sc">$</span>brand<span class="sc">==</span><span class="st">"dominicks"</span>,], <span class="at">col=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>), </span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">main=</span><span class="st">"Dominick's"</span>, <span class="at">ylab=</span><span class="st">"Price ($)"</span>)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(price <span class="sc">~</span>  feat, <span class="at">data =</span> oj[oj<span class="sc">$</span>brand<span class="sc">==</span><span class="st">"minute.maid"</span>,], <span class="at">col=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>), </span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">main=</span><span class="st">"Minute Maid"</span>, <span class="at">ylab=</span><span class="st">"Price ($)"</span>)</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(price <span class="sc">~</span>  feat, <span class="at">data =</span> oj[oj<span class="sc">$</span>brand<span class="sc">==</span><span class="st">"tropicana"</span>,], <span class="at">col=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>), </span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">main=</span><span class="st">"Tropicana"</span>, <span class="at">ylab=</span><span class="st">"Price ($)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-regression_files/figure-html/oj-box-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>The boxplots reveal the key insight: prices are systematically lower when products are featured (<code>feat</code> = 1) compared to when they are not (<code>feat</code> = 0). This is a classic promotional pricing strategy where advertising and price discounts are bundled together. Retailers use advertising to draw attention to temporary price reductions.</p>
<p>The increased price sensitivity we observe during advertising periods is not caused by the advertising itself making consumers more price-conscious. Rather, it reflects the fact that advertising campaigns coincide with periods of price variation, and consumers who respond to advertisements are precisely those who are most price-sensitive. The advertising serves as a signal that draws price-sensitive consumers into the market, creating a selected sample with higher elasticity.</p>
<p>This example demonstrates the importance of carefully interpreting interaction effects and understanding the underlying business practices that generate the data. What appears to be an advertising effect on price sensitivity is actually a selection effect driven by the correlation between advertising and pricing strategies.</p>
</div>
</section>
<section id="categorical-variables-and-dummy-encoding" class="level2" data-number="12.4">
<h2 data-number="12.4" class="anchored" data-anchor-id="categorical-variables-and-dummy-encoding"><span class="header-section-number">12.4</span> Categorical Variables and Dummy Encoding</h2>
<p>In our orange juice analysis, we want to understand how brand affects sales. Intuitively, we might want to include brand in our regression model:</p>
<p><span class="math display">\[
\log(\mathrm{sales}) = \beta_0 + \beta_1\log(\mathrm{price}) + \xcancel{\beta_2\mathrm{brand}}
\]</span></p>
<p>However, we immediately encounter a problem: brand is a categorical variable, not a numerical one. We have three brands in our dataset - Dominick’s, Minute Maid, and Tropicana - but these are labels, not numbers. How can we incorporate such categorical information into a mathematical equation that requires numerical coefficients?</p>
<p>The solution lies in creating <em>dummy variables</em> (also called indicator variables). For a categorical variable with <span class="math inline">\(k\)</span> categories, we create <span class="math inline">\(k-1\)</span> binary variables, each taking the value 1 if the observation belongs to that category and 0 otherwise. One category is designated as the reference category and is represented when all dummy variables equal zero.</p>
<p>For our three-brand scenario, we create two dummy variables as shown in the table below:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Brand</th>
<th style="text-align: center;">Intercept</th>
<th style="text-align: center;">brandminute.maid</th>
<th style="text-align: center;">brandtropicana</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">minute.maid</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">tropicana</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dominicks</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p>This encoding transforms our regression equation into:</p>
<p><span class="math display">\[
\log(\mathrm{sales}) = \beta_0 + \beta_1\log(\mathrm{price}) + \beta_{21}\mathrm{brandminute.maid} + \beta_{22}\mathrm{brandtropicana}.
\]</span></p>
<p>Fortunately, statistical software like R handles this transformation automatically when you include a categorical variable in your model specification:</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(logmove <span class="sc">~</span> <span class="fu">log</span>(price)<span class="sc">+</span>brand, <span class="at">data=</span>oj) <span class="sc">%&gt;%</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">10.83</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">745</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">log(price)</td>
<td style="text-align: right;">-3.14</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">-137</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">brandminute.maid</td>
<td style="text-align: right;">0.87</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">brandtropicana</td>
<td style="text-align: right;">1.53</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">94</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="exm-golf" class="theorem example">
<p><span class="theorem-title"><strong>Example 12.9 (Golf Performance Data)</strong></span> Dave Pelz has written two best-selling books for golfers, <em>Dave Pelz’s Short Game Bible</em>, and <em>Dave Pelz’s Putting Bible</em>. These books have become essential reading for serious golfers looking to improve their performance through data-driven analysis and scientific methodology.</p>
<p>Dave Pelz was formerly a “rocket scientist” (literally) at NASA, where he worked on the Apollo space program. His background in physics and engineering provided him with the analytical skills to revolutionize golf instruction through data analytics. His systematic approach to analyzing golf performance helped him refine his teaching methods and develop evidence-based strategies for improving players’ games. Through his research, Pelz discovered that it’s the short-game that matters most for overall scoring performance.</p>
<p>One of Pelz’s most famous findings concerns the optimal speed for a putt. Through extensive data collection and analysis, he determined that the best chance to make a putt is one that will leave the ball <span class="math inline">\(17\)</span> inches past the hole, if it misses. This counterintuitive result challenges the common belief that golfers should aim to leave putts just short of the hole. Pelz’s research showed that putts hit with this specific speed have the highest probability of going in, as they account for the natural variations in green speed, slope, and other factors that affect putt trajectory.</p>
<p>Now, we demonstrate how to use data to improve your golf game. We analyze the dataset that contains comprehensive year-end performance statistics for 195 professional golfers from the 2000 PGA Tour season. This rich dataset captures technicical abilities of the players as well as financial success (measured by the amount of prize money they made). Each observation represents season’s averages of the players’ performance and total prize money. List below shows the variables in the dataset.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 5%">
<col style="width: 94%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>nevents</code></td>
<td>The number of official PGA events included in the statistics</td>
</tr>
<tr class="even">
<td><code>money</code></td>
<td>The official dollar winnings of the player</td>
</tr>
<tr class="odd">
<td><code>drivedist</code></td>
<td>The average number of yards driven on par 4 and par 5 holes</td>
</tr>
<tr class="even">
<td><code>gir</code></td>
<td>Greens in regulation, measured as the percentage of time that the first (tee) shot on a par 3 hole ends up on the green, or the second shot on a par 4 hole ends up on the green, or the third shot on a par 5 hole ends up on the green</td>
</tr>
<tr class="odd">
<td><code>avgputts</code></td>
<td>The average number of putts per round</td>
</tr>
</tbody>
</table>
<p>We will analyze these data to determine which of the variables nevents, drivedist, gir, and avgputts is most important for winning money on the PGA Tour. We begin by performing a regression of Money on all explanatory variables:</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>d00 <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"../data/pga-2000.csv"</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>d18 <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"../data/pga-2018.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>model18 <span class="ot">=</span> <span class="fu">lm</span>(money <span class="sc">~</span> nevents <span class="sc">+</span> drivedist <span class="sc">+</span> gir <span class="sc">+</span> avgputts, <span class="at">data=</span>d18)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>model00 <span class="ot">=</span> <span class="fu">lm</span>(money <span class="sc">~</span> nevents <span class="sc">+</span> drivedist <span class="sc">+</span> gir <span class="sc">+</span> avgputts, <span class="at">data=</span>d00)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>model00 <span class="sc">%&gt;%</span>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">1.5e+07</td>
<td style="text-align: right;">4206466</td>
<td style="text-align: right;">3.5</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">nevents</td>
<td style="text-align: right;">-3.0e+04</td>
<td style="text-align: right;">11183</td>
<td style="text-align: right;">-2.7</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="odd">
<td style="text-align: left;">drivedist</td>
<td style="text-align: right;">2.1e+04</td>
<td style="text-align: right;">6913</td>
<td style="text-align: right;">3.1</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">gir</td>
<td style="text-align: right;">1.2e+05</td>
<td style="text-align: right;">17429</td>
<td style="text-align: right;">6.9</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">avgputts</td>
<td style="text-align: right;">-1.5e+07</td>
<td style="text-align: right;">2000905</td>
<td style="text-align: right;">-7.6</td>
<td style="text-align: right;">0.00</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Let’s look at the residuals:</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">rstandard</span>(model00), <span class="at">breaks=</span><span class="dv">20</span>, <span class="at">col=</span><span class="st">"lightblue"</span>, </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="at">xlab =</span> <span class="st">"Standardized Residual"</span>, <span class="at">main=</span><span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-regression_files/figure-html/pga-lm-plot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>It seems like we need to measure <code>money</code> on a log scale. Let’s transform with <code>log(Money)</code> as it has much better residual diagnostic plots.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">=</span> <span class="fu">lm</span>(<span class="at">formula =</span> <span class="fu">log</span>(money) <span class="sc">~</span> nevents <span class="sc">+</span> drivedist <span class="sc">+</span> gir <span class="sc">+</span> avgputts, <span class="at">data =</span> d00)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>m <span class="sc">%&gt;%</span> <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">36.15</td>
<td style="text-align: right;">3.58</td>
<td style="text-align: right;">10.10</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">nevents</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">-0.94</td>
<td style="text-align: right;">0.35</td>
</tr>
<tr class="odd">
<td style="text-align: left;">drivedist</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">2.40</td>
<td style="text-align: right;">0.02</td>
</tr>
<tr class="even">
<td style="text-align: left;">gir</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">11.18</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">avgputts</td>
<td style="text-align: right;">-21.13</td>
<td style="text-align: right;">1.70</td>
<td style="text-align: right;">-12.42</td>
<td style="text-align: right;">0.00</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="fl">4.5</span>,<span class="dv">0</span>,<span class="dv">0</span>),<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>model00log <span class="ot">=</span> <span class="fu">lm</span>(<span class="fu">log</span>(money) <span class="sc">~</span> nevents <span class="sc">+</span> drivedist <span class="sc">+</span> gir <span class="sc">+</span> avgputts, <span class="at">data=</span>d00)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>model00log <span class="sc">%&gt;%</span> <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">36.15</td>
<td style="text-align: right;">3.58</td>
<td style="text-align: right;">10.10</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">nevents</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">-0.94</td>
<td style="text-align: right;">0.35</td>
</tr>
<tr class="odd">
<td style="text-align: left;">drivedist</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">2.40</td>
<td style="text-align: right;">0.02</td>
</tr>
<tr class="even">
<td style="text-align: left;">gir</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">11.18</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">avgputts</td>
<td style="text-align: right;">-21.13</td>
<td style="text-align: right;">1.70</td>
<td style="text-align: right;">-12.42</td>
<td style="text-align: right;">0.00</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">rstandard</span>(model00log), <span class="at">breaks=</span><span class="dv">20</span>, <span class="at">col=</span><span class="st">"lightblue"</span>, </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="at">xlab =</span> <span class="st">"Standardized Residual"</span>, <span class="at">main=</span><span class="st">""</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(<span class="at">x0 =</span> <span class="dv">3</span>,<span class="at">y0 =</span> <span class="dv">20</span>,<span class="at">x1 =</span> <span class="fl">3.2</span>,<span class="at">y1 =</span> <span class="dv">2</span>,<span class="at">length =</span> <span class="fl">0.1</span>)</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="dv">3</span>,<span class="at">y =</span> <span class="dv">22</span>,<span class="at">labels =</span> <span class="st">"Tiger Woods"</span>, <span class="at">cex=</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-regression_files/figure-html/pga-lm-log-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Using log scale for <code>money</code> gives us a better model. We will keep it for now. How about selectng variables. Notice, that <span class="math inline">\(t\)</span>-stats for <code>nevents</code> is <span class="math inline">\(&lt;1.5\)</span>. Thus, we can remove it.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">=</span> <span class="fu">lm</span>(<span class="at">formula =</span> <span class="fu">log</span>(money) <span class="sc">~</span> drivedist <span class="sc">+</span> gir <span class="sc">+</span> avgputts, <span class="at">data =</span> d00)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>m1 <span class="sc">%&gt;%</span> <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">36.17</td>
<td style="text-align: right;">3.58</td>
<td style="text-align: right;">10.1</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">drivedist</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">2.5</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="odd">
<td style="text-align: left;">gir</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">11.2</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">avgputts</td>
<td style="text-align: right;">-21.37</td>
<td style="text-align: right;">1.68</td>
<td style="text-align: right;">-12.7</td>
<td style="text-align: right;">0.00</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>It is obvious that fewer putts indicate a better golfer. However, decreasing the average number of putts per round by one is extremely difficult to achieve.</p>
<p><strong>Evaluating the Coefficients</strong></p>
<ol type="1">
<li><p>Greens in Regulation (GIR) has a <span class="math inline">\(\hat{\beta} = 0.17\)</span>. If I can increase my GIR by one, I’ll earn <span class="math inline">\(e^{0.17} = 1.18\)</span>% An extra <span class="math inline">\(18\)</span>%.</p></li>
<li><p>DriveDis has a <span class="math inline">\(\hat{\beta} = 0.014\)</span>. A <span class="math inline">\(10\)</span> yard improvement, I’ll earn <span class="math inline">\(e^{0.014 \times 10} =e^{0.14}  = 1.15\)</span>% An extra <span class="math inline">\(15\)</span>%.</p></li>
</ol>
<p>Caveat: Everyone has gotten better since 2000!</p>
<p>Tiger Woods was nine standard deviations better than what the model predicted, while taking the natural logarithm of money earnings significantly improves the residual diagnostics and an exponential model appears to fit the data well as evidenced by the good residual diagnostic plots; furthermore, the t-ratios for the number of events variable are consistently under 1.5, indicating it may not be a significant predictor.</p>
<p>The outliers represent the biggest over and under-performers in terms of money winnings when compared with their performance statistics, and Tiger Woods, Phil Mickelson, and Ernie Els won major championships by performing exceptionally well during tournaments with substantial prize money available.</p>
<p>We can see the over-performers and under-performers in the data.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Over-Performers</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">name</th>
<th style="text-align: center;">money</th>
<th style="text-align: center;">Predicted</th>
<th style="text-align: center;">Error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: center;">Tiger Woods</td>
<td style="text-align: center;">9188321</td>
<td style="text-align: center;">3584241</td>
<td style="text-align: center;">5604080</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: center;">Phil Mickelson</td>
<td style="text-align: center;">4746457</td>
<td style="text-align: center;">2302171</td>
<td style="text-align: center;">2444286</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: center;">Ernie Els</td>
<td style="text-align: center;">3469405</td>
<td style="text-align: center;">1633468</td>
<td style="text-align: center;">1835937</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: center;">Hal Sutton</td>
<td style="text-align: center;">3061444</td>
<td style="text-align: center;">1445904</td>
<td style="text-align: center;">1615540</td>
</tr>
<tr class="odd">
<td style="text-align: left;">20</td>
<td style="text-align: center;">Notah Begay III</td>
<td style="text-align: center;">1819323</td>
<td style="text-align: center;">426061</td>
<td style="text-align: center;">1393262</td>
</tr>
<tr class="even">
<td style="text-align: left;">182</td>
<td style="text-align: center;">Steve Hart</td>
<td style="text-align: center;">107949</td>
<td style="text-align: center;">-1186685</td>
<td style="text-align: center;">1294634</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Now, let’s extract the list of underperformers, which are given by large negative residuals. According to our model, Glasson and Stankowski should win more money based on their performance statistics, but they are not achieving the expected earnings. This could be due to several factors: they might be performing well in practice rounds but struggling under tournament pressure, they could be playing in fewer high-payout events, or their performance metrics might not capture other important aspects of tournament success like clutch putting or mental toughness during critical moments.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Under-Performers</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">name</th>
<th style="text-align: center;">money</th>
<th style="text-align: center;">Predicted</th>
<th style="text-align: center;">Error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">47</td>
<td style="text-align: center;">Fred Couples</td>
<td style="text-align: center;">990215</td>
<td style="text-align: center;">1978477</td>
<td style="text-align: center;">-988262</td>
</tr>
<tr class="even">
<td style="text-align: left;">52</td>
<td style="text-align: center;">Kenny Perry</td>
<td style="text-align: center;">889381</td>
<td style="text-align: center;">1965740</td>
<td style="text-align: center;">-1076359</td>
</tr>
<tr class="odd">
<td style="text-align: left;">70</td>
<td style="text-align: center;">Paul Stankowski</td>
<td style="text-align: center;">669709</td>
<td style="text-align: center;">1808690</td>
<td style="text-align: center;">-1138981</td>
</tr>
<tr class="even">
<td style="text-align: left;">85</td>
<td style="text-align: center;">Bill Glasson</td>
<td style="text-align: center;">552795</td>
<td style="text-align: center;">1711530</td>
<td style="text-align: center;">-1158735</td>
</tr>
<tr class="odd">
<td style="text-align: left;">142</td>
<td style="text-align: center;">Jim McGovern</td>
<td style="text-align: center;">266647</td>
<td style="text-align: center;">1397818</td>
<td style="text-align: center;">-1131171</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Lets look at 2018 data, the highest earners are</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Highest earners 2018</caption>
<thead>
<tr class="header">
<th style="text-align: center;">name</th>
<th style="text-align: center;">nevents</th>
<th style="text-align: center;">money</th>
<th style="text-align: center;">drivedist</th>
<th style="text-align: center;">gir</th>
<th style="text-align: center;">avgputts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Justin Thomas</td>
<td style="text-align: center;">23</td>
<td style="text-align: center;">8694821</td>
<td style="text-align: center;">312</td>
<td style="text-align: center;">69</td>
<td style="text-align: center;">1.7</td>
</tr>
<tr class="even">
<td style="text-align: center;">Dustin Johnson</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">8457352</td>
<td style="text-align: center;">314</td>
<td style="text-align: center;">71</td>
<td style="text-align: center;">1.7</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Justin Rose</td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">8130678</td>
<td style="text-align: center;">304</td>
<td style="text-align: center;">70</td>
<td style="text-align: center;">1.7</td>
</tr>
<tr class="even">
<td style="text-align: center;">Bryson DeChambeau</td>
<td style="text-align: center;">26</td>
<td style="text-align: center;">8094489</td>
<td style="text-align: center;">306</td>
<td style="text-align: center;">70</td>
<td style="text-align: center;">1.8</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Brooks Koepka</td>
<td style="text-align: center;">17</td>
<td style="text-align: center;">7094047</td>
<td style="text-align: center;">313</td>
<td style="text-align: center;">68</td>
<td style="text-align: center;">1.8</td>
</tr>
<tr class="even">
<td style="text-align: center;">Bubba Watson</td>
<td style="text-align: center;">24</td>
<td style="text-align: center;">5793748</td>
<td style="text-align: center;">313</td>
<td style="text-align: center;">68</td>
<td style="text-align: center;">1.8</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Overperformers</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Overperformers 2018</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">name</th>
<th style="text-align: center;">money</th>
<th style="text-align: center;">Predicted</th>
<th style="text-align: center;">Error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: center;">Justin Thomas</td>
<td style="text-align: center;">8694821</td>
<td style="text-align: center;">5026220</td>
<td style="text-align: center;">3668601</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: center;">Dustin Johnson</td>
<td style="text-align: center;">8457352</td>
<td style="text-align: center;">6126775</td>
<td style="text-align: center;">2330577</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: center;">Justin Rose</td>
<td style="text-align: center;">8130678</td>
<td style="text-align: center;">4392812</td>
<td style="text-align: center;">3737866</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: center;">Bryson DeChambeau</td>
<td style="text-align: center;">8094489</td>
<td style="text-align: center;">3250898</td>
<td style="text-align: center;">4843591</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: center;">Brooks Koepka</td>
<td style="text-align: center;">7094047</td>
<td style="text-align: center;">4219781</td>
<td style="text-align: center;">2874266</td>
</tr>
<tr class="even">
<td style="text-align: left;">6</td>
<td style="text-align: center;">Bubba Watson</td>
<td style="text-align: center;">5793748</td>
<td style="text-align: center;">3018004</td>
<td style="text-align: center;">2775744</td>
</tr>
<tr class="odd">
<td style="text-align: left;">9</td>
<td style="text-align: center;">Webb Simpson</td>
<td style="text-align: center;">5376417</td>
<td style="text-align: center;">2766988</td>
<td style="text-align: center;">2609429</td>
</tr>
<tr class="even">
<td style="text-align: left;">11</td>
<td style="text-align: center;">Francesco Molinari</td>
<td style="text-align: center;">5065842</td>
<td style="text-align: center;">2634466</td>
<td style="text-align: center;">2431376</td>
</tr>
<tr class="odd">
<td style="text-align: left;">12</td>
<td style="text-align: center;">Patrick Reed</td>
<td style="text-align: center;">5006267</td>
<td style="text-align: center;">2038455</td>
<td style="text-align: center;">2967812</td>
</tr>
<tr class="even">
<td style="text-align: left;">84</td>
<td style="text-align: center;">Satoshi Kodaira</td>
<td style="text-align: center;">1471462</td>
<td style="text-align: center;">-1141085</td>
<td style="text-align: center;">2612547</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Underperformers</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Underperformers 2018</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">name</th>
<th style="text-align: center;">money</th>
<th style="text-align: center;">Predicted</th>
<th style="text-align: center;">Error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">102</td>
<td style="text-align: center;">Trey Mullinax</td>
<td style="text-align: center;">1184245</td>
<td style="text-align: center;">3250089</td>
<td style="text-align: center;">-2065844</td>
</tr>
<tr class="even">
<td style="text-align: left;">120</td>
<td style="text-align: center;">J.T. Poston</td>
<td style="text-align: center;">940661</td>
<td style="text-align: center;">3241369</td>
<td style="text-align: center;">-2300708</td>
</tr>
<tr class="odd">
<td style="text-align: left;">135</td>
<td style="text-align: center;">Tom Lovelady</td>
<td style="text-align: center;">700783</td>
<td style="text-align: center;">2755854</td>
<td style="text-align: center;">-2055071</td>
</tr>
<tr class="even">
<td style="text-align: left;">148</td>
<td style="text-align: center;">Michael Thompson</td>
<td style="text-align: center;">563972</td>
<td style="text-align: center;">2512330</td>
<td style="text-align: center;">-1948358</td>
</tr>
<tr class="odd">
<td style="text-align: left;">150</td>
<td style="text-align: center;">Matt Jones</td>
<td style="text-align: center;">538681</td>
<td style="text-align: center;">2487139</td>
<td style="text-align: center;">-1948458</td>
</tr>
<tr class="even">
<td style="text-align: left;">158</td>
<td style="text-align: center;">Hunter Mahan</td>
<td style="text-align: center;">457337</td>
<td style="text-align: center;">2855898</td>
<td style="text-align: center;">-2398561</td>
</tr>
<tr class="odd">
<td style="text-align: left;">168</td>
<td style="text-align: center;">Cameron Percy</td>
<td style="text-align: center;">387612</td>
<td style="text-align: center;">3021278</td>
<td style="text-align: center;">-2633666</td>
</tr>
<tr class="even">
<td style="text-align: left;">173</td>
<td style="text-align: center;">Ricky Barnes</td>
<td style="text-align: center;">340591</td>
<td style="text-align: center;">3053262</td>
<td style="text-align: center;">-2712671</td>
</tr>
<tr class="odd">
<td style="text-align: left;">176</td>
<td style="text-align: center;">Brett Stegmaier</td>
<td style="text-align: center;">305607</td>
<td style="text-align: center;">2432494</td>
<td style="text-align: center;">-2126887</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Our analysis reveals three particularly interesting effects from the golf performance data, with Tiger Woods demonstrating exceptional performance as an outlier that is eight standard deviations above the model’s predictions, indicating his extraordinary success relative to his statistical metrics, while the model shows that increasing driving distance by ten yards corresponds to a fifteen percent increase in earnings, suggesting that power off the tee provides a significant competitive advantage in professional golf, and additionally, improving greens in regulation (GIR) by one percentage point leads to an eighteen percent increase in earnings, highlighting the importance of approach shot accuracy in determining financial success on the PGA Tour, with the model also successfully identifying both under-performers and over-performers, players whose actual earnings significantly differ from what their statistical performance would predict, providing valuable insights into which players may be exceeding or falling short of expectations based on their measurable skills, demonstrating the practical applications of statistical modeling in sports analytics and performance evaluation.</p>
</div>
</section>
<section id="bayes-regression" class="level2" data-number="12.5">
<h2 data-number="12.5" class="anchored" data-anchor-id="bayes-regression"><span class="header-section-number">12.5</span> Bayes Regression</h2>
<p>Consider a linear regression <span class="math display">\[
f_{\beta}(x) = x^T\beta + \epsilon,~~~\epsilon \sim N(0,\sigma_e).
\]</span> We put a zero mean Gaussian prior on the model parameters <span class="math display">\[
\beta \sim N(0,\Sigma).
\]</span> Bayesian inference is to calculate posterior given the data <span class="math display">\[
p(\beta\mid y,X) = \dfrac{p(y\mid X,\beta)p(\beta)}{p(y\mid X)}.
\]</span> Product of two Gaussian density functions lead to another Gaussian <span class="math display">\[
\begin{aligned}
p(\beta\mid y,X)  &amp; \propto \exp\left(-\dfrac{1}{2\sigma_e^2}(y-\beta^TX)^T(y-\beta^TX)\right)\exp\left(-\dfrac{1}{2}\beta^T\Sigma^{-1}\beta\right)\\
&amp; \propto \exp\left(-\dfrac{1}{2}(\beta - \bar\beta)^T\left(\dfrac{1}{\sigma_e^2XX^T + \Sigma^{-1}}\right)(\beta-\bar\beta)\right)
\end{aligned}
\]</span></p>
<p>Thus, the posterior is <span class="math display">\[
\beta\mid X,y \sim N(\bar\beta,A^{-1}),
\]</span> where <span class="math inline">\(A = \left(\sigma_e^{-2}XX^T + \Sigma\right)\)</span>, and <span class="math inline">\(\bar\beta = \sigma_e^{-2}A^{-1}Xy\)</span>.</p>
<div id="exm-posterior" class="theorem example">
<p><span class="theorem-title"><strong>Example 12.10 (Posterior)</strong></span> Consider a model with <span class="math inline">\(p = 1\)</span> <span class="math display">\[
y = \beta_0 + \beta_1 x + \epsilon, ~~ \beta_i \sim N(0,1),~~~\sigma_e = 1
\]</span> Let’s plot a sample from the prior set of functions</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fig/bayes-lm-prior.svg" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption>Sample from prior distribution over possible linear models</figcaption>
</figure>
</div>
<p>Now, say we observed two points <span class="math inline">\((1,1)\)</span> and <span class="math inline">\((2,2)\)</span>, we can calculate the posterior <span class="math inline">\(\beta \mid X,y \sim N(0.833, 0.166)\)</span></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fig/bayes-lm-post.svg" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption>Sample from posterior distribution over possible linear models</figcaption>
</figure>
</div>
<p>Why our posterior mean is not 1?</p>
</div>
<section id="horseshoe-for-linear-regression" class="level3">
<h3 class="anchored" data-anchor-id="horseshoe-for-linear-regression">Horseshoe for Linear regression</h3>
<p>The linear regression model is given by <span class="math display">\[Y = X\beta + \varepsilon,\]</span></p>
<p>where <span class="math inline">\(Y\)</span> and <span class="math inline">\(\varepsilon\)</span> are vectors of length <span class="math inline">\(n\)</span>, <span class="math inline">\(\beta\)</span> is a vector of length <span class="math inline">\(p\)</span> and <span class="math inline">\(X\)</span> is an <span class="math inline">\(n \times p\)</span>-matrix. We assume <span class="math inline">\(\varepsilon \sim \mathcal{N}(0, I_n)\)</span>. The main function for the horseshoe for the linear regression model is <code>horseshoe</code> and it implements the algorithm of Bhattacharya et al (2016).</p>
<p>The options of <code>horseshoe</code> are the same as for <code>HS.normal.means</code> (discussed above, although in case of linear regression it is less clear which prior to use for <span class="math inline">\(\tau\)</span>). We illustrate the use of <code>horseshoe</code> via an example.</p>
<p>We create a 50 by 100 design matrix <span class="math inline">\(X\)</span> filled with realizations of independent normal random variables. The first 10 entries of the vector <span class="math inline">\(\beta\)</span> are set equal to six (the signals) and the remaining 90 entries are set equal to zero (the noise).</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">50</span><span class="sc">*</span><span class="dv">100</span>), <span class="dv">50</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">6</span>, <span class="dv">10</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">90</span>))</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> X <span class="sc">%*%</span> beta <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We use the horseshoe and plot the posterior mean and marginal 95% credible interval per parameter in red. The true parameter values are shown in black.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(horseshoe)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>hs.object <span class="ot">&lt;-</span> <span class="fu">horseshoe</span>(y, X, <span class="at">method.tau =</span> <span class="st">"truncatedCauchy"</span>, <span class="at">method.sigma =</span><span class="st">"Jeffreys"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 1000
 2000
 3000
 4000
 5000
 6000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">index =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">truth =</span> beta,</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">post.mean =</span> hs.object<span class="sc">$</span>BetaHat,</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>                 lower.CI <span class="ot">&lt;-</span> hs.object<span class="sc">$</span>LeftCI,</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>                 upper.CI <span class="ot">&lt;-</span> hs.object<span class="sc">$</span>RightCI</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> truth)) <span class="sc">+</span> </span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> post.mean), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower.CI, <span class="at">ymax =</span> upper.CI), <span class="at">width =</span> .<span class="dv">1</span>, <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Black = truth, Red = estimates with 95% credible intervals"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-regression_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>We again perform variable selection. The function, <code>HS.var.select</code>, is the same as described above for the normal means problem. Here we show how it works when variables are selected by checking whether 0 is in the credible interval. For the thresholding procedure, please refer to the normal means example above.</p>
<p>We perform variable selection:</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>selected.CI <span class="ot">&lt;-</span> <span class="fu">HS.var.select</span>(hs.object, df<span class="sc">$</span>y, <span class="at">method =</span> <span class="st">"intervals"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The result is a vector of zeroes and ones, with the ones indicating that the observations is suspected to correspond to an actual signal. We now plot the results, coloring the estimates/intervals blue if a signal is detected and red otherwise.</p>
<div class="cell" data-layout-align="center" data-null_prefix="true">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> truth)) <span class="sc">+</span> </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> post.mean, <span class="at">col =</span> <span class="fu">factor</span>(selected.CI)), </span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower.CI, <span class="at">ymax =</span> upper.CI, <span class="at">col =</span> <span class="fu">factor</span>(selected.CI)),</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Black = truth, Blue = selected as signal, Red = selected as noise"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-regression_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="quantile-regression" class="level2" data-number="12.6">
<h2 data-number="12.6" class="anchored" data-anchor-id="quantile-regression"><span class="header-section-number">12.6</span> Quantile Regression</h2>
<p><strong>The least absolute deviations (Quantile)</strong> loss function is the sum of absolute differences between the predicted and actual values. It is used for regression problems with continuous variables. The goal is to minimize the sum of absolute errors (SAE) to improve the predictive performance of the model. Given observed data set the least absolute deviations estimator is the value of <span class="math inline">\(\beta\)</span> that minimizes the sum of absolute errors <span class="math display">\[
\mini_{\beta}\sum_{i=1}^n |y_i - f_{\beta}(x_i)|
\]</span> The least absolute deviations estimator is also known as the quantile estimator, where the quantile is set to 0.5 (the median). This is because the least absolute deviations estimator is equivalent to the median of the data (the 0.5 quantile).</p>
<p>Again, in the unconditional case, when we do not observe any inputs <span class="math inline">\(x\)</span>, the least absolute deviations estimator is the sample median. To solve this minimization problem, we need to consider the concept of a <em>subgradient</em>, since the absolute value function is not differentiable at zero.</p>
<p>A subgradient generalizes the idea of a derivative for functions that are not differentiable everywhere. For a convex function <span class="math inline">\(f(x)\)</span>, a subgradient at a point <span class="math inline">\(x_0\)</span> is any value <span class="math inline">\(g\)</span> such that for all <span class="math inline">\(x\)</span>, <span class="math display">\[
f(x) \geq f(x_0) + g(x - x_0).
\]</span> The set of all such <span class="math inline">\(g\)</span> is called the <em>subdifferential</em> at <span class="math inline">\(x_0\)</span>.</p>
<p>For the absolute value function, the subgradient is given by: <span class="math display">\[
\frac{\partial}{\partial x} |x| =
\begin{cases}
1 &amp; \text{if } x &gt; 0 \\
-1 &amp; \text{if } x &lt; 0 \\
[-1, 1] &amp; \text{if } x = 0
\end{cases}
\]</span> That is, at <span class="math inline">\(x = 0\)</span>, any value between <span class="math inline">\(-1\)</span> and <span class="math inline">\(1\)</span> is a valid subgradient.</p>
<p>Applying this to our minimization problem, the subgradient of the sum of absolute deviations with respect to <span class="math inline">\(\beta\)</span> is: <span class="math display">\[
\sum_{i=1}^n \operatorname{sign}(y_i - \beta).
\]</span> This equals to zero only when the number of positive items equals the number of negative which happens when <span class="math inline">\(\beta\)</span> is the median.</p>
<!-- https://math.stackexchange.com/questions/113270/the-median-minimizes-the-sum-of-absolute-deviations-the-ell-1-norm -->
<p>A more rigorous and non-calculus proof is due to <span class="citation" data-cites="schwertman1990simple">Schwertman, Gilks, and Cameron (<a href="references.html#ref-schwertman1990simple" role="doc-biblioref">1990</a>)</span>. Let <span class="math inline">\(y_1,\ldots,y_n\)</span> be the observed data and <span class="math inline">\(\hat{\beta}\)</span> be the least absolute deviations estimator. Then we have <span class="math display">\[
\sum_{i=1}^n |y_i - \hat{\beta}| \leq \sum_{i=1}^n |y_i - \beta|
\]</span> for any <span class="math inline">\(\beta\)</span>. Let <span class="math inline">\(y_{(1)},\ldots,y_{(n)}\)</span> be the ordered data. Then we have <span class="math display">\[
\sum_{i=1}^n |y_i - \hat{\beta}| \leq \sum_{i=1}^n |y_i - y_{(i)}|
\]</span> Let <span class="math inline">\(y_{(n/2)}\)</span> be the median of the data. Then we have <span class="math display">\[
\sum_{i=1}^n |y_i - \hat{\beta}| \leq \sum_{i=1}^n |y_i - y_{(n/2)}|
\]</span> which implies that <span class="math inline">\(\hat{\beta}\)</span> is the median of the data.</p>
<p>The generalization of the median estimator to the case of estimating value of quantile <span class="math inline">\(\tau\)</span> is as follows <span class="math display">\[
\mini_{\beta}\sum_{i=1}^n \rho_{\tau}(y_i - \beta)
\]</span> where <span class="math inline">\(\rho_{\tau}(x) = x(\tau - \mathbb{I}(x &lt; 0))\)</span> is the quantile loss function. If we set <span class="math inline">\(\tau = 0.5\)</span>, the loss function becomes the absolute value function and we get the median estimator. The expected loss is <span class="math display">\[
E \rho_{\tau}(y - \beta) = (\tau-1)\int_{-\infty}^{\beta} (y-\beta)dF(y) + \tau\int_{\beta}^{\infty} (y-\beta)dF(y)
\]</span> Differentiating the expected loss function with respect to <span class="math inline">\(\beta\)</span> and setting it to zero gives the quantile estimator <span class="math display">\[
\hat{\beta}_{\tau} = F^{-1}(\tau)
\]</span> where <span class="math inline">\(F^{-1}\)</span> is the quantile function of the distribution of <span class="math inline">\(y\)</span>. Thus, the problem of finding a quantile is solved via optimization.</p>
<p>A key difference between the least squares and least absolute deviations estimators is their sensitivity to outliers. The least squares estimator is sensitive to outliers because it squares the errors, giving more weight to large errors. In contrast, the least absolute deviations estimator is less sensitive to outliers because it takes the absolute value of the errors, giving equal weight to all errors. This makes the least absolute deviations estimator more robust to outliers than the least squares estimator.</p>
<p>Another difference is the computational complexity. Least squares estimator can be found by solving a linear system of equations. There are fast and efficient algorithms for it, making the least squares estimator computationally efficient. In contrast, the least absolute deviations estimator requires more computationally expensive numerical optimization algorithms.</p>
<p>There is also a hybrid loss function, called <em>Huber loss</em>, which combines the advantages of squared errors and absolute deviations. It uses SE for small errors and AE for large errors, making it less sensitive to outliers.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-schwertman1990simple" class="csl-entry" role="listitem">
Schwertman, Neil C, AJ Gilks, and J Cameron. 1990. <span>“A Simple Noncalculus Proof That the Median Minimizes the Sum of the Absolute Deviations.”</span> <em>The American Statistician</em> 44 (1): 38–39.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./11-pattern.html" class="pagination-link" aria-label="Pattern Matching">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Pattern Matching</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./13-logistic.html" class="pagination-link" aria-label="Logistic Regression">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Logistic Regression</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>